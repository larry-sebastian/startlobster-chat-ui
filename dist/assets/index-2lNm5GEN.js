const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Chat-DgeVpvIf.js","assets/react-vendor-Bzht1aMj.js","assets/icons-BFri4d-7.js","assets/markdown-Bg1H1bKC.js"])))=>i.map(i=>d[i]);
import{r as o,j as e,R as Rt,a as Lt}from"./react-vendor-Bzht1aMj.js";import{S as ut,X as Se,L as Mt,M as Pt,a as Dt,b as Ot,C as _e,V as zt,c as _t,d as $t,e as Ut,f as ht,B as Je,I as Kt,D as pt,g as Ft,h as Bt,i as Ht,j as gt,k as Re,G as qe,l as Jt,Z as qt,P as Wt,m as Vt,n as Gt,T as Yt,o as Xt,E as Zt,p as Qt,q as mt,r as es,W as ts,K as ss}from"./icons-BFri4d-7.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const h of r)if(h.type==="childList")for(const c of h.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function n(r){const h={};return r.integrity&&(h.integrity=r.integrity),r.referrerPolicy&&(h.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?h.credentials="include":r.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function a(r){if(r.ep)return;r.ep=!0;const h=n(r);fetch(r.href,h)}})();const ns="modulepreload",as=function(t){return"/"+t},Ye={},rs=function(s,n,a){let r=Promise.resolve();if(n&&n.length>0){let p=function(d){return Promise.all(d.map(g=>Promise.resolve(g).then(C=>({status:"fulfilled",value:C}),C=>({status:"rejected",reason:C}))))};document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),l=c?.nonce||c?.getAttribute("nonce");r=p(n.map(d=>{if(d=as(d),d in Ye)return;Ye[d]=!0;const g=d.endsWith(".css"),C=g?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${C}`))return;const f=document.createElement("link");if(f.rel=g?"stylesheet":ns,g||(f.as="script"),f.crossOrigin="",f.href=d,l&&f.setAttribute("nonce",l),document.head.appendChild(f),g)return new Promise(($,L)=>{f.addEventListener("load",$),f.addEventListener("error",()=>L(new Error(`Unable to preload CSS for ${d}`)))})}))}function h(c){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=c,window.dispatchEvent(l),!l.defaultPrevented)throw c}return r.then(c=>{for(const l of c||[])l.status==="rejected"&&h(l.reason);return s().catch(h)})};let os=0;function Xe(t="req"){return`${t}-${++os}-${Date.now()}`}function is(){return`${Date.now()}-${Math.random().toString(36).slice(2,10)}`}const cs="startlobster_device",ls=1,ye="identity",Ze="device";function ds(){return new Promise((t,s)=>{const n=indexedDB.open(cs,ls);n.onupgradeneeded=()=>{const a=n.result;a.objectStoreNames.contains(ye)||a.createObjectStore(ye)},n.onsuccess=()=>t(n.result),n.onerror=()=>s(n.error)})}function us(t,s){return new Promise((n,a)=>{const c=t.transaction(ye,"readonly").objectStore(ye).get(s);c.onsuccess=()=>n(c.result),c.onerror=()=>a(c.error)})}function hs(t,s,n){return new Promise((a,r)=>{const l=t.transaction(ye,"readwrite").objectStore(ye).put(n,s);l.onsuccess=()=>a(),l.onerror=()=>r(l.error)})}function ft(t){const s=new Uint8Array(t);let n="";for(const a of s)n+=String.fromCharCode(a);return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function ps(t){return Array.from(new Uint8Array(t)).map(s=>s.toString(16).padStart(2,"0")).join("")}async function gs(){return crypto.subtle.generateKey("Ed25519",!0,["sign","verify"])}async function xt(t){return(await crypto.subtle.exportKey("spki",t)).slice(12)}async function ms(t){const s=await xt(t),n=await crypto.subtle.digest("SHA-256",s);return ps(n)}async function fs(){const t=await ds(),s=await us(t,Ze);if(s?.version===1)try{const d=await crypto.subtle.importKey("jwk",s.jwkPrivate,{name:"Ed25519"},!0,["sign"]),g=await crypto.subtle.importKey("jwk",s.jwkPublic,{name:"Ed25519"},!0,["verify"]);return t.close(),{id:s.deviceId,publicKeyRaw:s.publicKeyRaw,keyPair:{privateKey:d,publicKey:g}}}catch{}const n=await gs(),a=await xt(n.publicKey),r=ft(a),h=await ms(n.publicKey),c=await crypto.subtle.exportKey("jwk",n.publicKey),l=await crypto.subtle.exportKey("jwk",n.privateKey);return await hs(t,Ze,{version:1,deviceId:h,publicKeyRaw:r,jwkPublic:c,jwkPrivate:l}),t.close(),{id:h,publicKeyRaw:r,keyPair:n}}function xs(t){const s=t.nonce?"v2":"v1",n=t.scopes.join(","),a=t.token??"",r=[s,t.deviceId,t.clientId,t.clientMode,t.role,n,String(t.signedAtMs),a];return s==="v2"&&r.push(t.nonce??""),r.join("|")}async function bs(t,s){const n=new TextEncoder().encode(s),a=await crypto.subtle.sign("Ed25519",t,n);return ft(a)}const vs=()=>{try{return localStorage.getItem("startlobster:debug")==="1"}catch{return!1}},ce=(...t)=>{vs()&&console.log("[GW]",...t)};class ys{ws=null;pendingRequests=new Map;eventHandlers=[];_onStatus=()=>{};reconnectTimer=null;reconnectAttempts=0;connected=!1;autoReconnect=!0;connectNonce=null;wsUrl;authToken;deviceIdentity=null;constructor(s,n){this.wsUrl=s||`ws://${window.location.hostname}:18789`,this.authToken=n||""}setCredentials(s,n){this.wsUrl=s,this.authToken=n}setDeviceIdentity(s){this.deviceIdentity=s}onStatus(s){this._onStatus=s}onEvent(s){return this.eventHandlers.push(s),()=>{this.eventHandlers=this.eventHandlers.filter(n=>n!==s)}}connect(){this.ws||(this.autoReconnect=!0,this.connectNonce=null,this._onStatus("connecting"),this.ws=new WebSocket(this.wsUrl),this.ws.onopen=()=>{ce("WS open")},this.ws.onmessage=s=>{let n;try{n=JSON.parse(s.data)}catch{ce("parse error",s.data);return}if(ce("msg:",n.type,n.event||n.id||"",n.ok),n.type==="event")if(n.event==="connect.challenge"){const a=n.payload;this.connectNonce=a&&typeof a.nonce=="string"?a.nonce:null,this.handleChallenge()}else for(const a of this.eventHandlers)a(n.event??"",n.payload??{});else if(n.type==="res"&&n.id){const a=this.pendingRequests.get(n.id);a&&(this.pendingRequests.delete(n.id),n.ok?a.resolve(n.payload??{}):a.reject(n.payload??n.error??"unknown error"))}},this.ws.onclose=s=>{ce("WS close:",s.code,s.reason),this.ws=null,this.connected=!1,this._onStatus("disconnected"),this.pendingRequests.forEach(n=>n.reject(new Error("disconnected"))),this.pendingRequests.clear(),this.autoReconnect&&this.scheduleReconnect()},this.ws.onerror=s=>{ce("WS error",s)})}async handleChallenge(){const s=Xe("connect"),n="operator",a=["operator.read","operator.write","operator.admin"],r=Date.now(),h=this.connectNonce??void 0;let c;if(this.deviceIdentity){const l=xs({deviceId:this.deviceIdentity.id,clientId:"webchat",clientMode:"webchat",role:n,scopes:a,signedAtMs:r,token:this.authToken||null,nonce:h}),p=await bs(this.deviceIdentity.keyPair.privateKey,l);c={id:this.deviceIdentity.id,publicKey:this.deviceIdentity.publicKeyRaw,signature:p,signedAt:r,nonce:h}}try{const l=await this.request(s,"connect",{minProtocol:3,maxProtocol:3,client:{id:"webchat",version:"1.65.0",platform:"web",mode:"webchat"},role:n,scopes:a,caps:[],commands:[],permissions:{},auth:{token:this.authToken},device:c,locale:(typeof navigator<"u"?navigator.language:void 0)||"en",userAgent:"startlobster/1.65.0"});ce("connected!",l),this.connected=!0,this.reconnectAttempts=0,this._onStatus("connected")}catch(l){ce("connect failed:",l);const p=l;if(p&&(p.code==="NOT_PAIRED"||typeof p.message=="string"&&p.message.includes("NOT_PAIRED"))){ce("device not paired — awaiting approval"),this._onStatus("pairing");return}this.autoReconnect=!1,this.disconnect()}}scheduleReconnect(){if(this.reconnectTimer)return;const s=Math.min(1e3*Math.pow(2,this.reconnectAttempts),3e4),n=Math.random()*s*.3,a=s+n;this.reconnectAttempts++,ce(`reconnecting in ${Math.round(a)}ms (attempt ${this.reconnectAttempts})`),this.reconnectTimer=setTimeout(()=>{this.reconnectTimer=null,this.connect()},a)}disconnect(){this.autoReconnect=!1,this.reconnectAttempts=0,this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.ws&&(this.ws.close(),this.ws=null),this.connected=!1,this._onStatus("disconnected")}request(s,n,a){return new Promise((r,h)=>{if(!this.ws||this.ws.readyState!==WebSocket.OPEN)return h(new Error("not connected"));this.pendingRequests.set(s,{resolve:r,reject:h}),this.ws.send(JSON.stringify({type:"req",id:s,method:n,params:a})),setTimeout(()=>{this.pendingRequests.has(s)&&(this.pendingRequests.delete(s),h(new Error("timeout")))},3e4)})}async send(s,n){const a=Xe("req");return this.request(a,s,n)}get isConnected(){return this.connected}}const We="startlobster_credentials";function Ve(){try{const t=localStorage.getItem(We);if(!t)return null;const s=JSON.parse(t);if(s.url&&s.token)return s}catch{}return null}function ws(t,s){localStorage.setItem(We,JSON.stringify({url:t,token:s}))}function ks(){localStorage.removeItem(We)}const Ss=[/^\[EVENT\b/i,/\[from:\s*[^\]]*\(system\)\]/i,/^\[HEARTBEAT\b/i,/^\[cron:/i,/^\[hook:/i,/^\[webhook:/i,/^\[sms-inbound\b/i,/^\[teamspeak\b/i,/^Read HEARTBEAT\.md if it exists/,/^\[source:\s*\w+\]/i];function bt(t){const s=t.trim();return s?Ss.some(n=>n.test(s)):!1}function Zn(t){const s=t.trim(),n=s.match(/<<<EXTERNAL_UNTRUSTED_CONTENT>>>\s*([\s\S]*?)\s*<<<END_EXTERNAL_UNTRUSTED_CONTENT>>>/);if(n)return n[1].trim();let a=s.replace(/^\[(?:hook|cron|webhook|sms-inbound)[^\]]*\]\s*/i,"");return a=a.replace(/---\s*SECURITY NOTICE\s*---[\s\S]*?---\s*END\s*---\s*/i,""),a=a.replace(/---\s*SECURITY NOTICE\s*---[^\n]*\n(?:.*\n)*?(?=\S)/i,""),a=a.replace(/^(?:task_id|job_id|Task|Job)\s*[:=]\s*\S+\s*\n?/gim,""),a.trim()||s}function Qn(t){return/<<<EXTERNAL_UNTRUSTED_CONTENT>>>/.test(t)||/---\s*SECURITY NOTICE\s*---/i.test(t)}const Cs="startlobster-messages",js=1,we="messages";function vt(){return new Promise((t,s)=>{const n=indexedDB.open(Cs,js);n.onupgradeneeded=()=>{const a=n.result;a.objectStoreNames.contains(we)||a.createObjectStore(we)},n.onsuccess=()=>t(n.result),n.onerror=()=>s(n.error)})}async function Ns(t){try{const s=await vt();return new Promise((n,a)=>{const c=s.transaction(we,"readonly").objectStore(we).get(t);c.onsuccess=()=>n(c.result||[]),c.onerror=()=>a(c.error)})}catch{return[]}}async function Qe(t,s){try{const n=await vt();return new Promise((a,r)=>{const l=n.transaction(we,"readwrite").objectStore(we).put(s,t);l.onsuccess=()=>a(),l.onerror=()=>r(l.error)})}catch{}}function Es(t,s){if(s.length===0)return{messages:t,wasCompacted:!1};const n=new Set(t.map(c=>c.id)),a=s.filter(c=>!n.has(c.id));if(a.length===0)return{messages:t,wasCompacted:!1};const r=a.map(c=>({...c,isArchived:!0})),h={id:"compaction-separator-"+Date.now(),role:"assistant",content:"",timestamp:t.length>0?t[0].timestamp-1:Date.now(),blocks:[],isCompactionSeparator:!0};return{messages:[...r,h,...t],wasCompacted:!0}}function Ts(t){if(!t)return"";const s=t.content;return typeof s=="string"?s:Array.isArray(s)?s.filter(n=>n.type==="text"&&typeof n.text=="string").map(n=>n.text).join(`
`):""}function Is(t){if(!t)return"";const s=t.content;return Array.isArray(s)?s.filter(n=>n.type==="thinking").map(n=>n.thinking||n.text||"").join(`
`):""}function As(){const t=o.useRef(null),[s,n]=o.useState("disconnected"),[a,r]=o.useState([]),[h,c]=o.useState([]),[l,p]=o.useState("agent:main:main"),[d,g]=o.useState(!1),[C,f]=o.useState(!1),[$,L]=o.useState(null),[K,T]=o.useState(null),[q,M]=o.useState(!1),N=o.useRef(!1),y=o.useRef(a),E=o.useRef(l);o.useEffect(()=>{y.current=a},[a]),o.useEffect(()=>{E.current=l},[l]);const w=o.useRef(null),[P,O]=o.useState(new Set),[F,m]=o.useState(new Map),[R,ee]=o.useState(null),B=o.useRef(new Map),Y=o.useCallback(v=>{if(v?.stream!=="tool")return;const j=v.data??{},i=j.phase,k=j.toolCallId,x=j.name||"tool";k&&r(b=>{const z=b[b.length-1];if(!z||z.role!=="assistant"||!z.isStreaming)return b;const _={...z,blocks:[...z.blocks]};if(i==="start")_.blocks.push({type:"tool_use",name:x,input:j.args??{},id:k});else if(i==="result"){const H=j.result,J=typeof H=="string"?H:JSON.stringify(H,null,2);_.blocks.push({type:"tool_result",content:J?.slice(0,500)||"",toolUseId:k,name:x})}return[...b.slice(0,-1),_]})},[]),Q=o.useCallback(()=>{try{const v=localStorage.getItem("startlobster-deleted-sessions");return v?new Set(JSON.parse(v)):new Set}catch{return new Set}},[]),W=o.useCallback(v=>{const j=Q();j.add(v),localStorage.setItem("startlobster-deleted-sessions",JSON.stringify([...j]))},[Q]),ae=o.useCallback(async()=>{try{const v=await t.current?.send("agent.identity.get",{});v&&ee({name:v.name,emoji:v.emoji,avatar:v.avatar,agentId:v.agentId})}catch{}},[]),te=o.useCallback(async()=>{try{const j=(await t.current?.send("sessions.list",{}))?.sessions;if(j){const i=Q(),k=new Set(j.map(b=>b.key||b.sessionKey)),x=new Set([...i].filter(b=>k.has(b)));x.size!==i.size&&localStorage.setItem("startlobster-deleted-sessions",JSON.stringify([...x])),c(j.filter(b=>!i.has(b.key||b.sessionKey)).map(b=>({key:b.key||b.sessionKey,label:b.label||b.key||b.sessionKey,messageCount:b.messageCount,totalTokens:b.totalTokens,contextTokens:b.contextTokens,inputTokens:b.inputTokens,outputTokens:b.outputTokens,channel:b.lastChannel||b.channel,kind:b.kind,model:b.model,agentId:b.agentId,updatedAt:b.updatedAt,lastMessagePreview:b.lastMessagePreview})))}}catch{}},[Q]),X=o.useCallback(async v=>{f(!0);try{const i=(await t.current?.send("chat.history",{sessionKey:v,limit:100}))?.messages;if(i){const k=i.map((u,A)=>{const U=[];if(u.content)if(Array.isArray(u.content))for(const S of u.content)if(S.type==="text")U.push({type:"text",text:S.text});else if(S.type==="thinking")U.push({type:"thinking",text:S.thinking||S.text||""});else if(S.type==="image"){const ne=S.source||{};U.push({type:"image",mediaType:ne.media_type||S.media_type||"image/png",data:ne.data||S.data,url:S.url||ne.url})}else S.type==="image_url"?U.push({type:"image",mediaType:"image/png",url:S.image_url?.url||S.url}):S.type==="tool_use"?U.push({type:"tool_use",name:S.name,input:S.input,id:S.id}):S.type==="tool_result"?U.push({type:"tool_result",content:typeof S.content=="string"?S.content:JSON.stringify(S.content,null,2),toolUseId:S.tool_use_id}):S.type==="toolCall"?U.push({type:"tool_use",name:S.name,input:S.arguments||S.input,id:S.id}):S.type==="toolResult"&&U.push({type:"tool_result",content:typeof S.content=="string"?S.content:JSON.stringify(S.content,null,2),toolUseId:S.toolCallId||S.tool_use_id,name:S.name});else typeof u.content=="string"&&U.push({type:"text",text:u.content});const Z=u.role==="user"?"user":"assistant";if(u.role==="toolResult"){const S=U.map(ne=>ne.type==="text"?{type:"tool_result",content:ne.text,toolUseId:u.toolCallId}:ne);return{id:u.id||`hist-${A}`,role:"assistant",content:"",timestamp:u.timestamp||Date.now(),blocks:S,isToolResult:!0}}const ie=U.filter(S=>S.type==="text").map(S=>S.text).join(""),me={};for(const[S,ne]of Object.entries(u))["content","blocks"].includes(S)||(me[S]=ne);return{id:u.id||`hist-${A}`,role:Z,content:ie,timestamp:u.timestamp||Date.now(),blocks:U,metadata:me,isSystemEvent:Z==="user"&&bt(ie)}}),x=[];for(const u of k){const A="isToolResult"in u&&u.isToolResult;A&&x.length>0&&x[x.length-1].role==="assistant"?x[x.length-1]={...x[x.length-1],blocks:[...x[x.length-1].blocks,...u.blocks]}:A||x.push(u)}const b=v+":latest",z=B.current.get(b);if(z){B.current.delete(b);for(let u=x.length-1;u>=0;u--)if(x[u].role==="assistant"){x[u]={...x[u],generationTimeMs:z};break}}const _=await Ns(v),{messages:H,wasCompacted:J}=Es(x,_);J?Qe(v,H.filter(u=>!u.isCompactionSeparator)):Qe(v,x),r(H)}}catch{}finally{f(!1)}},[]),se=o.useCallback(async(v,j)=>{t.current&&t.current.disconnect();const i=new ys(v,j);t.current=i;try{const k=await fs();i.setDeviceIdentity(k)}catch(k){console.warn("[StartLobster Chat] Failed to load device identity, connecting without it:",k)}i.onStatus(k=>{n(k),k==="connected"?(L(!0),T(null),M(!1),N.current=!1,ws(v,j),te(),ae(),X(E.current)):k==="pairing"?(L(!0),T(null),M(!1),N.current=!1):k==="disconnected"&&!i.isConnected&&N.current&&(T("Connection failed — check URL and token"),M(!1),N.current=!1,L(!1))}),i.onEvent((k,x)=>{if(k==="agent"){Y(x);return}if(k!=="chat")return;const b=x.state,z=x.runId,_=x.message,H=x.errorMessage,J=x.sessionKey;if(J&&(b==="delta"?O(u=>{if(u.has(J))return u;const A=new Set(u);return A.add(J),A}):(b==="final"||b==="error"||b==="aborted")&&O(u=>{if(!u.has(J))return u;const A=new Set(u);return A.delete(J),A})),J!==E.current){b==="final"&&J&&m(u=>{const A=new Map(u);return A.set(J,(u.get(J)||0)+1),A});return}if(b==="delta"){const u=Ts(_),A=Is(_);w.current=z,r(U=>{const Z=U[U.length-1];if(Z&&Z.role==="assistant"&&Z.isStreaming&&Z.runId===z){const S={...Z};S.content=u;const ne=S.blocks.filter(Ge=>Ge.type==="tool_use"||Ge.type==="tool_result"),je=[];return A&&je.push({type:"thinking",text:A}),je.push(...ne),je.push({type:"text",text:u}),S.blocks=je,[...U.slice(0,-1),S]}const ie=[];A&&ie.push({type:"thinking",text:A}),ie.push({type:"text",text:u});const me={id:z+"-"+Date.now(),role:"assistant",content:u,timestamp:Date.now(),blocks:ie,isStreaming:!0,runId:z,streamStartedAt:Date.now()};return[...U,me]})}else if(b==="final"){const u=y.current[y.current.length-1];u?.role==="assistant"&&u.streamStartedAt&&B.current.set(E.current+":latest",Date.now()-u.streamStartedAt),w.current=null,g(!1),X(E.current)}else b==="error"?(w.current=null,g(!1),r(u=>{const A=u[u.length-1];return A&&A.role==="assistant"&&A.isStreaming&&A.runId===z?[...u.slice(0,-1),{...A,isStreaming:!1}]:[...u,{id:"error-"+Date.now(),role:"assistant",content:`Error: ${H||"unknown error"}`,timestamp:Date.now(),blocks:[{type:"text",text:`Error: ${H||"unknown error"}`}]}]})):b==="aborted"&&(w.current=null,g(!1),r(u=>{const A=u[u.length-1];return A&&A.role==="assistant"&&A.isStreaming?[...u.slice(0,-1),{...A,isStreaming:!1}]:u}))}),M(!0),N.current=!0,T(null),i.connect()},[Y,X,te,ae]),pe=o.useRef(!1);o.useEffect(()=>{if(pe.current)return;pe.current=!0;const v=Ve();v?se(v.url,v.token):L(!1)},[se]);const de=o.useCallback(async(v,j)=>{const i="user-"+Date.now(),k={id:i,role:"user",content:v,timestamp:Date.now(),blocks:[{type:"text",text:v}],sendStatus:"sending"};r(x=>[...x,k]),g(!0);try{await t.current?.send("chat.send",{sessionKey:E.current,message:v,deliver:!1,idempotencyKey:is(),...j&&j.length>0?{attachments:j}:{}}),r(x=>x.map(b=>b.id===i?{...b,sendStatus:"sent"}:b))}catch{r(x=>x.map(b=>b.id===i?{...b,sendStatus:"error"}:b)),g(!1)}},[]),re=o.useCallback(async()=>{try{await t.current?.send("chat.abort",{sessionKey:E.current})}catch{}g(!1)},[]),I=o.useCallback(v=>{p(v),E.current=v,r([]),m(j=>{if(!j.has(v))return j;const i=new Map(j);return i.delete(v),i}),X(v)},[X]),D=o.useCallback((v,j)=>{se(v,j)},[se]),V=o.useCallback(async v=>{try{await t.current?.send("sessions.delete",{key:v,deleteTranscript:!0})}catch{}if(W(v),c(j=>j.filter(i=>i.key!==v)),E.current===v){const j="agent:main:main";p(j),E.current=j,r([]),X(j)}},[X,W]),oe=o.useCallback(()=>{t.current&&(t.current.disconnect(),t.current=null),ks(),L(!1),r([]),c([]),n("disconnected"),T(null)},[]);o.useEffect(()=>{if(s!=="connected")return;const v=setInterval(te,3e4);return()=>clearInterval(v)},[s,te]);const fe=h.map(v=>({...v,isActive:P.has(v.key),hasUnread:F.has(v.key),unreadCount:F.get(v.key)||0})),ge=o.useCallback(()=>t.current,[]),xe=o.useCallback(v=>{const j=t.current;return j?j.onEvent(v):()=>{}},[]);return{status:s,messages:a,sessions:fe,activeSession:l,isGenerating:d,isLoadingHistory:C,sendMessage:de,abort:re,switchSession:I,loadSessions:te,deleteSession:V,authenticated:$,login:D,logout:oe,connectError:K,isConnecting:q,agentIdentity:R,getClient:ge,addEventListener:xe}}function Rs(t){if(!t)return"";const s=t.content;return typeof s=="string"?s:Array.isArray(s)?s.filter(n=>n.type==="text"&&typeof n.text=="string").map(n=>n.text).join(`
`):""}function Ls(t){if(!t)return"";const s=t.content;return Array.isArray(s)?s.filter(n=>n.type==="thinking").map(n=>n.thinking||n.text||"").join(`
`):""}function Ms(t,s,n){const[a,r]=o.useState([]),[h,c]=o.useState(!1),[l,p]=o.useState(!1),d=o.useRef(n),g=o.useRef(null);o.useEffect(()=>{d.current=n},[n]);const C=o.useCallback(async K=>{c(!0);try{const q=(await t()?.send("chat.history",{sessionKey:K,limit:100}))?.messages;if(!q)return;const M=q.map((y,E)=>{const w=[];if(y.content)if(Array.isArray(y.content))for(const m of y.content)if(m.type==="text")w.push({type:"text",text:m.text});else if(m.type==="thinking")w.push({type:"thinking",text:m.thinking||m.text||""});else if(m.type==="image"){const R=m.source||{};w.push({type:"image",mediaType:R.media_type||m.media_type||"image/png",data:R.data||m.data,url:m.url||R.url})}else m.type==="image_url"?w.push({type:"image",mediaType:"image/png",url:m.image_url?.url||m.url}):m.type==="tool_use"?w.push({type:"tool_use",name:m.name,input:m.input,id:m.id}):m.type==="tool_result"?w.push({type:"tool_result",content:typeof m.content=="string"?m.content:JSON.stringify(m.content,null,2),toolUseId:m.tool_use_id}):m.type==="toolCall"?w.push({type:"tool_use",name:m.name,input:m.arguments||m.input,id:m.id}):m.type==="toolResult"&&w.push({type:"tool_result",content:typeof m.content=="string"?m.content:JSON.stringify(m.content,null,2),toolUseId:m.toolCallId||m.tool_use_id,name:m.name});else typeof y.content=="string"&&w.push({type:"text",text:y.content});const P=y.role==="user"?"user":"assistant";if(y.role==="toolResult"){const m=w.map(R=>R.type==="text"?{type:"tool_result",content:R.text,toolUseId:y.toolCallId}:R);return{id:y.id||`hist-${E}`,role:"assistant",content:"",timestamp:y.timestamp||Date.now(),blocks:m,isToolResult:!0}}const O=w.filter(m=>m.type==="text").map(m=>m.text).join(""),F={};for(const[m,R]of Object.entries(y))["content","blocks"].includes(m)||(F[m]=R);return{id:y.id||`hist-${E}`,role:P,content:O,timestamp:y.timestamp||Date.now(),blocks:w,metadata:F,isSystemEvent:P==="user"&&bt(O)}}),N=[];for(const y of M){const E="isToolResult"in y&&y.isToolResult;E&&N.length>0&&N[N.length-1].role==="assistant"?N[N.length-1]={...N[N.length-1],blocks:[...N[N.length-1].blocks,...y.blocks]}:E||N.push(y)}r(N)}catch{}finally{c(!1)}},[t]);o.useEffect(()=>{if(!n){r([]);return}C(n)},[n,C]);const f=o.useCallback((K,T)=>{if(!d.current||T.sessionKey!==d.current)return;if(K==="agent"){if(T?.stream!=="tool")return;const w=T.data??{},P=w.phase,O=w.toolCallId,F=w.name||"tool";if(!O)return;r(m=>{const R=m[m.length-1];if(!R||R.role!=="assistant"||!R.isStreaming)return m;const ee={...R,blocks:[...R.blocks]};if(P==="start")ee.blocks.push({type:"tool_use",name:F,input:w.args??{},id:O});else if(P==="result"){const B=w.result,Y=typeof B=="string"?B:JSON.stringify(B,null,2);ee.blocks.push({type:"tool_result",content:Y?.slice(0,500)||"",toolUseId:O,name:F})}return[...m.slice(0,-1),ee]});return}if(K!=="chat")return;const M=T.state,N=T.runId,y=T.message,E=T.errorMessage;if(M==="delta"){const w=Rs(y),P=Ls(y);g.current=N,p(!0),r(O=>{const F=O[O.length-1];if(F&&F.role==="assistant"&&F.isStreaming&&F.runId===N){const R={...F};R.content=w;const ee=R.blocks.filter(Y=>Y.type==="tool_use"||Y.type==="tool_result"),B=[];return P&&B.push({type:"thinking",text:P}),B.push(...ee),B.push({type:"text",text:w}),R.blocks=B,[...O.slice(0,-1),R]}const m=[];return P&&m.push({type:"thinking",text:P}),m.push({type:"text",text:w}),[...O,{id:N+"-"+Date.now(),role:"assistant",content:w,timestamp:Date.now(),blocks:m,isStreaming:!0,runId:N}]})}else M==="final"?(g.current=null,p(!1),d.current&&C(d.current)):M==="error"?(g.current=null,p(!1),r(w=>{const P=w[w.length-1];return P&&P.role==="assistant"&&P.isStreaming&&P.runId===N?[...w.slice(0,-1),{...P,isStreaming:!1}]:[...w,{id:"error-"+Date.now(),role:"assistant",content:`Error: ${E||"unknown error"}`,timestamp:Date.now(),blocks:[{type:"text",text:`Error: ${E||"unknown error"}`}]}]})):M==="aborted"&&(g.current=null,p(!1),r(w=>{const P=w[w.length-1];return P&&P.role==="assistant"&&P.isStreaming?[...w.slice(0,-1),{...P,isStreaming:!1}]:w}))},[C]);o.useEffect(()=>n?s(f):void 0,[n,s,f]);const $=o.useCallback(async(K,T)=>{if(!d.current)return;const q="user-"+Date.now(),M={id:q,role:"user",content:K,timestamp:Date.now(),blocks:[{type:"text",text:K}],sendStatus:"sending"};r(N=>[...N,M]),p(!0);try{await t()?.send("chat.send",{sessionKey:d.current,message:K,deliver:!1,...T&&T.length>0?{attachments:T}:{}}),r(N=>N.map(y=>y.id===q?{...y,sendStatus:"sent"}:y))}catch{r(N=>N.map(y=>y.id===q?{...y,sendStatus:"error"}:y)),p(!1)}},[t]),L=o.useCallback(async()=>{if(d.current){try{await t()?.send("chat.abort",{sessionKey:d.current})}catch{}p(!1)}},[t]);return{messages:a,isLoadingHistory:h,isGenerating:l,sendMessage:$,abort:L,handleEvent:f}}let be=null;function Ps(){try{return(!be||be.state==="closed")&&(be=new AudioContext),be.state==="suspended"&&be.resume(),be}catch{return null}}function et(t=.3){const s=Ps();if(!s)return;const n=s.currentTime,a=[523.25,659.25],r=.12,h=.08;a.forEach((c,l)=>{const p=s.createOscillator(),d=s.createGain();p.type="sine",p.frequency.value=c;const g=n+l*(r+h);d.gain.setValueAtTime(0,g),d.gain.linearRampToValueAtTime(t,g+.01),d.gain.exponentialRampToValueAtTime(.001,g+r),p.connect(d),d.connect(s.destination),p.start(g),p.stop(g+r+.01)})}const $e="StartLobster Chat";let Le=$e;function tt(t){Le=t?`${t} — ${$e}`:$e,document.hidden||(document.title=Le)}const st="startlobster-notification-sound",Me=typeof Notification<"u";function Ds(){const[t,s]=o.useState(0),[n,a]=o.useState(()=>{const p=localStorage.getItem(st);return p===null?!0:p==="true"}),r=o.useRef(!document.hidden),h=o.useRef(Me?Notification.permission:"denied");o.useEffect(()=>{const p=()=>{r.current=!document.hidden,document.hidden||(s(0),document.title=Le)};return document.addEventListener("visibilitychange",p),()=>document.removeEventListener("visibilitychange",p)},[]),o.useEffect(()=>{t>0&&(document.title=`(${t}) ${Le}`)},[t]),o.useEffect(()=>{if(!Me||h.current!=="default")return;const p=()=>{h.current==="default"&&Notification.requestPermission().then(d=>{h.current=d}),document.removeEventListener("click",p)};return document.addEventListener("click",p),()=>document.removeEventListener("click",p)},[]);const c=o.useCallback(()=>{a(p=>{const d=!p;return localStorage.setItem(st,String(d)),d&&et(.3),d})},[]);return{notify:o.useCallback((p,d)=>{if(!r.current&&(s(g=>g+1),n&&et(.3),Me&&h.current==="granted"))try{const g=new Notification(p,{body:d?.slice(0,200),icon:"/logo.png",tag:"startlobster-message",silent:n});setTimeout(()=>g.close(),5e3),g.onclick=()=>{window.focus(),g.close()}}catch{}},[n]),unreadCount:t,soundEnabled:n,toggleSound:c}}const yt="startlobster-locale",Os={"login.title":"StartLobster Chat","login.subtitle":"Connect to your AI assistant","login.gatewayUrl":"Gateway URL","login.token":"Token","login.tokenPlaceholder":"Enter your gateway token","login.connect":"Connect","login.connecting":"Connecting…","login.showToken":"Show token","login.hideToken":"Hide token","login.storedLocally":"Credentials are stored locally in your browser","login.wsHint":"URL must start with ws:// or wss://","header.title":"StartLobster","header.connected":"Connected","header.disconnected":"Disconnected","header.logout":"Logout","header.toggleSidebar":"Toggle sidebar","header.changeLanguage":"Change language","header.soundOn":"Enable notification sound","header.soundOff":"Disable notification sound","chat.welcome":"StartLobster Chat","chat.welcomeSub":"Send a message to get started","chat.suggestions":"Try asking...","chat.suggestion1":"Summarize my recent emails","chat.suggestion2":"What's on my calendar today?","chat.suggestion3":"Search the web for latest news","chat.suggestion4":"Help me write a script","chat.loadingHistory":"Loading messages…","chat.inputPlaceholder":"Type a message…","chat.inputLabel":"Message","chat.attachFile":"Attach file","chat.send":"Send","chat.stop":"Stop","chat.showPreview":"Preview markdown","chat.hidePreview":"Hide preview","chat.scrollToBottom":"New messages","chat.scrollDown":"Scroll to bottom","chat.collapseTools":"Collapse all tools","chat.expandTools":"Expand all tools","chat.messages":"Chat messages","chat.thinking":"Thinking…","sidebar.title":"Sessions","sidebar.empty":"No sessions","sidebar.search":"Search sessions…","sidebar.noResults":"No matching sessions","sidebar.pin":"Pin session","sidebar.unpin":"Unpin session","sidebar.pinned":"Pinned","sidebar.delete":"Delete session","sidebar.rename":"Rename session","sidebar.deleteConfirm":"Delete this session? This cannot be undone.","sidebar.deleteCancel":"Cancel","sidebar.openSplit":"Open in split view","sidebar.close":"Close sidebar","sidebar.clearSearch":"Clear search","sidebar.filterAll":"All","sidebar.filterActive":"Active","split.close":"Close split view","app.mainChat":"Main chat","app.splitPane":"Split pane","app.skipToChat":"Skip to chat input","thinking.label":"Thinking","thinking.reasoning":"Reasoning…","tool.parameters":"Parameters","tool.result":"Result","connection.reconnecting":"Connection lost — reconnecting…","connection.reconnected":"Reconnected!","connection.pairing":"Device pairing pending — run `openclaw devices approve` on your gateway","message.copy":"Copy message","message.copied":"Copied!","message.retry":"Resend message","message.showMore":"Show more","message.showLess":"Show less","message.metadata":"Message details","message.rawJson":"Raw JSON","message.hideRawJson":"Hide raw JSON","time.yesterday":"Yesterday","time.today":"Today","shortcuts.title":"Keyboard Shortcuts","shortcuts.send":"Send message","shortcuts.newline":"New line","shortcuts.search":"Search sessions","shortcuts.switchSession":"Previous / next session","shortcuts.closeSidebar":"Close sidebar / search","shortcuts.stop":"Stop generation","shortcuts.help":"Show shortcuts","shortcuts.close":"Close","shortcuts.chatSection":"Chat","error.title":"Something went wrong","error.description":"An unexpected error occurred while rendering the interface. You can try again or reload the page.","error.retry":"Try again","error.reload":"Reload page","shortcuts.navigationSection":"Navigation","shortcuts.generalSection":"General","header.export":"Export conversation as Markdown","header.compact":"Compact","header.compacting":"Compacting…","header.sessionInfo":"Session Info","sessionInfo.sessionKey":"Session Key","sessionInfo.channel":"Channel","sessionInfo.kind":"Kind","sessionInfo.model":"Model","sessionInfo.agent":"Agent","sessionInfo.messages":"Messages","sessionInfo.totalTokens":"Total Tokens","sessionInfo.inputTokens":"Input","sessionInfo.outputTokens":"Output","sessionInfo.contextWindow":"Context","sessionInfo.lastActive":"Last Active","theme.title":"Theme","theme.mode":"Mode","theme.accent":"Accent","theme.system":"System","theme.dark":"Dark","theme.light":"Light","theme.oled":"OLED","search.placeholder":"Search messages…","search.noResults":"0 results","search.prev":"Previous match","search.next":"Next match","shortcuts.searchMessages":"Search messages","settings.title":"Settings","settings.appearance":"Appearance","settings.chat":"Chat","settings.notifications":"Notifications","settings.notificationSound":"Notification sound","settings.language":"Language","settings.sendShortcut":"Send with","settings.sendEnter":"Enter","settings.sendCtrlEnter":"Ctrl+Enter","message.bookmark":"Bookmark message","message.removeBookmark":"Remove bookmark","message.reply":"Reply","chat.replyingTo":"Replying to","chat.bookmarks":"Bookmarks","chat.export":"Export conversation","chat.contextCompacted":"Context compacted — older messages cached locally","slash.commands":"Commands","slash.status":"Show session status & usage","slash.reasoning":"Toggle reasoning mode","slash.verbose":"Toggle verbose output","slash.model":"Switch model for this session","slash.compact":"Compact conversation context","slash.reset":"Reset the session","slash.help":"Show available commands"},zs={"login.title":"StartLobster Chat","login.subtitle":"Connectez-vous à votre gateway OpenClaw","login.gatewayUrl":"URL de la gateway","login.token":"Token","login.tokenPlaceholder":"Entrez votre token gateway","login.connect":"Connexion","login.connecting":"Connexion…","login.showToken":"Afficher le token","login.hideToken":"Masquer le token","login.storedLocally":"Les identifiants sont stockés localement dans votre navigateur","login.wsHint":"L'URL doit commencer par ws:// ou wss://","header.title":"StartLobster","header.connected":"Connecté","header.disconnected":"Déconnecté","header.logout":"Déconnexion","header.toggleSidebar":"Afficher/masquer la barre latérale","header.changeLanguage":"Changer de langue","header.soundOn":"Activer le son de notification","header.soundOff":"Désactiver le son de notification","chat.welcome":"StartLobster Chat","chat.welcomeSub":"Envoyez un message pour commencer","chat.suggestions":"Essayez par exemple...","chat.suggestion1":"Résume mes derniers emails","chat.suggestion2":"Qu'est-ce que j'ai au calendrier aujourd'hui ?","chat.suggestion3":"Cherche sur le web les dernières actus","chat.suggestion4":"Aide-moi à écrire un script","chat.loadingHistory":"Chargement des messages…","chat.inputPlaceholder":"Tapez un message…","chat.inputLabel":"Message","chat.attachFile":"Joindre un fichier","chat.send":"Envoyer","chat.stop":"Arrêter","chat.showPreview":"Aperçu markdown","chat.hidePreview":"Masquer l'aperçu","chat.scrollToBottom":"Nouveaux messages","chat.scrollDown":"Défiler en bas","chat.collapseTools":"Replier tous les outils","chat.expandTools":"Déplier tous les outils","chat.messages":"Messages du chat","chat.thinking":"Réflexion…","sidebar.title":"Sessions","sidebar.empty":"Aucune session","sidebar.search":"Rechercher…","sidebar.noResults":"Aucun résultat","sidebar.pin":"Épingler la session","sidebar.unpin":"Désépingler la session","sidebar.pinned":"Épinglées","sidebar.delete":"Supprimer la session","sidebar.rename":"Renommer la session","sidebar.deleteConfirm":"Supprimer cette session ? Cette action est irréversible.","sidebar.deleteCancel":"Annuler","sidebar.openSplit":"Ouvrir en vue scindée","sidebar.close":"Fermer la barre latérale","sidebar.clearSearch":"Effacer la recherche","sidebar.filterAll":"Tout","sidebar.filterActive":"Actives","split.close":"Fermer la vue scindée","app.mainChat":"Chat principal","app.splitPane":"Volet scindé","app.skipToChat":"Aller au champ de saisie","thinking.label":"Réflexion","thinking.reasoning":"Réflexion…","tool.parameters":"Paramètres","tool.result":"Résultat","connection.reconnecting":"Connexion perdue — reconnexion…","connection.reconnected":"Reconnecté !","connection.pairing":"Appairage en attente — exécutez `openclaw devices approve` sur votre gateway","message.copy":"Copier le message","message.copied":"Copié !","message.retry":"Renvoyer le message","message.showMore":"Afficher plus","message.showLess":"Afficher moins","message.metadata":"Détails du message","message.rawJson":"JSON brut","message.hideRawJson":"Masquer le JSON brut","time.yesterday":"Hier","time.today":"Aujourd'hui","shortcuts.title":"Raccourcis clavier","shortcuts.send":"Envoyer le message","shortcuts.newline":"Nouvelle ligne","shortcuts.search":"Rechercher des sessions","shortcuts.switchSession":"Session précédente / suivante","shortcuts.closeSidebar":"Fermer la barre / recherche","shortcuts.stop":"Arrêter la génération","shortcuts.help":"Afficher les raccourcis","shortcuts.close":"Fermer","shortcuts.chatSection":"Chat","error.title":"Quelque chose s'est mal passé","error.description":"Une erreur inattendue est survenue lors de l'affichage. Vous pouvez réessayer ou recharger la page.","error.retry":"Réessayer","error.reload":"Recharger","shortcuts.navigationSection":"Navigation","shortcuts.generalSection":"Général","header.export":"Exporter la conversation en Markdown","header.compact":"Compacter","header.compacting":"Compaction…","header.sessionInfo":"Infos session","sessionInfo.sessionKey":"Clé session","sessionInfo.channel":"Canal","sessionInfo.kind":"Type","sessionInfo.model":"Modèle","sessionInfo.agent":"Agent","sessionInfo.messages":"Messages","sessionInfo.totalTokens":"Tokens total","sessionInfo.inputTokens":"Entrée","sessionInfo.outputTokens":"Sortie","sessionInfo.contextWindow":"Contexte","sessionInfo.lastActive":"Dernière activité","theme.title":"Thème","theme.mode":"Mode","theme.accent":"Accent","theme.system":"Système","theme.dark":"Sombre","theme.light":"Clair","theme.oled":"OLED","search.placeholder":"Rechercher dans les messages…","search.noResults":"0 résultat","search.prev":"Résultat précédent","search.next":"Résultat suivant","shortcuts.searchMessages":"Rechercher dans les messages","settings.title":"Paramètres","settings.appearance":"Apparence","settings.chat":"Chat","settings.notifications":"Notifications","settings.notificationSound":"Son de notification","settings.language":"Langue","settings.sendShortcut":"Envoyer avec","settings.sendEnter":"Entrée","settings.sendCtrlEnter":"Ctrl+Entrée","message.bookmark":"Marquer le message","message.removeBookmark":"Retirer le marque-page","message.reply":"Répondre","chat.replyingTo":"En réponse à","chat.bookmarks":"Marque-pages","chat.export":"Exporter la conversation","chat.contextCompacted":"Contexte compacté — anciens messages en cache local","slash.commands":"Commandes","slash.status":"Afficher le statut et l'utilisation","slash.reasoning":"Activer/désactiver le raisonnement","slash.verbose":"Activer/désactiver le mode verbeux","slash.model":"Changer de modèle pour cette session","slash.compact":"Compacter le contexte","slash.reset":"Réinitialiser la session","slash.help":"Afficher les commandes disponibles"},_s={"login.title":"StartLobster Chat","login.subtitle":"Conéctate a tu gateway OpenClaw","login.gatewayUrl":"URL del gateway","login.token":"Token","login.tokenPlaceholder":"Introduce tu token de gateway","login.connect":"Conectar","login.connecting":"Conectando…","login.showToken":"Mostrar token","login.hideToken":"Ocultar token","login.storedLocally":"Las credenciales se guardan localmente en tu navegador","login.wsHint":"La URL debe empezar con ws:// o wss://","header.title":"StartLobster","header.connected":"Conectado","header.disconnected":"Desconectado","header.logout":"Cerrar sesión","header.toggleSidebar":"Mostrar/ocultar barra lateral","header.changeLanguage":"Cambiar idioma","header.soundOn":"Activar sonido de notificación","header.soundOff":"Desactivar sonido de notificación","chat.welcome":"StartLobster Chat","chat.welcomeSub":"Envía un mensaje para comenzar","chat.suggestions":"Prueba a preguntar...","chat.suggestion1":"Resume mis últimos correos","chat.suggestion2":"¿Qué tengo en el calendario hoy?","chat.suggestion3":"Busca en la web las últimas noticias","chat.suggestion4":"Ayúdame a escribir un script","chat.loadingHistory":"Cargando mensajes…","chat.inputPlaceholder":"Escribe un mensaje…","chat.inputLabel":"Mensaje","chat.attachFile":"Adjuntar archivo","chat.send":"Enviar","chat.stop":"Detener","chat.showPreview":"Vista previa markdown","chat.hidePreview":"Ocultar vista previa","chat.scrollToBottom":"Nuevos mensajes","chat.scrollDown":"Ir al final","chat.collapseTools":"Contraer todas las herramientas","chat.expandTools":"Expandir todas las herramientas","chat.messages":"Mensajes del chat","chat.thinking":"Pensando…","sidebar.title":"Sesiones","sidebar.empty":"Sin sesiones","sidebar.search":"Buscar sesiones…","sidebar.noResults":"Sin resultados","sidebar.pin":"Fijar sesión","sidebar.unpin":"Desfijar sesión","sidebar.pinned":"Fijadas","sidebar.delete":"Eliminar sesión","sidebar.rename":"Renombrar sesión","sidebar.deleteConfirm":"¿Eliminar esta sesión? Esta acción no se puede deshacer.","sidebar.deleteCancel":"Cancelar","sidebar.openSplit":"Abrir en vista dividida","sidebar.close":"Cerrar barra lateral","sidebar.clearSearch":"Limpiar búsqueda","sidebar.filterAll":"Todas","sidebar.filterActive":"Activas","split.close":"Cerrar vista dividida","app.mainChat":"Chat principal","app.splitPane":"Panel dividido","app.skipToChat":"Ir al campo de entrada","thinking.label":"Pensamiento","thinking.reasoning":"Razonando…","tool.parameters":"Parámetros","tool.result":"Resultado","connection.reconnecting":"Conexión perdida — reconectando…","connection.reconnected":"¡Reconectado!","connection.pairing":"Emparejamiento pendiente — ejecute `openclaw devices approve` en su gateway","message.copy":"Copiar mensaje","message.copied":"¡Copiado!","message.retry":"Reenviar mensaje","message.showMore":"Ver más","message.showLess":"Ver menos","message.metadata":"Detalles del mensaje","message.rawJson":"JSON sin formato","message.hideRawJson":"Ocultar JSON sin formato","time.yesterday":"Ayer","time.today":"Hoy","shortcuts.title":"Atajos de teclado","shortcuts.send":"Enviar mensaje","shortcuts.newline":"Nueva línea","shortcuts.search":"Buscar sesiones","shortcuts.switchSession":"Sesión anterior / siguiente","shortcuts.closeSidebar":"Cerrar barra / búsqueda","shortcuts.stop":"Detener generación","shortcuts.help":"Mostrar atajos","shortcuts.close":"Cerrar","shortcuts.chatSection":"Chat","error.title":"Algo salió mal","error.description":"Ocurrió un error inesperado al mostrar la interfaz. Puedes intentar de nuevo o recargar la página.","error.retry":"Reintentar","error.reload":"Recargar página","shortcuts.navigationSection":"Navegación","shortcuts.generalSection":"General","header.export":"Exportar conversación como Markdown","header.compact":"Compactar","header.compacting":"Compactando…","header.sessionInfo":"Info de sesión","sessionInfo.sessionKey":"Clave de sesión","sessionInfo.channel":"Canal","sessionInfo.kind":"Tipo","sessionInfo.model":"Modelo","sessionInfo.agent":"Agente","sessionInfo.messages":"Mensajes","sessionInfo.totalTokens":"Tokens totales","sessionInfo.inputTokens":"Entrada","sessionInfo.outputTokens":"Salida","sessionInfo.contextWindow":"Contexto","sessionInfo.lastActive":"Última actividad","theme.title":"Tema","theme.mode":"Modo","theme.accent":"Acento","theme.system":"Sistema","theme.dark":"Oscuro","theme.light":"Claro","theme.oled":"OLED","search.placeholder":"Buscar en mensajes…","search.noResults":"0 resultados","search.prev":"Resultado anterior","search.next":"Resultado siguiente","shortcuts.searchMessages":"Buscar en mensajes","settings.title":"Ajustes","settings.appearance":"Apariencia","settings.chat":"Chat","settings.notifications":"Notificaciones","settings.notificationSound":"Sonido de notificación","settings.language":"Idioma","settings.sendShortcut":"Enviar con","settings.sendEnter":"Enter","settings.sendCtrlEnter":"Ctrl+Enter","message.bookmark":"Marcar mensaje","message.removeBookmark":"Quitar marcador","message.reply":"Responder","chat.replyingTo":"Respondiendo a","chat.bookmarks":"Marcadores","chat.export":"Exportar conversación","chat.contextCompacted":"Contexto compactado — mensajes anteriores en caché local","slash.commands":"Comandos","slash.status":"Mostrar estado y uso de la sesión","slash.reasoning":"Activar/desactivar razonamiento","slash.verbose":"Activar/desactivar modo detallado","slash.model":"Cambiar modelo para esta sesión","slash.compact":"Compactar contexto de conversación","slash.reset":"Reiniciar la sesión","slash.help":"Mostrar comandos disponibles"},$s={"login.title":"StartLobster Chat","login.subtitle":"Mit deinem OpenClaw-Gateway verbinden","login.gatewayUrl":"Gateway-URL","login.token":"Token","login.tokenPlaceholder":"Gateway-Token eingeben","login.connect":"Verbinden","login.connecting":"Verbinde…","login.showToken":"Token anzeigen","login.hideToken":"Token verbergen","login.storedLocally":"Zugangsdaten werden lokal in deinem Browser gespeichert","login.wsHint":"URL muss mit ws:// oder wss:// beginnen","header.title":"StartLobster","header.connected":"Verbunden","header.disconnected":"Getrennt","header.logout":"Abmelden","header.toggleSidebar":"Seitenleiste ein-/ausblenden","header.changeLanguage":"Sprache ändern","header.soundOn":"Benachrichtigungston aktivieren","header.soundOff":"Benachrichtigungston deaktivieren","chat.welcome":"StartLobster Chat","chat.welcomeSub":"Sende eine Nachricht, um zu beginnen","chat.suggestions":"Probiere z. B. …","chat.suggestion1":"Fasse meine letzten E-Mails zusammen","chat.suggestion2":"Was steht heute in meinem Kalender?","chat.suggestion3":"Suche im Web nach aktuellen Nachrichten","chat.suggestion4":"Hilf mir, ein Skript zu schreiben","chat.loadingHistory":"Nachrichten werden geladen…","chat.inputPlaceholder":"Nachricht eingeben…","chat.inputLabel":"Nachricht","chat.attachFile":"Datei anhängen","chat.send":"Senden","chat.stop":"Stoppen","chat.showPreview":"Markdown-Vorschau","chat.hidePreview":"Vorschau ausblenden","chat.scrollToBottom":"Neue Nachrichten","chat.scrollDown":"Nach unten scrollen","chat.collapseTools":"Alle Tools einklappen","chat.expandTools":"Alle Tools ausklappen","chat.messages":"Chat-Nachrichten","chat.thinking":"Denkt nach…","sidebar.title":"Sitzungen","sidebar.empty":"Keine Sitzungen","sidebar.search":"Sitzungen suchen…","sidebar.noResults":"Keine Treffer","sidebar.pin":"Sitzung anheften","sidebar.unpin":"Sitzung lösen","sidebar.pinned":"Angeheftet","sidebar.delete":"Sitzung löschen","sidebar.rename":"Sitzung umbenennen","sidebar.deleteConfirm":"Diese Sitzung löschen? Dies kann nicht rückgängig gemacht werden.","sidebar.deleteCancel":"Abbrechen","sidebar.openSplit":"In geteilter Ansicht öffnen","sidebar.close":"Seitenleiste schließen","sidebar.clearSearch":"Suche leeren","sidebar.filterAll":"Alle","sidebar.filterActive":"Aktive","split.close":"Geteilte Ansicht schließen","app.mainChat":"Haupt-Chat","app.splitPane":"Geteiltes Fenster","app.skipToChat":"Zum Eingabefeld springen","thinking.label":"Nachdenken","thinking.reasoning":"Denkt nach…","tool.parameters":"Parameter","tool.result":"Ergebnis","connection.reconnecting":"Verbindung verloren — wird wiederhergestellt…","connection.reconnected":"Wieder verbunden!","connection.pairing":"Gerätekopplung ausstehend — führen Sie `openclaw devices approve` auf Ihrem Gateway aus","message.copy":"Nachricht kopieren","message.copied":"Kopiert!","message.retry":"Nachricht erneut senden","message.showMore":"Mehr anzeigen","message.showLess":"Weniger anzeigen","message.metadata":"Nachrichtendetails","message.rawJson":"Roh-JSON","message.hideRawJson":"Roh-JSON ausblenden","time.yesterday":"Gestern","time.today":"Heute","shortcuts.title":"Tastenkürzel","shortcuts.send":"Nachricht senden","shortcuts.newline":"Neue Zeile","shortcuts.search":"Sitzungen suchen","shortcuts.switchSession":"Vorherige / nächste Sitzung","shortcuts.closeSidebar":"Seitenleiste / Suche schließen","shortcuts.stop":"Generierung stoppen","shortcuts.help":"Tastenkürzel anzeigen","shortcuts.close":"Schließen","shortcuts.chatSection":"Chat","error.title":"Etwas ist schiefgelaufen","error.description":"Beim Rendern der Oberfläche ist ein unerwarteter Fehler aufgetreten. Du kannst es erneut versuchen oder die Seite neu laden.","error.retry":"Erneut versuchen","error.reload":"Seite neu laden","shortcuts.navigationSection":"Navigation","shortcuts.generalSection":"Allgemein","header.export":"Unterhaltung als Markdown exportieren","header.compact":"Kompaktieren","header.compacting":"Kompaktiere…","header.sessionInfo":"Sitzungsinfo","sessionInfo.sessionKey":"Sitzungsschlüssel","sessionInfo.channel":"Kanal","sessionInfo.kind":"Typ","sessionInfo.model":"Modell","sessionInfo.agent":"Agent","sessionInfo.messages":"Nachrichten","sessionInfo.totalTokens":"Tokens gesamt","sessionInfo.inputTokens":"Eingabe","sessionInfo.outputTokens":"Ausgabe","sessionInfo.contextWindow":"Kontext","sessionInfo.lastActive":"Letzte Aktivität","theme.title":"Design","theme.mode":"Modus","theme.accent":"Akzent","theme.system":"System","theme.dark":"Dunkel","theme.light":"Hell","theme.oled":"OLED","search.placeholder":"In Nachrichten suchen…","search.noResults":"0 Ergebnisse","search.prev":"Vorheriger Treffer","search.next":"Nächster Treffer","shortcuts.searchMessages":"In Nachrichten suchen","settings.title":"Einstellungen","settings.appearance":"Darstellung","settings.chat":"Chat","settings.notifications":"Benachrichtigungen","settings.notificationSound":"Benachrichtigungston","settings.language":"Sprache","settings.sendShortcut":"Senden mit","settings.sendEnter":"Enter","settings.sendCtrlEnter":"Strg+Enter","message.bookmark":"Nachricht markieren","message.reply":"Antworten","chat.replyingTo":"Antwort auf","message.removeBookmark":"Lesezeichen entfernen","chat.bookmarks":"Lesezeichen","chat.export":"Unterhaltung exportieren","chat.contextCompacted":"Kontext kompaktiert — ältere Nachrichten lokal zwischengespeichert","slash.commands":"Befehle","slash.status":"Sitzungsstatus und Nutzung anzeigen","slash.reasoning":"Reasoning-Modus umschalten","slash.verbose":"Ausführliche Ausgabe umschalten","slash.model":"Modell für diese Sitzung wechseln","slash.compact":"Gesprächskontext kompaktieren","slash.reset":"Sitzung zurücksetzen","slash.help":"Verfügbare Befehle anzeigen"},Us={"login.title":"StartLobster Chat","login.subtitle":"OpenClawゲートウェイに接続","login.gatewayUrl":"ゲートウェイURL","login.token":"トークン","login.tokenPlaceholder":"ゲートウェイトークンを入力","login.connect":"接続","login.connecting":"接続中…","login.showToken":"トークンを表示","login.hideToken":"トークンを非表示","login.storedLocally":"認証情報はブラウザにローカル保存されます","login.wsHint":"URLはws://またはwss://で始まる必要があります","header.title":"StartLobster","header.connected":"接続済み","header.disconnected":"切断","header.logout":"ログアウト","header.toggleSidebar":"サイドバーの表示切替","header.changeLanguage":"言語を変更","header.soundOn":"通知音を有効にする","header.soundOff":"通知音を無効にする","chat.welcome":"StartLobster Chat","chat.welcomeSub":"メッセージを送信して始めましょう","chat.suggestions":"例えば…","chat.suggestion1":"最近のメールをまとめて","chat.suggestion2":"今日のカレンダーは？","chat.suggestion3":"最新ニュースをウェブで検索して","chat.suggestion4":"スクリプトを書くのを手伝って","chat.loadingHistory":"メッセージを読み込み中…","chat.inputPlaceholder":"メッセージを入力…","chat.inputLabel":"メッセージ","chat.attachFile":"ファイルを添付","chat.send":"送信","chat.stop":"停止","chat.showPreview":"Markdownプレビュー","chat.hidePreview":"プレビューを非表示","chat.scrollToBottom":"新しいメッセージ","chat.scrollDown":"一番下へスクロール","chat.collapseTools":"すべてのツールを折りたたむ","chat.expandTools":"すべてのツールを展開","chat.messages":"チャットメッセージ","chat.thinking":"思考中…","sidebar.title":"セッション","sidebar.empty":"セッションなし","sidebar.search":"セッションを検索…","sidebar.noResults":"結果なし","sidebar.pin":"セッションをピン留め","sidebar.unpin":"ピン留めを解除","sidebar.pinned":"ピン留め","sidebar.delete":"セッションを削除","sidebar.rename":"セッション名変更","sidebar.deleteConfirm":"このセッションを削除しますか？元に戻せません。","sidebar.deleteCancel":"キャンセル","sidebar.openSplit":"分割ビューで開く","sidebar.close":"サイドバーを閉じる","sidebar.clearSearch":"検索をクリア","sidebar.filterAll":"すべて","sidebar.filterActive":"アクティブ","split.close":"分割ビューを閉じる","app.mainChat":"メインチャット","app.splitPane":"分割ペイン","app.skipToChat":"入力欄へ移動","thinking.label":"思考","thinking.reasoning":"推論中…","tool.parameters":"パラメータ","tool.result":"結果","connection.reconnecting":"接続が切断されました — 再接続中…","connection.reconnected":"再接続しました！","connection.pairing":"デバイスペアリング保留中 — ゲートウェイで `openclaw devices approve` を実行してください","message.copy":"メッセージをコピー","message.copied":"コピーしました！","message.retry":"メッセージを再送信","message.showMore":"もっと見る","message.showLess":"折りたたむ","message.metadata":"メッセージの詳細","message.rawJson":"生JSON","message.hideRawJson":"生JSONを非表示","time.yesterday":"昨日","time.today":"今日","shortcuts.title":"キーボードショートカット","shortcuts.send":"メッセージを送信","shortcuts.newline":"改行","shortcuts.search":"セッションを検索","shortcuts.switchSession":"前 / 次のセッション","shortcuts.closeSidebar":"サイドバー / 検索を閉じる","shortcuts.stop":"生成を停止","shortcuts.help":"ショートカットを表示","shortcuts.close":"閉じる","shortcuts.chatSection":"チャット","error.title":"エラーが発生しました","error.description":"インターフェースの表示中に予期しないエラーが発生しました。再試行するかページをリロードしてください。","error.retry":"再試行","error.reload":"ページをリロード","shortcuts.navigationSection":"ナビゲーション","shortcuts.generalSection":"全般","header.export":"会話をMarkdownでエクスポート","header.compact":"コンパクト化","header.compacting":"コンパクト化中…","header.sessionInfo":"セッション情報","sessionInfo.sessionKey":"セッションキー","sessionInfo.channel":"チャンネル","sessionInfo.kind":"種類","sessionInfo.model":"モデル","sessionInfo.agent":"エージェント","sessionInfo.messages":"メッセージ","sessionInfo.totalTokens":"合計トークン","sessionInfo.inputTokens":"入力","sessionInfo.outputTokens":"出力","sessionInfo.contextWindow":"コンテキスト","sessionInfo.lastActive":"最終アクティブ","theme.title":"テーマ","theme.mode":"モード","theme.accent":"アクセント","theme.system":"システム","theme.dark":"ダーク","theme.light":"ライト","theme.oled":"OLED","search.placeholder":"メッセージを検索…","search.noResults":"0件","search.prev":"前の結果","search.next":"次の結果","shortcuts.searchMessages":"メッセージを検索","settings.title":"設定","settings.appearance":"外観","settings.chat":"チャット","settings.notifications":"通知","settings.notificationSound":"通知音","settings.language":"言語","settings.sendShortcut":"送信キー","settings.sendEnter":"Enter","settings.sendCtrlEnter":"Ctrl+Enter","message.bookmark":"メッセージをブックマーク","message.reply":"返信","chat.replyingTo":"返信先","message.removeBookmark":"ブックマークを削除","chat.bookmarks":"ブックマーク","chat.export":"会話をエクスポート","chat.contextCompacted":"コンテキストがコンパクト化されました — 古いメッセージはローカルキャッシュに保存","slash.commands":"コマンド","slash.status":"セッションのステータスと使用量を表示","slash.reasoning":"推論モードの切替","slash.verbose":"詳細出力の切替","slash.model":"このセッションのモデルを変更","slash.compact":"会話コンテキストをコンパクト化","slash.reset":"セッションをリセット","slash.help":"利用可能なコマンドを表示"},Ks={"login.title":"StartLobster Chat","login.subtitle":"Conectar ao seu gateway OpenClaw","login.gatewayUrl":"URL do Gateway","login.token":"Token","login.tokenPlaceholder":"Insira o token do gateway","login.connect":"Conectar","login.connecting":"Conectando…","login.showToken":"Mostrar token","login.hideToken":"Ocultar token","login.storedLocally":"As credenciais são armazenadas localmente no navegador","login.wsHint":"A URL deve começar com ws:// ou wss://","header.title":"StartLobster","header.connected":"Conectado","header.disconnected":"Desconectado","header.logout":"Sair","header.toggleSidebar":"Alternar barra lateral","header.changeLanguage":"Alterar idioma","header.soundOn":"Ativar som de notificação","header.soundOff":"Desativar som de notificação","chat.welcome":"StartLobster Chat","chat.welcomeSub":"Envie uma mensagem para começar","chat.suggestions":"Tente perguntar…","chat.suggestion1":"Resuma meus e-mails recentes","chat.suggestion2":"O que há na minha agenda hoje?","chat.suggestion3":"Pesquise na web as últimas notícias","chat.suggestion4":"Ajude-me a escrever um script","chat.loadingHistory":"Carregando mensagens…","chat.inputPlaceholder":"Digite uma mensagem…","chat.inputLabel":"Mensagem","chat.attachFile":"Anexar arquivo","chat.send":"Enviar","chat.stop":"Parar","chat.showPreview":"Pré-visualizar markdown","chat.hidePreview":"Ocultar pré-visualização","chat.scrollToBottom":"Novas mensagens","chat.scrollDown":"Rolar para baixo","chat.collapseTools":"Recolher todas as ferramentas","chat.expandTools":"Expandir todas as ferramentas","chat.messages":"Mensagens do chat","chat.thinking":"Pensando…","sidebar.title":"Sessões","sidebar.empty":"Nenhuma sessão","sidebar.search":"Pesquisar sessões…","sidebar.noResults":"Nenhuma sessão encontrada","sidebar.pin":"Fixar sessão","sidebar.unpin":"Desafixar sessão","sidebar.pinned":"Fixada","sidebar.delete":"Excluir sessão","sidebar.rename":"Renomear sessão","sidebar.deleteConfirm":"Excluir esta sessão? Esta ação não pode ser desfeita.","sidebar.deleteCancel":"Cancelar","sidebar.openSplit":"Abrir em visualização dividida","sidebar.close":"Fechar barra lateral","sidebar.clearSearch":"Limpar pesquisa","sidebar.filterAll":"Todas","sidebar.filterActive":"Ativas","split.close":"Fechar visualização dividida","app.mainChat":"Chat principal","app.splitPane":"Painel dividido","app.skipToChat":"Ir para o campo de entrada","thinking.label":"Pensamento","thinking.reasoning":"Raciocinando…","tool.parameters":"Parâmetros","tool.result":"Resultado","connection.reconnecting":"Conexão perdida — reconectando…","connection.reconnected":"Reconectado!","connection.pairing":"Emparelhamento pendente — execute `openclaw devices approve` no seu gateway","message.copy":"Copiar mensagem","message.copied":"Copiado!","message.retry":"Reenviar mensagem","message.showMore":"Ver mais","message.showLess":"Ver menos","message.metadata":"Detalhes da mensagem","message.rawJson":"JSON bruto","message.hideRawJson":"Ocultar JSON bruto","time.yesterday":"Ontem","time.today":"Hoje","shortcuts.title":"Atalhos de teclado","shortcuts.send":"Enviar mensagem","shortcuts.newline":"Nova linha","shortcuts.search":"Pesquisar sessões","shortcuts.switchSession":"Sessão anterior / próxima","shortcuts.closeSidebar":"Fechar barra lateral / pesquisa","shortcuts.stop":"Parar geração","shortcuts.help":"Mostrar atalhos","shortcuts.close":"Fechar","shortcuts.chatSection":"Chat","error.title":"Algo deu errado","error.description":"Ocorreu um erro inesperado ao renderizar a interface. Tente novamente ou recarregue a página.","error.retry":"Tentar novamente","error.reload":"Recarregar página","shortcuts.navigationSection":"Navegação","shortcuts.generalSection":"Geral","header.export":"Exportar conversa em Markdown","header.compact":"Compactar","header.compacting":"Compactando…","header.sessionInfo":"Informações da sessão","sessionInfo.sessionKey":"Chave da sessão","sessionInfo.channel":"Canal","sessionInfo.kind":"Tipo","sessionInfo.model":"Modelo","sessionInfo.agent":"Agente","sessionInfo.messages":"Mensagens","sessionInfo.totalTokens":"Total de tokens","sessionInfo.inputTokens":"Entrada","sessionInfo.outputTokens":"Saída","sessionInfo.contextWindow":"Contexto","sessionInfo.lastActive":"Última atividade","theme.title":"Tema","theme.mode":"Modo","theme.accent":"Cor de destaque","theme.system":"Sistema","theme.dark":"Escuro","theme.light":"Claro","theme.oled":"OLED","search.placeholder":"Pesquisar mensagens…","search.noResults":"0 resultados","search.prev":"Resultado anterior","search.next":"Próximo resultado","shortcuts.searchMessages":"Pesquisar mensagens","settings.title":"Configurações","settings.appearance":"Aparência","settings.chat":"Chat","settings.notifications":"Notificações","settings.notificationSound":"Som de notificação","settings.language":"Idioma","settings.sendShortcut":"Tecla de envio","settings.sendEnter":"Enter","settings.sendCtrlEnter":"Ctrl+Enter","message.bookmark":"Marcar mensagem","message.reply":"Responder","chat.replyingTo":"Respondendo a","message.removeBookmark":"Remover marcador","chat.bookmarks":"Marcadores","chat.export":"Exportar conversa","chat.contextCompacted":"Contexto compactado — mensagens antigas salvas no cache local","slash.commands":"Comandos","slash.status":"Mostrar status e uso da sessão","slash.reasoning":"Alternar modo de raciocínio","slash.verbose":"Alternar saída detalhada","slash.model":"Alterar modelo desta sessão","slash.compact":"Compactar contexto da conversa","slash.reset":"Redefinir sessão","slash.help":"Mostrar comandos disponíveis"},Fs={"login.title":"StartLobster Chat","login.subtitle":"连接到您的 OpenClaw 网关","login.gatewayUrl":"网关地址","login.token":"令牌","login.tokenPlaceholder":"输入网关令牌","login.connect":"连接","login.connecting":"连接中…","login.showToken":"显示令牌","login.hideToken":"隐藏令牌","login.storedLocally":"凭据仅存储在浏览器本地","login.wsHint":"地址必须以 ws:// 或 wss:// 开头","header.title":"StartLobster","header.connected":"已连接","header.disconnected":"未连接","header.logout":"退出","header.toggleSidebar":"切换侧边栏","header.changeLanguage":"切换语言","header.soundOn":"开启通知音","header.soundOff":"关闭通知音","chat.welcome":"StartLobster Chat","chat.welcomeSub":"发送消息开始对话","chat.suggestions":"试试问…","chat.suggestion1":"总结我最近的邮件","chat.suggestion2":"今天的日程安排是什么？","chat.suggestion3":"搜索最新新闻","chat.suggestion4":"帮我写一个脚本","chat.loadingHistory":"加载消息中…","chat.inputPlaceholder":"输入消息…","chat.inputLabel":"消息","chat.attachFile":"添加附件","chat.send":"发送","chat.stop":"停止","chat.showPreview":"预览 Markdown","chat.hidePreview":"隐藏预览","chat.scrollToBottom":"新消息","chat.scrollDown":"滚动到底部","chat.collapseTools":"折叠所有工具","chat.expandTools":"展开所有工具","chat.messages":"聊天消息","chat.thinking":"思考中…","sidebar.title":"会话","sidebar.empty":"没有会话","sidebar.search":"搜索会话…","sidebar.noResults":"未找到匹配会话","sidebar.pin":"置顶会话","sidebar.unpin":"取消置顶","sidebar.pinned":"已置顶","sidebar.delete":"删除会话","sidebar.rename":"重命名会话","sidebar.deleteConfirm":"删除此会话？此操作无法撤消。","sidebar.deleteCancel":"取消","sidebar.openSplit":"在分屏中打开","sidebar.close":"关闭侧边栏","sidebar.clearSearch":"清除搜索","sidebar.filterAll":"全部","sidebar.filterActive":"活跃","split.close":"关闭分屏","app.mainChat":"主聊天","app.splitPane":"分屏面板","app.skipToChat":"跳转到输入框","thinking.label":"思考","thinking.reasoning":"推理中…","tool.parameters":"参数","tool.result":"结果","connection.reconnecting":"连接中断 — 正在重连…","connection.reconnected":"已重新连接！","connection.pairing":"设备配对待处理 — 在网关上运行 `openclaw devices approve`","message.copy":"复制消息","message.copied":"已复制！","message.retry":"重新发送","message.showMore":"展开更多","message.showLess":"收起","message.metadata":"消息详情","message.rawJson":"原始 JSON","message.hideRawJson":"隐藏原始 JSON","time.yesterday":"昨天","time.today":"今天","shortcuts.title":"键盘快捷键","shortcuts.send":"发送消息","shortcuts.newline":"换行","shortcuts.search":"搜索会话","shortcuts.switchSession":"上一个 / 下一个会话","shortcuts.closeSidebar":"关闭侧边栏 / 搜索","shortcuts.stop":"停止生成","shortcuts.help":"显示快捷键","shortcuts.close":"关闭","shortcuts.chatSection":"聊天","error.title":"出错了","error.description":"渲染界面时发生意外错误。您可以重试或刷新页面。","error.retry":"重试","error.reload":"刷新页面","shortcuts.navigationSection":"导航","shortcuts.generalSection":"通用","header.export":"导出会话为 Markdown","header.compact":"压缩","header.compacting":"压缩中…","header.sessionInfo":"会话信息","sessionInfo.sessionKey":"会话密钥","sessionInfo.channel":"频道","sessionInfo.kind":"类型","sessionInfo.model":"模型","sessionInfo.agent":"智能体","sessionInfo.messages":"消息数","sessionInfo.totalTokens":"总令牌数","sessionInfo.inputTokens":"输入","sessionInfo.outputTokens":"输出","sessionInfo.contextWindow":"上下文","sessionInfo.lastActive":"最后活跃","theme.title":"主题","theme.mode":"模式","theme.accent":"强调色","theme.system":"跟随系统","theme.dark":"深色","theme.light":"浅色","theme.oled":"OLED","search.placeholder":"搜索消息…","search.noResults":"无结果","search.prev":"上一个","search.next":"下一个","shortcuts.searchMessages":"搜索消息","settings.title":"设置","settings.appearance":"外观","settings.chat":"聊天","settings.notifications":"通知","settings.notificationSound":"通知声音","settings.language":"语言","settings.sendShortcut":"发送方式","settings.sendEnter":"Enter","settings.sendCtrlEnter":"Ctrl+Enter","message.bookmark":"收藏消息","message.reply":"回复","chat.replyingTo":"回复","message.removeBookmark":"取消收藏","chat.bookmarks":"收藏","chat.export":"导出会话","chat.contextCompacted":"上下文已压缩 — 旧消息已缓存到本地","slash.commands":"命令","slash.status":"显示会话状态和用量","slash.reasoning":"切换推理模式","slash.verbose":"切换详细输出","slash.model":"切换当前会话模型","slash.compact":"压缩会话上下文","slash.reset":"重置会话","slash.help":"显示可用命令"},Bs={"login.title":"StartLobster Chat","login.subtitle":"Connettiti al tuo gateway OpenClaw","login.gatewayUrl":"URL del Gateway","login.token":"Token","login.tokenPlaceholder":"Inserisci il token del gateway","login.connect":"Connetti","login.connecting":"Connessione…","login.showToken":"Mostra token","login.hideToken":"Nascondi token","login.storedLocally":"Le credenziali vengono salvate localmente nel browser","login.wsHint":"L'URL deve iniziare con ws:// o wss://","header.title":"StartLobster","header.connected":"Connesso","header.disconnected":"Disconnesso","header.logout":"Esci","header.toggleSidebar":"Mostra/nascondi barra laterale","header.changeLanguage":"Cambia lingua","header.soundOn":"Attiva suono notifiche","header.soundOff":"Disattiva suono notifiche","chat.welcome":"StartLobster Chat","chat.welcomeSub":"Invia un messaggio per iniziare","chat.suggestions":"Prova a chiedere…","chat.suggestion1":"Riassumi le mie ultime email","chat.suggestion2":"Cosa c'è nel mio calendario oggi?","chat.suggestion3":"Cerca sul web le ultime notizie","chat.suggestion4":"Aiutami a scrivere uno script","chat.loadingHistory":"Caricamento messaggi…","chat.inputPlaceholder":"Scrivi un messaggio…","chat.inputLabel":"Messaggio","chat.attachFile":"Allega file","chat.send":"Invia","chat.stop":"Ferma","chat.showPreview":"Anteprima markdown","chat.hidePreview":"Nascondi anteprima","chat.scrollToBottom":"Nuovi messaggi","chat.scrollDown":"Scorri in fondo","chat.collapseTools":"Comprimi tutti gli strumenti","chat.expandTools":"Espandi tutti gli strumenti","chat.messages":"Messaggi della chat","chat.thinking":"Sto pensando…","sidebar.title":"Sessioni","sidebar.empty":"Nessuna sessione","sidebar.search":"Cerca sessioni…","sidebar.noResults":"Nessun risultato","sidebar.pin":"Fissa sessione","sidebar.unpin":"Sgancia sessione","sidebar.pinned":"Fissate","sidebar.delete":"Elimina sessione","sidebar.rename":"Rinomina sessione","sidebar.deleteConfirm":"Eliminare questa sessione? L'azione è irreversibile.","sidebar.deleteCancel":"Annulla","sidebar.openSplit":"Apri in vista divisa","sidebar.close":"Chiudi barra laterale","sidebar.clearSearch":"Cancella ricerca","sidebar.filterAll":"Tutte","sidebar.filterActive":"Attive","split.close":"Chiudi vista divisa","app.mainChat":"Chat principale","app.splitPane":"Pannello diviso","app.skipToChat":"Vai al campo di input","thinking.label":"Pensiero","thinking.reasoning":"Ragionamento…","tool.parameters":"Parametri","tool.result":"Risultato","connection.reconnecting":"Connessione persa — riconnessione…","connection.reconnected":"Riconnesso!","connection.pairing":"Accoppiamento dispositivo in attesa — esegui `openclaw devices approve` sul tuo gateway","message.copy":"Copia messaggio","message.copied":"Copiato!","message.retry":"Reinvia messaggio","message.showMore":"Mostra di più","message.showLess":"Mostra meno","message.metadata":"Dettagli messaggio","message.rawJson":"JSON grezzo","message.hideRawJson":"Nascondi JSON grezzo","time.yesterday":"Ieri","time.today":"Oggi","shortcuts.title":"Scorciatoie da tastiera","shortcuts.send":"Invia messaggio","shortcuts.newline":"Nuova riga","shortcuts.search":"Cerca sessioni","shortcuts.switchSession":"Sessione precedente / successiva","shortcuts.closeSidebar":"Chiudi barra laterale / ricerca","shortcuts.stop":"Ferma generazione","shortcuts.help":"Mostra scorciatoie","shortcuts.close":"Chiudi","shortcuts.chatSection":"Chat","error.title":"Qualcosa è andato storto","error.description":"Si è verificato un errore imprevisto durante il rendering dell'interfaccia. Puoi riprovare o ricaricare la pagina.","error.retry":"Riprova","error.reload":"Ricarica pagina","shortcuts.navigationSection":"Navigazione","shortcuts.generalSection":"Generale","header.export":"Esporta conversazione in Markdown","header.compact":"Compatta","header.compacting":"Compattamento…","header.sessionInfo":"Info sessione","sessionInfo.sessionKey":"Chiave sessione","sessionInfo.channel":"Canale","sessionInfo.kind":"Tipo","sessionInfo.model":"Modello","sessionInfo.agent":"Agente","sessionInfo.messages":"Messaggi","sessionInfo.totalTokens":"Token totali","sessionInfo.inputTokens":"Input","sessionInfo.outputTokens":"Output","sessionInfo.contextWindow":"Contesto","sessionInfo.lastActive":"Ultima attività","theme.title":"Tema","theme.mode":"Modalità","theme.accent":"Accento","theme.system":"Sistema","theme.dark":"Scuro","theme.light":"Chiaro","theme.oled":"OLED","search.placeholder":"Cerca nei messaggi…","search.noResults":"0 risultati","search.prev":"Risultato precedente","search.next":"Risultato successivo","shortcuts.searchMessages":"Cerca nei messaggi","settings.title":"Impostazioni","settings.appearance":"Aspetto","settings.chat":"Chat","settings.notifications":"Notifiche","settings.notificationSound":"Suono di notifica","settings.language":"Lingua","settings.sendShortcut":"Invia con","settings.sendEnter":"Invio","settings.sendCtrlEnter":"Ctrl+Invio","message.bookmark":"Aggiungi ai segnalibri","message.reply":"Rispondi","chat.replyingTo":"In risposta a","message.removeBookmark":"Rimuovi segnalibro","chat.bookmarks":"Segnalibri","chat.export":"Esporta conversazione","chat.contextCompacted":"Contesto compattato — messaggi precedenti nella cache locale","slash.commands":"Comandi","slash.status":"Mostra stato e utilizzo della sessione","slash.reasoning":"Attiva/disattiva ragionamento","slash.verbose":"Attiva/disattiva output dettagliato","slash.model":"Cambia modello per questa sessione","slash.compact":"Compatta il contesto della conversazione","slash.reset":"Reimposta sessione","slash.help":"Mostra comandi disponibili"},he={en:Os,fr:zs,es:_s,de:$s,ja:Us,pt:Ks,zh:Fs,it:Bs},Hs=Object.keys(he),Js={en:"EN",fr:"FR",es:"ES",de:"DE",ja:"JA",pt:"PT",zh:"中文",it:"IT"};function qs(){try{const t=localStorage.getItem(yt);if(t&&he[t])return t}catch{}if(typeof navigator<"u"){const t=navigator.language?.split("-")[0];if(t&&he[t])return t}return"en"}let Ce=qs(),wt=he[Ce]||he.en;try{document.documentElement.lang=Ce}catch{}const Ue=new Set;function Ws(t){return Ue.add(t),()=>Ue.delete(t)}function nt(){return Ce}function Vs(t){if(!(!he[t]||t===Ce)){Ce=t,wt=he[t];try{localStorage.setItem(yt,t)}catch{}try{document.documentElement.lang=t}catch{}Ue.forEach(s=>s())}}function ke(t){return wt[t]??he.en[t]??t}function kt(){return o.useSyncExternalStore(Ws,nt,nt)}function le(){return kt(),ke}const St=o.createContext({theme:"dark",accent:"cyan",resolvedTheme:"dark",setTheme:()=>{},setAccent:()=>{}}),Gs=()=>o.useContext(St),at="startlobster-send-on-enter";function Ct(){const[t,s]=o.useState(()=>{const a=localStorage.getItem(at);return a===null?!0:a==="true"}),n=o.useCallback(()=>{s(a=>{const r=!a;return localStorage.setItem(at,String(r)),r})},[]);return{sendOnEnter:t,toggle:n}}const Ys=[{value:"system",icon:Mt,labelKey:"theme.system"},{value:"dark",icon:Pt,labelKey:"theme.dark"},{value:"light",icon:Dt,labelKey:"theme.light"},{value:"oled",icon:Ot,labelKey:"theme.oled"}],Xs=[{value:"cyan",color:"#22d3ee"},{value:"violet",color:"#8b5cf6"},{value:"emerald",color:"#10b981"},{value:"amber",color:"#f59e0b"},{value:"rose",color:"#f43f5e"},{value:"blue",color:"#3b82f6"}],Zs=typeof navigator<"u"&&/Mac|iPod|iPhone|iPad/.test(navigator.userAgent);function Ne({children:t}){return e.jsx("div",{className:"text-[10px] uppercase tracking-wider text-pc-text-faint font-semibold mt-5 mb-2 first:mt-0",children:t})}function Qs({checked:t,onChange:s,label:n}){return e.jsx("button",{role:"switch","aria-checked":t,"aria-label":n,onClick:s,className:`relative inline-flex h-5 w-9 shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-pc-accent/50 ${t?"bg-pc-accent":"bg-pc-border-strong"}`,children:e.jsx("span",{className:`pointer-events-none inline-block h-4 w-4 transform rounded-full bg-white shadow-sm ring-0 transition duration-200 ease-in-out ${t?"translate-x-4":"translate-x-0"}`})})}function en({open:t,onClose:s,soundEnabled:n,onToggleSound:a}){const r=le(),{theme:h,accent:c,setTheme:l,setAccent:p}=Gs(),{sendOnEnter:d,toggle:g}=Ct(),C=kt();return o.useEffect(()=>{if(!t)return;const f=$=>{$.key==="Escape"&&s()};return window.addEventListener("keydown",f),()=>window.removeEventListener("keydown",f)},[t,s]),t?e.jsxs("div",{role:"dialog","aria-modal":"true","aria-label":r("settings.title"),className:"fixed inset-0 z-50 flex items-center justify-center",onClick:s,children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm"}),e.jsxs("div",{className:"relative w-full max-w-sm mx-4 rounded-3xl border border-pc-border bg-[var(--pc-bg-base)]/95 backdrop-blur-xl shadow-2xl animate-fade-in",onClick:f=>f.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-pc-border",children:[e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx(ut,{size:18,className:"text-pc-accent-light/70"}),e.jsx("h2",{className:"text-sm font-semibold text-pc-text",children:r("settings.title")})]}),e.jsx("button",{onClick:s,className:"h-8 w-8 rounded-xl flex items-center justify-center text-pc-text-muted hover:text-pc-text hover:bg-[var(--pc-hover)] transition-colors","aria-label":"Close",children:e.jsx(Se,{size:16})})]}),e.jsxs("div",{className:"px-6 py-4 max-h-[60vh] overflow-y-auto",children:[e.jsx(Ne,{children:r("settings.appearance")}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"text-xs text-pc-text-secondary mb-2",children:r("theme.mode")}),e.jsx("div",{className:"flex gap-1.5",children:Ys.map(f=>{const $=f.icon,L=h===f.value;return e.jsxs("button",{onClick:()=>l(f.value),"aria-pressed":L,className:`flex-1 flex flex-col items-center gap-1 py-2 rounded-xl border text-xs transition-all ${L?"border-pc-accent/40 bg-pc-accent/10 text-pc-accent-light":"border-pc-border text-pc-text-muted hover:bg-[var(--pc-hover)]"}`,children:[e.jsx($,{size:16}),e.jsx("span",{children:r(f.labelKey)})]},f.value)})})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx("div",{className:"text-xs text-pc-text-secondary mb-2",children:r("theme.accent")}),e.jsx("div",{className:"flex gap-2",children:Xs.map(f=>e.jsx("button",{onClick:()=>p(f.value),className:"relative h-7 w-7 rounded-full border-2 transition-all flex items-center justify-center","aria-pressed":c===f.value,"aria-label":`${f.value} accent`,style:{backgroundColor:f.color,borderColor:c===f.value?f.color:"transparent",boxShadow:c===f.value?`0 0 8px ${f.color}40`:"none"},title:f.value,children:c===f.value&&e.jsx(_e,{size:14,className:"text-white drop-shadow"})},f.value))})]}),e.jsx(Ne,{children:r("settings.language")}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:Hs.map(f=>e.jsxs("button",{onClick:()=>Vs(f),"aria-pressed":C===f,className:`flex items-center gap-1.5 px-3 py-1.5 rounded-xl border text-xs transition-all ${C===f?"border-pc-accent/40 bg-pc-accent/10 text-pc-accent-light font-medium":"border-pc-border text-pc-text-muted hover:bg-[var(--pc-hover)]"}`,children:[C===f&&e.jsx(_e,{size:12}),Js[f]||f.toUpperCase()]},f))}),e.jsx(Ne,{children:r("settings.chat")}),e.jsxs("div",{className:"flex items-center justify-between py-1.5",children:[e.jsx("div",{className:"text-xs text-pc-text-secondary",children:r("settings.sendShortcut")}),e.jsx("button",{onClick:g,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-xl border border-pc-border text-xs text-pc-text-secondary hover:bg-[var(--pc-hover)] transition-colors",children:d?r("settings.sendEnter"):(Zs?"⌘+":"Ctrl+")+r("settings.sendEnter")})]}),a&&e.jsxs(e.Fragment,{children:[e.jsx(Ne,{children:r("settings.notifications")}),e.jsxs("div",{className:"flex items-center justify-between py-1.5",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-pc-text-secondary",children:[n?e.jsx(zt,{size:14}):e.jsx(_t,{size:14}),r("settings.notificationSound")]}),e.jsx(Qs,{checked:!!n,onChange:a,label:r("settings.notificationSound")})]})]})]})]})]}):null}async function tn(t){if(navigator.clipboard?.writeText)try{return await navigator.clipboard.writeText(t),!0}catch{}try{const s=document.createElement("textarea");s.value=t,s.style.position="fixed",s.style.left="-9999px",s.style.top="-9999px",s.style.opacity="0",document.body.appendChild(s),s.focus(),s.select();const n=document.execCommand("copy");return document.body.removeChild(s),n}catch{return!1}}function ve(t){if(t.label)return t.label;const s=t.kind,n=t.channel;return s==="main"?n?`Main · ${Ee(n)}`:"Main":s==="cron"?n?`Cron · ${Ee(n)}`:"Cron":s==="isolated"?n?`Task · ${Ee(n)}`:"Task":n?Ee(n):sn(t.key)}function Ee(t){return t.charAt(0).toUpperCase()+t.slice(1)}function sn(t){const s=t.replace(/^agent:[^:]+:/,"");return/^[0-9a-f]{8}-[0-9a-f]{4}-/.test(s)?s.slice(0,8)+"…":s}function nn(t,s){const n=[];s&&n.push(`# ${s}`,"");const a=new Date().toISOString().replace("T"," ").replace(/\.\d+Z$/," UTC");n.push(`> Exported from StartLobster Chat on ${a}`,"");for(const r of t){const h=new Date(r.timestamp).toLocaleString("en-US",{dateStyle:"medium",timeStyle:"short"}),c=r.role==="user"?r.isSystemEvent?"⚙️ System Event":"👤 User":"🤖 Assistant";if(n.push(`## ${c} — ${h}`,""),r.blocks&&r.blocks.length>0)for(const l of r.blocks)switch(l.type){case"text":n.push(l.text,"");break;case"thinking":n.push("<details><summary>💭 Thinking</summary>","",l.text,"","</details>","");break;case"tool_use":n.push(`**🔧 Tool: \`${l.name}\`**`,""),l.input&&Object.keys(l.input).length>0&&n.push("```json",JSON.stringify(l.input,null,2),"```","");break;case"tool_result":if(l.content){const p=l.name?`Result (${l.name})`:"Result";n.push(`<details><summary>📋 ${p}</summary>`,""),n.push("```",l.content.slice(0,5e3),"```",""),n.push("</details>","")}break;case"image":n.push("*[Image]*","");break}else r.content&&n.push(r.content,"");n.push("---","")}return n.join(`
`)}function an(t,s,n="text/markdown"){const a=new Blob([t],{type:n}),r=URL.createObjectURL(a),h=document.createElement("a");h.href=r,h.download=s,document.body.appendChild(h),h.click(),document.body.removeChild(h),URL.revokeObjectURL(r)}function rn({status:t,sessionKey:s,onToggleSidebar:n,activeSessionData:a,onLogout:r,soundEnabled:h,onToggleSound:c,messages:l,agentAvatarUrl:p,agentName:d,onCompact:g}){const C=le(),f=a?ve(a):s.split(":").pop()||s,[$,L]=o.useState(!1),[K,T]=o.useState(!1),q=o.useRef(null),M=o.useRef(null);o.useEffect(()=>{if(!$)return;const y=E=>{const w=E.target;q.current&&!q.current.contains(w)&&M.current&&!M.current.contains(w)&&L(!1)};return document.addEventListener("mousedown",y),()=>document.removeEventListener("mousedown",y)},[$]);const N=o.useCallback(()=>{if(!l||l.length===0)return;const y=nn(l,f),E=f.replace(/[^a-zA-Z0-9_-]/g,"_").slice(0,50),w=new Date().toISOString().slice(0,10);an(y,`${E}_${w}.md`)},[l,f]);return e.jsxs(e.Fragment,{children:[e.jsxs("header",{className:"h-14 border-b border-pc-border bg-[var(--pc-bg-surface)]/90 backdrop-blur-xl flex items-center px-4 gap-3 shrink-0",role:"banner",children:[e.jsx("button",{onClick:n,"aria-label":C("header.toggleSidebar"),className:"lg:hidden p-2 rounded-2xl hover:bg-[var(--pc-hover)] text-pc-text-secondary transition-colors",children:e.jsx(Ut,{size:20})}),e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0 relative",ref:q,children:[e.jsx("img",{src:p||"/logo.png",alt:"StartLobster Chat",className:"h-9 w-9 rounded-2xl object-cover",onError:y=>{const E=y.target;E.src!==window.location.origin+"/logo.png"?E.src="/logo.png":E.style.display="none"}}),e.jsxs("button",{className:"min-w-0 text-left group",onClick:()=>L(y=>!y),title:C("header.sessionInfo"),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-pc-text text-sm tracking-wide",children:d||C("header.title")}),e.jsx(ht,{className:"h-3.5 w-3.5 text-pc-accent-light/60"})]}),e.jsxs("span",{className:"text-xs text-pc-text-muted truncate flex items-center gap-1.5",children:[a?.agentId&&e.jsxs("span",{className:"inline-flex items-center gap-0.5 text-pc-accent/70 font-medium",children:[e.jsx(Je,{className:"h-3 w-3"}),a.agentId,e.jsx("span",{className:"text-pc-text-faint mx-0.5",children:"·"})]}),f,e.jsx(Kt,{className:"h-3 w-3 text-pc-text-faint opacity-0 group-hover:opacity-100 transition-opacity"})]})]}),$&&a&&e.jsx(cn,{ref:M,session:a,sessionKey:s,messageCount:l?.length??0,onClose:()=>L(!1)})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[l&&l.length>0&&e.jsx("button",{onClick:N,"aria-label":C("header.export"),className:"hidden sm:block p-2 rounded-2xl hover:bg-[var(--pc-hover)] text-pc-text-muted hover:text-pc-text transition-colors",title:C("header.export"),children:e.jsx(pt,{size:16})}),e.jsx("button",{onClick:()=>T(!0),"aria-label":C("settings.title"),className:"p-2 rounded-2xl hover:bg-[var(--pc-hover)] text-pc-text-muted hover:text-pc-text transition-colors",title:C("settings.title"),children:e.jsx(ut,{size:16})}),t==="connected"?e.jsxs("div",{className:"flex items-center gap-2 rounded-2xl border border-pc-border bg-pc-elevated/30 px-3 py-1.5",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-emerald-400 shadow-[0_0_12px_rgba(52,211,153,0.4)]"}),e.jsx("span",{className:"text-xs text-pc-text hidden sm:inline",children:C("header.connected")})]}):t==="connecting"?e.jsxs("div",{className:"flex items-center gap-2 rounded-2xl border border-pc-border bg-pc-elevated/30 px-3 py-1.5",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-yellow-400/80 pulse-dot"}),e.jsx("span",{className:"text-xs text-pc-text hidden sm:inline",children:C("login.connecting")})]}):e.jsxs("div",{className:"flex items-center gap-2 rounded-2xl border border-pc-border bg-pc-elevated/30 px-3 py-1.5",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-red-400/80"}),e.jsx("span",{className:"text-xs text-pc-text hidden sm:inline",children:C("header.disconnected")})]}),r&&e.jsx("button",{onClick:r,"aria-label":C("header.logout"),className:"p-2 rounded-2xl hover:bg-[var(--pc-hover)] text-pc-text-muted hover:text-pc-text transition-colors",title:C("header.logout"),children:e.jsx(Ft,{size:16})})]})]}),(()=>{const y=a?.contextTokens,E=a?.totalTokens||0;if(!y)return null;const w=Math.min(100,E/y*100),P=Math.max(.35,Math.min(1,w/100)),O={width:`${w}%`,backgroundColor:`rgba(var(--pc-accent-rgb), ${P})`};return e.jsxs("div",{className:"px-4 py-1.5 bg-[var(--pc-bg-surface)]/60 border-b border-pc-border flex items-center gap-3",children:[a?.model&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-[10px] text-pc-text-muted shrink-0",title:`Model: ${a.model}${a.agentId?` · Agent: ${a.agentId}`:""}`,children:[e.jsx(Bt,{className:"h-2.5 w-2.5"}),e.jsx("span",{className:"truncate max-w-[120px]",children:a.model.replace(/^.*\//,"")})]}),e.jsx("div",{className:"flex-1 h-[5px] rounded-full bg-[var(--pc-hover)] overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full transition-all duration-500",style:O})}),e.jsxs("span",{className:"text-[11px] text-pc-text-secondary tabular-nums shrink-0 whitespace-nowrap",children:[(E/1e3).toFixed(1),"k / ",(y/1e3).toFixed(0),"k tokens"]}),g&&w>=50&&e.jsx(ln,{sessionKey:s,onCompact:g})]})})(),e.jsx(en,{open:K,onClose:()=>T(!1),soundEnabled:h,onToggleSound:c})]})}function on({value:t}){const[s,n]=o.useState(!1);return e.jsx("button",{className:"ml-auto p-0.5 rounded hover:bg-[var(--pc-hover)] text-pc-text-faint hover:text-pc-text-secondary transition-colors",onClick:()=>{tn(t).then(a=>{a&&(n(!0),setTimeout(()=>n(!1),1500))})},title:"Copy",children:s?e.jsx(_e,{size:11,className:"text-emerald-400"}):e.jsx($t,{size:11})})}const cn=o.forwardRef(function({session:s,sessionKey:n,messageCount:a,onClose:r},h){const c=le(),l=[{label:c("sessionInfo.sessionKey"),value:n,copyable:!0}];return s.channel&&l.push({label:c("sessionInfo.channel"),value:s.channel}),s.kind&&l.push({label:c("sessionInfo.kind"),value:s.kind}),s.model&&l.push({label:c("sessionInfo.model"),value:s.model.replace(/^.*\//,"")}),s.agentId&&l.push({label:c("sessionInfo.agent"),value:s.agentId}),l.push({label:c("sessionInfo.messages"),value:String(a)}),s.totalTokens&&(l.push({label:c("sessionInfo.totalTokens"),value:`${(s.totalTokens/1e3).toFixed(1)}k`}),s.inputTokens&&l.push({label:c("sessionInfo.inputTokens"),value:`${(s.inputTokens/1e3).toFixed(1)}k`}),s.outputTokens&&l.push({label:c("sessionInfo.outputTokens"),value:`${(s.outputTokens/1e3).toFixed(1)}k`}),s.contextTokens&&l.push({label:c("sessionInfo.contextWindow"),value:`${(s.contextTokens/1e3).toFixed(0)}k`})),s.updatedAt&&l.push({label:c("sessionInfo.lastActive"),value:new Date(s.updatedAt).toLocaleString()}),e.jsxs("div",{ref:h,className:"absolute top-full left-0 mt-2 z-50 w-72 rounded-xl border border-pc-border bg-[var(--pc-bg-surface)] shadow-xl backdrop-blur-xl animate-in fade-in slide-in-from-top-2 duration-200",role:"dialog","aria-label":c("header.sessionInfo"),onClick:p=>p.stopPropagation(),onMouseDown:p=>p.stopPropagation(),children:[e.jsxs("div",{className:"p-3 border-b border-pc-border flex items-center justify-between",children:[e.jsx("span",{className:"text-xs font-semibold text-pc-text",children:c("header.sessionInfo")}),e.jsx("button",{onClick:r,className:"text-pc-text-faint hover:text-pc-text text-xs",children:"✕"})]}),e.jsx("div",{className:"p-3 space-y-2",children:l.map(({label:p,value:d,copyable:g})=>e.jsxs("div",{className:"flex items-start gap-2 text-[11px]",children:[e.jsx("span",{className:"text-pc-text-muted shrink-0 w-20",children:p}),e.jsx("span",{className:"text-pc-text-secondary break-all flex-1 font-mono",children:d}),g&&e.jsx(on,{value:d})]},p))})]})});function ln({sessionKey:t,onCompact:s}){const[n,a]=o.useState(!1),r=le(),h=o.useCallback(async()=>{if(!n){a(!0);try{await s(t)}finally{a(!1)}}},[n,t,s]);return e.jsxs("button",{onClick:h,disabled:n,className:"inline-flex items-center gap-1 text-[10px] text-pc-text-muted hover:text-pc-text shrink-0 px-1.5 py-0.5 rounded hover:bg-[var(--pc-hover)] transition-colors disabled:opacity-50",title:r("header.compact"),children:[e.jsx(Ht,{className:`h-3 w-3 ${n?"animate-pulse":""}`}),e.jsx("span",{className:"hidden sm:inline",children:r(n?"header.compacting":"header.compact")})]})}function dn({size:t=15,className:s=""}){return e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"currentColor",className:s,"aria-hidden":"true",children:e.jsx("path",{d:"M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028 14.09 14.09 0 0 0 1.226-1.994.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128 10.2 10.2 0 0 0 .372-.292.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.956-2.419 2.157-2.419 1.21 0 2.176 1.095 2.157 2.42 0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.956-2.419 2.157-2.419 1.21 0 2.176 1.095 2.157 2.42 0 1.333-.947 2.418-2.157 2.418z"})})}function un({size:t=15,className:s=""}){return e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"currentColor",className:s,"aria-hidden":"true",children:e.jsx("path",{d:"M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.479.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"})})}function hn({size:t=15,className:s=""}){return e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"currentColor",className:s,"aria-hidden":"true",children:e.jsx("path",{d:"M12 1.5C6.202 1.5 1.5 6.202 1.5 12c0 1.77.44 3.437 1.217 4.898L1.004 22.29a.75.75 0 0 0 .707.993l5.392-1.713A10.464 10.464 0 0 0 12 22.5c5.798 0 10.5-4.702 10.5-10.5S17.798 1.5 12 1.5z"})})}function pn({size:t=15,className:s=""}){return e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"currentColor",className:s,"aria-hidden":"true",children:e.jsx("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 0 1-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 0 1-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 0 1 2.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0 0 12.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 0 0 5.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 0 0-3.48-8.413z"})})}function gn({size:t=15,className:s=""}){return e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"currentColor",className:s,"aria-hidden":"true",children:e.jsx("path",{d:"M5.042 15.165a2.528 2.528 0 0 1-2.52 2.523A2.528 2.528 0 0 1 0 15.165a2.527 2.527 0 0 1 2.522-2.52h2.52v2.52zM6.313 15.165a2.527 2.527 0 0 1 2.521-2.52 2.527 2.527 0 0 1 2.521 2.52v6.313A2.528 2.528 0 0 1 8.834 24a2.528 2.528 0 0 1-2.521-2.522v-6.313zM8.834 5.042a2.528 2.528 0 0 1-2.521-2.52A2.528 2.528 0 0 1 8.834 0a2.528 2.528 0 0 1 2.521 2.522v2.52H8.834zM8.834 6.313a2.528 2.528 0 0 1 2.521 2.521 2.528 2.528 0 0 1-2.521 2.521H2.522A2.528 2.528 0 0 1 0 8.834a2.528 2.528 0 0 1 2.522-2.521h6.312zM18.956 8.834a2.528 2.528 0 0 1 2.522-2.521A2.528 2.528 0 0 1 24 8.834a2.528 2.528 0 0 1-2.522 2.521h-2.522V8.834zM17.688 8.834a2.528 2.528 0 0 1-2.523 2.521 2.527 2.527 0 0 1-2.52-2.521V2.522A2.527 2.527 0 0 1 15.165 0a2.528 2.528 0 0 1 2.523 2.522v6.312zM15.165 18.956a2.528 2.528 0 0 1 2.523 2.522A2.528 2.528 0 0 1 15.165 24a2.527 2.527 0 0 1-2.52-2.522v-2.522h2.52zM15.165 17.688a2.527 2.527 0 0 1-2.52-2.523 2.526 2.526 0 0 1 2.52-2.52h6.313A2.527 2.527 0 0 1 24 15.165a2.528 2.528 0 0 1-2.522 2.523h-6.313z"})})}function mn({session:t,isCurrentSession:s}){const a=(()=>{if(t.key.includes(":cron:"))return"text-amber-400/80";if(t.key.includes(":spawn:")||t.key.includes(":sub:"))return"text-violet-400/80";switch(t.channel?.toLowerCase()){case"discord":return"text-[#5865F2]";case"telegram":return"text-[#26A5E4]";case"signal":return"text-[#3A76F0]";case"whatsapp":return"text-[#25D366]";case"slack":return"text-[#E01E5A]";case"webchat":return"text-emerald-400/80";case"teamspeak":return"text-[#2580C3]";default:return"text-pc-text-secondary"}})(),r=s?"text-pc-accent-light":a;if(t.key.includes(":cron:"))return e.jsx(gt,{size:15,className:r});if(t.key.includes(":spawn:")||t.key.includes(":sub:"))return e.jsx(Je,{size:15,className:r});switch(t.channel?.toLowerCase()){case"discord":return e.jsx(dn,{size:15,className:r});case"telegram":return e.jsx(un,{size:15,className:r});case"signal":return e.jsx(hn,{size:15,className:r});case"whatsapp":return e.jsx(pn,{size:15,className:r});case"slack":return e.jsx(gn,{size:15,className:r});case"webchat":return e.jsx(qe,{size:15,className:r});case"teamspeak":return e.jsx(Re,{size:15,className:r});default:return e.jsx(Re,{size:15,className:r})}}function fn(t){if(!t)return null;const s=Date.now(),n=Math.max(0,s-t),a=Math.floor(n/1e3);if(a<60)return"<1m";const r=Math.floor(a/60);if(r<60)return`${r}m`;const h=Math.floor(r/60);if(h<24)return`${h}h`;const c=Math.floor(h/24);return c<30?`${c}d`:`${Math.floor(c/30)}mo`}const xn="https://api.github.com/repos/larry-sebastian/startlobster-chat-ui/releases/latest",Pe=3600*1e3,rt="startlobster-latest-version";function bn(t){const[s,n]=o.useState({available:!1,latestVersion:null,releaseUrl:null});return o.useEffect(()=>{let a;async function r(){try{const h=localStorage.getItem(rt);if(h){const{version:g,url:C,ts:f}=JSON.parse(h);if(Date.now()-f<Pe){g&&ot(g,t)&&n({available:!0,latestVersion:g,releaseUrl:C}),a=setTimeout(r,Pe-(Date.now()-f));return}}const c=await fetch(xn,{headers:{Accept:"application/vnd.github.v3+json"}});if(!c.ok)return;const l=await c.json(),p=l.tag_name?.replace(/^v/,"")||"",d=l.html_url||"";localStorage.setItem(rt,JSON.stringify({version:p,url:d,ts:Date.now()})),p&&ot(p,t)&&n({available:!0,latestVersion:p,releaseUrl:d})}catch{}a=setTimeout(r,Pe)}return r(),()=>clearTimeout(a)},[t]),s}function ot(t,s){const n=t.split(".").map(Number),a=s.split(".").map(Number);for(let r=0;r<3;r++){if((n[r]||0)>(a[r]||0))return!0;if((n[r]||0)<(a[r]||0))return!1}return!1}const it=typeof window<"u"&&window.matchMedia("(display-mode: standalone)").matches;function vn(){const[t,s]=o.useState(null),[n,a]=o.useState(it),r=o.useRef(it);o.useEffect(()=>{if(r.current)return;const c=p=>{p.preventDefault(),s(p)},l=()=>{r.current=!0,a(!0),s(null)};return window.addEventListener("beforeinstallprompt",c),window.addEventListener("appinstalled",l),()=>{window.removeEventListener("beforeinstallprompt",c),window.removeEventListener("appinstalled",l)}},[]);const h=o.useCallback(async()=>{if(!t)return!1;await t.prompt();const{outcome:c}=await t.userChoice;return s(null),c==="accepted"},[t]);return{canInstall:!!t&&!n,isInstalled:n,install:h}}function yn(){const t=bn("1.65.0");return t.available?e.jsxs("span",{className:"ml-1 inline-flex items-center gap-1.5 text-[9px]",children:[e.jsxs("span",{className:"text-pc-text-faint select-all",children:["v","1.65.0"]}),e.jsxs("a",{href:t.releaseUrl||"#",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-0.5 rounded-full bg-emerald-500/15 px-1.5 py-0.5 text-emerald-400 hover:text-emerald-300 hover:bg-emerald-500/25 transition-colors",title:`Update available: v${t.latestVersion}`,children:[e.jsx(Xt,{size:10}),e.jsxs("span",{children:[t.latestVersion," available"]})]})]}):e.jsxs("span",{className:"ml-1 text-[9px] text-pc-text-faint select-all",title:"StartLobster Chat v1.65.0",children:["v","1.65.0"]})}function wn(){const t=vn();return e.jsxs("div",{className:"px-4 py-3 border-t border-pc-border flex items-center justify-center gap-3",children:[t.canInstall&&e.jsxs("button",{onClick:t.install,className:"inline-flex items-center gap-1 text-[10px] text-pc-accent-light hover:text-[var(--pc-accent)] transition-colors",title:"Install app",children:[e.jsx(pt,{size:11}),e.jsx("span",{children:"Install"})]}),e.jsx("a",{href:"https://github.com/larry-sebastian/startlobster-chat-ui",target:"_blank",rel:"noopener noreferrer",className:"text-pc-text-faint hover:text-pc-text-secondary transition-colors",title:"GitHub",children:e.jsx(qe,{size:11})}),e.jsx(yn,{})]})}const jt="startlobster-pinned-sessions",Ke="startlobster-sidebar-width",Nt="startlobster-session-order",Te="startlobster-session-filter",Et="startlobster-session-names";function kn(){try{const t=localStorage.getItem(Et);if(t)return JSON.parse(t)}catch{}return{}}function Sn(t){try{localStorage.setItem(Et,JSON.stringify(t))}catch{}}function Tt(t){if(t.key.includes(":cron:"))return"cron";if(t.key.includes(":spawn:")||t.key.includes(":sub:"))return"agent";const s=t.channel?.toLowerCase();return s&&s!=="webchat"?s:"other"}function Cn(t){const s=new Set;for(const n of t)s.add(Tt(n));return Array.from(s).sort()}function jn({cat:t,size:s=12}){switch(t){case"cron":return e.jsx(gt,{size:s});case"agent":return e.jsx(Je,{size:s});case"discord":return e.jsx(Re,{size:s});case"telegram":return e.jsx(Re,{size:s});default:return e.jsx(qe,{size:s})}}function Nn(t){return t==="cron"?"Cron":t==="agent"?"Agents":t==="other"?"Chat":t.charAt(0).toUpperCase()+t.slice(1)}const Fe=220,Be=480,En=288;function Tn(){try{const t=localStorage.getItem(Ke);if(t){const s=Number(t);if(s>=Fe&&s<=Be)return s}}catch{}return En}function In(){try{const t=localStorage.getItem(jt);if(t)return new Set(JSON.parse(t))}catch{}return new Set}function An(t){try{localStorage.setItem(jt,JSON.stringify([...t]))}catch{}}function Rn(){try{const t=localStorage.getItem(Nt);if(t)return JSON.parse(t)}catch{}return[]}function Ln(t){try{localStorage.setItem(Nt,JSON.stringify(t))}catch{}}function Mn({sessions:t,activeSession:s,onSwitch:n,onDelete:a,onSplit:r,splitSession:h,open:c,onClose:l,onRename:p}){const d=le(),[g,C]=o.useState(""),[f,$]=o.useState(-1),[L,K]=o.useState(In),[T,q]=o.useState(Tn),[M,N]=o.useState(!1),[y,E]=o.useState(null),[w,P]=o.useState(Rn),[O,F]=o.useState(()=>{try{return localStorage.getItem(Te)}catch{return null}}),[m,R]=o.useState(null),[ee,B]=o.useState(null),[Y,Q]=o.useState(kn),[W,ae]=o.useState(null),[te,X]=o.useState(""),se=o.useRef(null),pe=o.useRef(null),de=o.useRef(null),re=o.useRef({startX:0,startW:0});o.useEffect(()=>{if(!M)return;const i=x=>{const b="touches"in x?x.touches[0].clientX:x.clientX,z=Math.min(Be,Math.max(Fe,re.current.startW+(b-re.current.startX)));q(z)},k=()=>{N(!1),localStorage.setItem(Ke,String(T))};return document.addEventListener("mousemove",i),document.addEventListener("mouseup",k),document.addEventListener("touchmove",i),document.addEventListener("touchend",k),()=>{document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",k),document.removeEventListener("touchmove",i),document.removeEventListener("touchend",k)}},[M,T]),o.useEffect(()=>()=>{try{localStorage.setItem(Ke,String(T))}catch{}},[T]);const I=o.useCallback(i=>{i.preventDefault();const k="touches"in i?i.touches[0].clientX:i.clientX;re.current={startX:k,startW:T},N(!0)},[T]),D=o.useCallback((i,k)=>{k.stopPropagation(),K(x=>{const b=new Set(x);return b.has(i)?b.delete(i):b.add(i),An(b),b})},[]),V=o.useCallback((i,k,x)=>{x.stopPropagation(),ae(i),X(k),requestAnimationFrame(()=>se.current?.focus())},[]),oe=o.useCallback(()=>{if(!W)return;const i=te.trim();Q(k=>{const x={...k};return i?x[W]=i:delete x[W],Sn(x),x}),p&&i&&p(W,i).catch(()=>{}),ae(null),X("")},[W,te,p]),fe=o.useCallback(()=>{ae(null),X("")},[]);o.useEffect(()=>{W&&(se.current?.focus(),se.current?.select())},[W]),o.useEffect(()=>{const i=k=>{(k.metaKey||k.ctrlKey)&&k.key==="k"&&(k.preventDefault(),pe.current?.focus())};return window.addEventListener("keydown",i),()=>window.removeEventListener("keydown",i)},[]);const ge=o.useCallback(i=>{C(i),$(-1)},[]),xe=o.useMemo(()=>Cn(t),[t]),v=o.useCallback(i=>{F(k=>{const x=k===i?null:i;try{x?localStorage.setItem(Te,x):localStorage.removeItem(Te)}catch{}return x})},[]),j=o.useMemo(()=>{let i=t;if(O==="active"?i=i.filter(_=>_.isActive):O&&(i=i.filter(_=>Tt(_)===O)),g.trim()){const _=g.toLowerCase();i=i.filter(H=>(Y[H.key]||ve(H)).toLowerCase().includes(_))}const k=i.filter(_=>L.has(_.key)),x=i.filter(_=>!L.has(_.key)),b=new Map(w.map((_,H)=>[_,H])),z=(_,H)=>{const J=b.get(_.key),u=b.get(H.key);return J!==void 0&&u!==void 0?J-u:J!==void 0?-1:u!==void 0?1:(H.updatedAt||0)-(_.updatedAt||0)};return k.sort(z),x.sort(z),[...k,...x]},[t,g,L,w,O,Y]);return e.jsxs(e.Fragment,{children:[c&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-40 lg:hidden",onClick:l}),e.jsxs("aside",{role:"navigation","aria-label":"Sessions",className:`fixed lg:relative top-0 left-0 h-full bg-[var(--pc-bg-base)]/95 border-r border-pc-border z-50 transform ${M?"":"transition-transform"} lg:translate-x-0 ${c?"translate-x-0":"-translate-x-full"} flex flex-col backdrop-blur-xl`,style:{width:`${T}px`},children:[e.jsxs("div",{className:"h-14 flex items-center justify-between px-4 border-b border-pc-border",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute -inset-1.5 rounded-xl bg-gradient-to-r from-cyan-400/15 to-violet-500/15 blur-lg"}),e.jsx("div",{className:"relative flex h-8 w-8 items-center justify-center rounded-xl overflow-hidden",children:e.jsx("img",{src:"/logo.png",alt:"StartLobster Chat",className:"h-8 w-8 object-contain"})})]}),e.jsx("span",{className:"font-semibold text-sm text-pc-text tracking-wide",children:d("sidebar.title")})]}),e.jsx("button",{onClick:l,className:"lg:hidden p-1.5 rounded-xl hover:bg-[var(--pc-hover)] text-pc-text-secondary transition-colors","aria-label":d("sidebar.close"),children:e.jsx(Se,{size:16})})]}),t.length>3&&e.jsx("div",{className:"px-2 pt-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(Jt,{size:14,className:"absolute left-3 top-1/2 -translate-y-1/2 text-pc-text-muted"}),e.jsx("input",{ref:pe,type:"text",value:g,onChange:i=>ge(i.target.value),placeholder:d("sidebar.search"),"aria-label":d("sidebar.search"),className:"w-full pl-8 pr-3 py-1.5 rounded-xl border border-pc-border bg-pc-elevated/30 text-xs text-pc-text placeholder:text-pc-text-muted outline-none focus:ring-1 focus:ring-[var(--pc-accent-dim)] transition-all"}),g&&e.jsx("button",{onClick:()=>ge(""),className:"absolute right-2 top-1/2 -translate-y-1/2 text-pc-text-muted hover:text-pc-text","aria-label":d("sidebar.clearSearch"),children:e.jsx(Se,{size:12})})]})}),xe.length>1&&e.jsxs("div",{className:"px-2 pt-1.5 flex flex-wrap gap-1",children:[e.jsx("button",{onClick:()=>{F(null);try{localStorage.removeItem(Te)}catch{}},className:`inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-[10px] font-medium transition-colors border ${O?"bg-transparent text-pc-text-muted border-pc-border hover:bg-[var(--pc-hover)] hover:text-pc-text-secondary":"bg-[var(--pc-accent-glow)] text-pc-accent-light border-[var(--pc-accent-dim)]"}`,children:d("sidebar.filterAll")}),e.jsxs("button",{onClick:()=>v("active"),className:`inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-[10px] font-medium transition-colors border ${O==="active"?"bg-violet-500/15 text-violet-300 border-violet-500/30":"bg-transparent text-pc-text-muted border-pc-border hover:bg-[var(--pc-hover)] hover:text-pc-text-secondary"}`,children:[e.jsx(qt,{size:10}),d("sidebar.filterActive")]}),xe.map(i=>e.jsxs("button",{onClick:()=>v(i),className:`inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-[10px] font-medium transition-colors border ${O===i?"bg-[var(--pc-accent-glow)] text-pc-accent-light border-[var(--pc-accent-dim)]":"bg-transparent text-pc-text-muted border-pc-border hover:bg-[var(--pc-hover)] hover:text-pc-text-secondary"}`,children:[e.jsx(jn,{cat:i,size:10}),Nn(i)]},i))]}),e.jsxs("div",{ref:de,className:"flex-1 overflow-y-auto py-2 px-2",role:"listbox","aria-label":d("sidebar.title"),tabIndex:0,onKeyDown:i=>{const k=j.length;if(k)if(i.key==="ArrowDown"){i.preventDefault();const x=f<k-1?f+1:0;$(x),de.current?.querySelectorAll('[role="option"]')[x]?.scrollIntoView({block:"nearest"})}else if(i.key==="ArrowUp"){i.preventDefault();const x=f>0?f-1:k-1;$(x),de.current?.querySelectorAll('[role="option"]')[x]?.scrollIntoView({block:"nearest"})}else i.key==="Enter"&&f>=0&&f<k?(i.preventDefault(),n(j[f].key),l()):i.key==="Escape"&&(i.preventDefault(),l())},children:[t.length===0&&e.jsx("div",{className:"px-3 py-8 text-center text-pc-text-muted text-sm",children:d("sidebar.empty")}),t.length>0&&j.length===0&&e.jsx("div",{className:"px-3 py-6 text-center text-pc-text-muted text-xs",children:d("sidebar.noResults")}),j.map((i,k)=>{const x=i.key===s,b=k===f,z=L.has(i.key),_=!z&&k>0&&L.has(j[k-1].key),H=m===i.key,J=ee===i.key&&m!==i.key;return e.jsxs("div",{children:[_&&e.jsx("div",{className:"flex items-center gap-2 px-3 py-1.5 mt-1 mb-1",children:e.jsx("div",{className:"flex-1 h-px bg-[var(--pc-hover)]"})}),e.jsxs("button",{role:"option","aria-selected":x,draggable:!g.trim(),onDragStart:u=>{R(i.key),u.dataTransfer.effectAllowed="move",u.dataTransfer.setData("text/plain",i.key)},onDragEnd:()=>{R(null),B(null)},onDragOver:u=>{u.preventDefault(),u.dataTransfer.dropEffect="move",m&&m!==i.key&&B(i.key)},onDragLeave:()=>{ee===i.key&&B(null)},onDrop:u=>{if(u.preventDefault(),!m||m===i.key)return;const A=L.has(m),U=L.has(i.key);if(A!==U){R(null),B(null);return}const Z=j.map(S=>S.key),ie=Z.indexOf(m),me=Z.indexOf(i.key);ie===-1||me===-1||(Z.splice(ie,1),Z.splice(me,0,m),P(Z),Ln(Z),R(null),B(null))},onClick:()=>{n(i.key),l()},onMouseEnter:()=>$(k),className:`group/item w-full flex items-center gap-3 px-3 py-2.5 rounded-2xl text-left text-sm transition-all mb-1 ${x?"bg-[var(--pc-hover)] text-pc-accent-light border border-pc-border shadow-[0_0_12px_rgba(34,211,238,0.08)]":i.isActive?"bg-violet-500/5 text-violet-200 border border-violet-500/15 shadow-[0_0_10px_rgba(168,85,247,0.06)]":"text-pc-text-secondary hover:bg-[var(--pc-hover)] border border-transparent"} ${b&&!x?"ring-1 ring-[var(--pc-accent-dim)]":""} ${H?"opacity-40":""} ${J?"ring-1 ring-[var(--pc-accent)] bg-[var(--pc-accent-glow)]":""}`,children:[e.jsxs("div",{className:"relative",children:[e.jsx(mn,{session:i,isActive:i.isActive,isCurrentSession:x}),i.isActive&&e.jsx("span",{className:"absolute -top-0.5 -right-0.5 h-2 w-2 rounded-full bg-violet-400 shadow-[0_0_8px_rgba(168,85,247,0.7)] animate-pulse"}),i.hasUnread&&!x&&e.jsx("span",{className:"absolute -top-1.5 -left-1.5 min-w-[16px] h-4 flex items-center justify-center rounded-full bg-[var(--pc-accent)] text-[9px] font-bold text-zinc-900 leading-none px-1 shadow-[0_0_8px_rgba(34,211,238,0.5)]",children:(i.unreadCount||1)>99?"99+":i.unreadCount||1})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[W===i.key?e.jsx("input",{ref:se,type:"text",value:te,onChange:u=>X(u.target.value),onBlur:oe,onKeyDown:u=>{u.stopPropagation(),u.key==="Enter"&&(u.preventDefault(),oe()),u.key==="Escape"&&(u.preventDefault(),fe())},onClick:u=>u.stopPropagation(),className:"flex-1 min-w-0 bg-[var(--pc-hover)] text-pc-text-primary text-[13px] rounded px-1 py-0 border border-pc-border outline-none focus:ring-1 focus:ring-[var(--pc-accent-dim)]",maxLength:60}):e.jsx("span",{className:"flex-1 truncate",onDoubleClick:u=>V(i.key,Y[i.key]||ve(i),u),title:d("sidebar.rename"),children:Y[i.key]||ve(i)}),(()=>{const u=fn(i.updatedAt);return u?e.jsx("span",{className:"text-[10px] text-pc-text-muted tabular-nums shrink-0",children:u}):null})(),e.jsx("button",{onClick:u=>V(i.key,Y[i.key]||ve(i),u),className:"shrink-0 p-0.5 rounded-lg transition-all text-pc-text-faint opacity-0 group-hover/item:opacity-60 hover:!opacity-100 hover:text-pc-text-secondary",title:d("sidebar.rename"),"aria-label":d("sidebar.rename"),children:e.jsx(Wt,{size:11})}),e.jsx("button",{onClick:u=>D(i.key,u),className:`shrink-0 p-0.5 rounded-lg transition-all ${z?"text-pc-accent opacity-80 hover:opacity-100":"text-pc-text-faint opacity-0 group-hover/item:opacity-60 hover:!opacity-100 hover:text-pc-text-secondary"}`,title:d(z?"sidebar.unpin":"sidebar.pin"),"aria-label":d(z?"sidebar.unpin":"sidebar.pin"),children:e.jsx(Vt,{size:12,className:z?"fill-current":""})}),r&&e.jsx("button",{onClick:u=>{u.stopPropagation(),r(i.key)},className:`shrink-0 p-0.5 rounded-lg transition-all ${h===i.key?"text-pc-accent opacity-80 hover:opacity-100":"text-pc-text-faint opacity-0 group-hover/item:opacity-60 hover:!opacity-100 hover:text-pc-text-secondary"}`,title:d("sidebar.openSplit"),"aria-label":d("sidebar.openSplit"),children:e.jsx(Gt,{size:12})}),e.jsx("button",{onClick:u=>{u.stopPropagation(),E(i.key)},className:"shrink-0 p-0.5 rounded-lg transition-all text-pc-text-faint opacity-0 group-hover/item:opacity-60 hover:!opacity-100 hover:text-red-400",title:d("sidebar.delete"),"aria-label":d("sidebar.delete"),children:e.jsx(Yt,{size:12})}),i.messageCount!=null&&e.jsx("span",{className:`text-[11px] px-2 py-0.5 rounded-full shrink-0 ${x?"bg-[var(--pc-accent-glow)] text-pc-accent-light":"bg-[var(--pc-hover)] text-pc-text-muted"}`,children:i.messageCount})]}),i.lastMessagePreview&&e.jsx("p",{className:"text-[11px] text-pc-text-muted truncate mt-0.5 leading-tight",children:i.lastMessagePreview.replace(/\s+/g," ").slice(0,80)}),(()=>{if(!i.contextTokens)return null;const u=Math.min(100,(i.totalTokens||0)/i.contextTokens*100),A=Math.max(.35,Math.min(1,u/100)),U={width:`${u}%`,backgroundColor:`rgba(var(--pc-accent-rgb), ${A})`};return e.jsxs("div",{className:"flex items-center gap-1.5 mt-1",children:[e.jsx("div",{className:"flex-1 h-[3px] rounded-full bg-[var(--pc-hover)] overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full",style:U})}),e.jsxs("span",{className:"text-[9px] text-pc-text-muted tabular-nums shrink-0",children:[Math.round(u),"%"]})]})})()]})]})]},i.key)})]}),e.jsx(wn,{}),e.jsx("div",{onMouseDown:I,onTouchStart:I,className:`hidden lg:block absolute top-0 right-0 w-1.5 h-full cursor-col-resize group/resize z-10 ${M?"bg-[var(--pc-accent-glow)]":"hover:bg-[var(--pc-accent-glow)]"} transition-colors`,role:"separator","aria-orientation":"vertical","aria-label":"Resize sidebar","aria-valuenow":T,"aria-valuemin":Fe,"aria-valuemax":Be,children:e.jsx("div",{className:`absolute top-1/2 -translate-y-1/2 right-0 w-0.5 h-8 rounded-full ${M?"bg-[var(--pc-accent-dim)]":"bg-transparent group-hover/resize:bg-[var(--pc-accent-dim)]"} transition-colors`})})]}),M&&e.jsx("div",{className:"fixed inset-0 z-[60] cursor-col-resize"}),y&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[70]",onClick:()=>E(null)}),e.jsxs("div",{className:"fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-[80] w-72 bg-[var(--pc-bg-base)] border border-pc-border-strong rounded-2xl p-5 shadow-2xl",children:[e.jsx("p",{className:"text-sm text-pc-text mb-4",children:d("sidebar.deleteConfirm")}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{onClick:()=>E(null),className:"px-3 py-1.5 text-xs rounded-xl border border-pc-border-strong text-pc-text-secondary hover:bg-[var(--pc-hover)] transition-colors",children:d("sidebar.deleteCancel")}),e.jsx("button",{onClick:()=>{a(y),E(null)},className:"px-3 py-1.5 text-xs rounded-xl bg-red-500/20 text-red-300 border border-red-500/20 hover:bg-red-500/30 transition-colors",children:d("sidebar.delete")})]})]})]})]})}function Pn(){const t=Ve();if(t)return t.url;const s=window.location.protocol==="https:"?"wss":"ws",n=window.location.hostname;if(s==="wss"){const a=n.split(".");if(a.length>=2)return a[0]=a[0]+"-gw",`${s}://${a.join(".")}`}return`${s}://${n}:18789`}function Dn(){return Ve()?.token??""}function On({onConnect:t,error:s,isConnecting:n}){const a=le(),[r,h]=o.useState(Pn),[c,l]=o.useState(Dn),[p,d]=o.useState(!1),g=r.trim(),C=/^wss?:\/\/.+/.test(g),f=g.length>0&&!C,$=L=>{L.preventDefault(),!(!g||!c.trim()||!C)&&t(g,c.trim())};return e.jsx("div",{className:"h-dvh flex items-center justify-center bg-[var(--pc-bg-base)] text-pc-text bg-[radial-gradient(ellipse_at_top,rgba(255,255,255,0.02),transparent_50%),radial-gradient(ellipse_at_bottom_right,rgba(99,102,241,0.04),transparent_50%)]",children:e.jsxs("div",{className:"w-full max-w-md mx-4",children:[e.jsxs("div",{className:"flex flex-col items-center gap-3 mb-8",children:[e.jsx("img",{src:"/logo.png",alt:"StartLobster Chat",className:"h-20 w-20 drop-shadow-lg"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h1",{className:"text-2xl font-bold text-pc-text tracking-wide",children:a("login.title")}),e.jsx(ht,{className:"h-5 w-5 text-pc-accent-light/60"})]}),e.jsx("p",{className:"text-sm text-pc-text-muted",children:a("login.subtitle")})]}),e.jsxs("form",{onSubmit:$,className:"rounded-2xl border border-pc-border bg-[var(--pc-bg-surface)]/80 backdrop-blur-xl p-6 space-y-5 shadow-2xl shadow-black/30",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"gateway-url",className:"block text-xs font-medium text-pc-text-secondary uppercase tracking-wider",children:a("login.gatewayUrl")}),e.jsx("input",{id:"gateway-url",type:"text",value:r,onChange:L=>h(L.target.value),placeholder:"ws://192.168.1.14:18789",className:"w-full rounded-xl border border-pc-border bg-pc-elevated/50 px-4 py-3 text-sm text-pc-text placeholder:text-pc-text-faint outline-none focus:border-[var(--pc-accent-dim)] focus:ring-1 focus:ring-[var(--pc-accent-glow)] transition-all",autoComplete:"url",disabled:n}),f&&e.jsx("p",{className:"text-xs text-amber-400/80 mt-1.5 pl-1",children:a("login.wsHint")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"gateway-token",className:"block text-xs font-medium text-pc-text-secondary uppercase tracking-wider",children:a("login.token")}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{id:"gateway-token",type:p?"text":"password",value:c,onChange:L=>l(L.target.value),placeholder:a("login.tokenPlaceholder"),className:"w-full rounded-xl border border-pc-border bg-pc-elevated/50 px-4 py-3 pr-12 text-sm text-pc-text placeholder:text-pc-text-faint outline-none focus:border-[var(--pc-accent-dim)] focus:ring-1 focus:ring-[var(--pc-accent-glow)] transition-all",autoComplete:"current-password",disabled:n}),e.jsx("button",{type:"button",onClick:()=>d(!p),className:"absolute right-3 top-1/2 -translate-y-1/2 text-pc-text-muted hover:text-pc-text transition-colors",tabIndex:-1,"aria-label":a(p?"login.hideToken":"login.showToken"),children:p?e.jsx(Zt,{size:16}):e.jsx(Qt,{size:16})})]})]}),s&&e.jsx("div",{className:"rounded-xl border border-red-500/20 bg-red-500/5 px-4 py-3 text-sm text-red-300",children:s}),e.jsx("button",{type:"submit",disabled:!C||!c.trim()||n,className:"w-full rounded-xl bg-gradient-to-r from-cyan-500 to-violet-500 px-4 py-3 text-sm font-semibold text-white shadow-lg shadow-cyan-500/20 hover:shadow-cyan-500/30 hover:brightness-110 disabled:opacity-40 disabled:cursor-not-allowed transition-all flex items-center justify-center gap-2",children:n?e.jsxs(e.Fragment,{children:[e.jsx(mt,{size:16,className:"animate-spin"}),a("login.connecting")]}):a("login.connect")})]}),e.jsx("p",{className:"text-center text-xs text-pc-text-faint mt-6",children:a("login.storedLocally")})]})})}function zn({status:t}){const s=le(),[n,a]=o.useState("hidden"),r=o.useRef(null),h=o.useRef(null),c=o.useCallback((d,g)=>{h.current&&(clearTimeout(h.current),h.current=null),g==="pairing"?a("pairing"):g==="disconnected"||g==="connecting"?(d==="connected"||d==="pairing")&&a("reconnecting"):g==="connected"&&d!==null&&d!=="connected"&&(a("reconnected"),h.current=setTimeout(()=>a("hidden"),3e3))},[]);if(o.useEffect(()=>{const d=r.current;return r.current=t,c(d,t),()=>{h.current&&clearTimeout(h.current)}},[t,c]),n==="hidden")return null;const l=n==="reconnecting",p=n==="pairing";return e.jsx("div",{role:"alert","aria-live":"polite",className:`flex items-center justify-center gap-2 px-4 py-2 text-xs font-medium transition-all duration-500 animate-in slide-in-from-top ${p?"bg-blue-500/10 text-blue-300 border-b border-blue-500/20":l?"bg-amber-500/10 text-amber-300 border-b border-amber-500/20":"bg-emerald-500/10 text-emerald-300 border-b border-emerald-500/20"}`,children:p?e.jsxs(e.Fragment,{children:[e.jsx(es,{size:14}),e.jsx("span",{children:s("connection.pairing")})]}):l?e.jsxs(e.Fragment,{children:[e.jsx(mt,{size:14,className:"animate-spin"}),e.jsx("span",{children:s("connection.reconnecting")})]}):e.jsxs(e.Fragment,{children:[e.jsx(ts,{size:14}),e.jsx("span",{children:s("connection.reconnected")})]})})}function G({children:t}){return e.jsx("kbd",{className:"inline-flex items-center justify-center min-w-[1.75rem] h-7 px-2 rounded-lg border border-pc-border-strong bg-pc-elevated/80 text-xs font-mono text-pc-text shadow-[0_1px_0_0_rgba(255,255,255,0.05)]",children:t})}function ue({keys:t,label:s}){return e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsx("span",{className:"text-sm text-pc-text-secondary",children:s}),e.jsx("div",{className:"flex items-center gap-1.5",children:t})]})}function De({children:t}){return e.jsx("div",{className:"text-[11px] uppercase tracking-wider text-pc-text-muted font-semibold mt-4 mb-1 first:mt-0",children:t})}const _n=typeof navigator<"u"&&/Mac|iPod|iPhone|iPad/.test(navigator.userAgent),Oe=_n?"⌘":"Ctrl";function $n({open:t,onClose:s}){const n=le(),{sendOnEnter:a}=Ct();return o.useEffect(()=>{if(!t)return;const r=h=>{h.key==="Escape"&&s()};return window.addEventListener("keydown",r),()=>window.removeEventListener("keydown",r)},[t,s]),t?e.jsxs("div",{role:"dialog","aria-modal":"true","aria-label":n("shortcuts.title"),className:"fixed inset-0 z-50 flex items-center justify-center",onClick:s,children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm"}),e.jsxs("div",{className:"relative w-full max-w-md mx-4 rounded-3xl border border-pc-border bg-[var(--pc-bg-base)]/95 backdrop-blur-xl shadow-2xl animate-fade-in",onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-pc-border",children:[e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx(ss,{size:18,className:"text-pc-accent-light/70"}),e.jsx("h2",{className:"text-sm font-semibold text-pc-text",children:n("shortcuts.title")})]}),e.jsx("button",{onClick:s,className:"h-8 w-8 rounded-xl flex items-center justify-center text-pc-text-muted hover:text-pc-text hover:bg-[var(--pc-hover)] transition-colors","aria-label":n("shortcuts.close"),children:e.jsx(Se,{size:16})})]}),e.jsxs("div",{className:"px-6 py-4 divide-y divide-white/5",children:[e.jsxs("div",{className:"pb-3",children:[e.jsx(De,{children:n("shortcuts.chatSection")}),e.jsx(ue,{keys:a?e.jsx(G,{children:"Enter"}):e.jsxs(e.Fragment,{children:[e.jsx(G,{children:Oe}),e.jsx("span",{className:"text-pc-text-faint",children:"+"}),e.jsx(G,{children:"Enter"})]}),label:n("shortcuts.send")}),e.jsx(ue,{keys:a?e.jsxs(e.Fragment,{children:[e.jsx(G,{children:"Shift"}),e.jsx("span",{className:"text-pc-text-faint",children:"+"}),e.jsx(G,{children:"Enter"})]}):e.jsx(G,{children:"Enter"}),label:n("shortcuts.newline")}),e.jsx(ue,{keys:e.jsx(G,{children:"Esc"}),label:n("shortcuts.stop")}),e.jsx(ue,{keys:e.jsxs(e.Fragment,{children:[e.jsx(G,{children:Oe}),e.jsx("span",{className:"text-pc-text-faint",children:"+"}),e.jsx(G,{children:"F"})]}),label:n("shortcuts.searchMessages")})]}),e.jsxs("div",{className:"py-3",children:[e.jsx(De,{children:n("shortcuts.navigationSection")}),e.jsx(ue,{keys:e.jsxs(e.Fragment,{children:[e.jsx(G,{children:Oe}),e.jsx("span",{className:"text-pc-text-faint",children:"+"}),e.jsx(G,{children:"K"})]}),label:n("shortcuts.search")}),e.jsx(ue,{keys:e.jsxs(e.Fragment,{children:[e.jsx(G,{children:"Alt"}),e.jsx("span",{className:"text-pc-text-faint",children:"+"}),e.jsx(G,{children:"↑"}),e.jsx("span",{className:"text-pc-text-faint",children:"/"}),e.jsx(G,{children:"↓"})]}),label:n("shortcuts.switchSession")}),e.jsx(ue,{keys:e.jsx(G,{children:"Esc"}),label:n("shortcuts.closeSidebar")})]}),e.jsxs("div",{className:"pt-3",children:[e.jsx(De,{children:n("shortcuts.generalSection")}),e.jsx(ue,{keys:e.jsx(G,{children:"?"}),label:n("shortcuts.help")})]})]})]})]}):null}const Un=o.createContext({globalState:"none",version:0,collapseAll:()=>{},expandAll:()=>{}});function Kn({children:t}){const[s,n]=o.useState("none"),[a,r]=o.useState(0),h=o.useCallback(()=>{n("collapse-all"),r(l=>l+1)},[]),c=o.useCallback(()=>{n("expand-all"),r(l=>l+1)},[]);return e.jsx(Un.Provider,{value:{globalState:s,version:a,collapseAll:h,expandAll:c},children:t})}const Fn=30,ct=50,lt=80;function Bn(t,s,n){const a=o.useRef(null),r=o.useRef(!1),h=o.useCallback(p=>{const d=p.touches[0];d&&(!t&&d.clientX>Fn||(a.current={x:d.clientX,y:d.clientY,time:Date.now()},r.current=!1))},[t]),c=o.useCallback(p=>{if(!a.current)return;const d=p.touches[0];if(!d)return;const g=d.clientX-a.current.x;if(Math.abs(d.clientY-a.current.y)>lt){a.current=null;return}Math.abs(g)>10&&(r.current=!0)},[]),l=o.useCallback(p=>{if(!a.current)return;const d=p.changedTouches[0];if(!d){a.current=null;return}const g=d.clientX-a.current.x,C=Math.abs(d.clientY-a.current.y),f=Date.now()-a.current.time;a.current=null,!(C>lt||f>500)&&(!t&&g>ct?s():t&&g<-ct&&n())},[t,s,n]);o.useEffect(()=>(document.addEventListener("touchstart",h,{passive:!0}),document.addEventListener("touchmove",c,{passive:!0}),document.addEventListener("touchend",l,{passive:!0}),()=>{document.removeEventListener("touchstart",h),document.removeEventListener("touchmove",c),document.removeEventListener("touchend",l)}),[h,c,l])}const dt=o.lazy(()=>rs(()=>import("./Chat-DgeVpvIf.js"),__vite__mapDeps([0,1,2,3])).then(t=>({default:t.Chat}))),It="startlobster-split-width",Hn=250;function Jn(){try{const t=localStorage.getItem(It);if(t){const s=Number(t);if(s>=20&&s<=80)return s}}catch{}return 50}function qn(){const{status:t,messages:s,sessions:n,activeSession:a,isGenerating:r,isLoadingHistory:h,sendMessage:c,abort:l,switchSession:p,deleteSession:d,authenticated:g,login:C,logout:f,connectError:$,isConnecting:L,agentIdentity:K,getClient:T,addEventListener:q}=As(),[M,N]=o.useState(null),[y,E]=o.useState(Jn),[w,P]=o.useState(!1),O=o.useRef(null),F=o.useRef(y),m=Ms(T,q,M),R=le(),ee=o.useCallback(I=>{N(D=>D===I?null:I)},[]),B=o.useCallback(async I=>{const D=T();if(!D)return!1;try{const V=await D.send("sessions.compact",{key:I});return V?.compacted&&p(I),!!V?.compacted}catch{return!1}},[T,p]),Y=o.useCallback(async(I,D)=>{const V=T();if(!V)return!1;try{return await V.send("sessions.patch",{key:I,label:D}),!0}catch{return!1}},[T]);o.useEffect(()=>{if(!w)return;const I=V=>{const oe=O.current;if(!oe)return;const fe=oe.getBoundingClientRect(),ge=fe.width;if(ge<Hn*2)return;const xe=V.clientX-fe.left,v=Math.max(20,Math.min(80,xe/ge*100));E(v),F.current=v},D=()=>{P(!1),localStorage.setItem(It,String(Math.round(F.current)))};return document.addEventListener("mousemove",I),document.addEventListener("mouseup",D),()=>{document.removeEventListener("mousemove",I),document.removeEventListener("mouseup",D)}},[w,y]);const[Q,W]=o.useState(!1),[ae,te]=o.useState(!1);Bn(Q,()=>W(!0),()=>W(!1));const{notify:X,soundEnabled:se,toggleSound:pe}=Ds(),de=o.useRef(s.length);o.useEffect(()=>{const I=de.current;if(de.current=s.length,s.length>I){const D=s[s.length-1];if(D&&D.role==="assistant"&&!D.isStreaming){const V=D.content?.slice(0,100)||"New message";X("StartLobster Chat",V)}}},[s,X]),o.useEffect(()=>{const I=n.find(D=>D.key===a);return tt(I?.label||I?.key),()=>tt(void 0)},[a,n]);const re=o.useCallback(I=>{if(I.key==="Escape"&&Q&&W(!1),I.key==="?"&&!ae){const D=I.target?.tagName;if(D==="INPUT"||D==="TEXTAREA"||I.target?.isContentEditable)return;I.preventDefault(),te(!0)}if(I.altKey&&(I.key==="ArrowUp"||I.key==="ArrowDown")){if(I.preventDefault(),n.length<2)return;const D=n.findIndex(oe=>oe.key===a);if(D===-1)return;const V=I.key==="ArrowUp"?(D-1+n.length)%n.length:(D+1)%n.length;p(n[V].key)}},[Q,ae,n,a,p]);return o.useEffect(()=>(document.addEventListener("keydown",re),()=>document.removeEventListener("keydown",re)),[re]),g===null?e.jsx("div",{className:"h-dvh flex items-center justify-center bg-[var(--pc-bg-base)] text-pc-text-muted",children:e.jsx("div",{className:"animate-pulse text-sm",children:"Connecting…"})}):g?e.jsx(Kn,{children:e.jsxs("div",{className:"h-dvh flex overflow-x-hidden bg-[var(--pc-bg-base)] text-pc-text bg-[radial-gradient(ellipse_at_top,rgba(255,255,255,0.02),transparent_50%),radial_gradient(ellipse_at_bottom_right,rgba(99,102,241,0.04),transparent_50%)]",role:"application","aria-label":"StartLobster Chat",children:[e.jsx("a",{href:"#chat-input",className:"sr-only focus:not-sr-only focus:absolute focus:z-[100] focus:top-2 focus:left-2 focus:px-4 focus:py-2 focus:rounded-xl focus:bg-pc-accent focus:text-white focus:text-sm focus:font-medium",children:R("app.skipToChat")}),e.jsx(Mn,{sessions:n,activeSession:a,onSwitch:p,onDelete:d,onSplit:ee,splitSession:M,open:Q,onClose:()=>W(!1),onRename:Y}),e.jsxs("div",{ref:O,className:"flex-1 flex min-w-0","aria-hidden":Q?!0:void 0,children:[e.jsxs("main",{className:"flex flex-col min-w-0",style:M?{width:`${y}%`}:{flex:1},"aria-label":R("app.mainChat"),children:[e.jsx(rn,{status:t,sessionKey:a,onToggleSidebar:()=>W(!Q),activeSessionData:n.find(I=>I.key===a),onLogout:f,soundEnabled:se,onToggleSound:pe,messages:s,agentAvatarUrl:K?.avatar,agentName:K?.name,onCompact:B}),e.jsx(zn,{status:t}),e.jsx(o.Suspense,{fallback:e.jsx("div",{className:"flex-1 flex items-center justify-center text-pc-text-muted",children:e.jsx("div",{className:"animate-pulse text-sm",children:"Loading…"})}),children:e.jsx(dt,{messages:s,isGenerating:r,isLoadingHistory:h,status:t,sessionKey:a,onSend:c,onAbort:l,agentAvatarUrl:K?.avatar})})]}),M&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`w-1 cursor-col-resize flex-shrink-0 transition-colors ${w?"bg-pc-accent/60":"bg-pc-border hover:bg-pc-accent/40"}`,onMouseDown:()=>P(!0),role:"separator","aria-orientation":"vertical"}),e.jsxs("section",{className:"flex flex-col min-w-0",style:{width:`${100-y}%`},"aria-label":R("app.splitPane"),children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 border-b border-pc-border bg-[var(--pc-bg-surface)]",children:[e.jsx("span",{className:"text-sm font-medium text-pc-text truncate flex-1",children:(()=>{const I=n.find(D=>D.key===M);return I?ve(I):M})()}),e.jsx("button",{onClick:()=>N(null),className:"p-1 rounded-lg text-pc-text-muted hover:text-pc-text hover:bg-[var(--pc-hover)] transition-colors",title:R("split.close"),"aria-label":R("split.close"),children:e.jsx(Se,{size:14})})]}),e.jsx(o.Suspense,{fallback:e.jsx("div",{className:"flex-1 flex items-center justify-center text-pc-text-muted",children:e.jsx("div",{className:"animate-pulse text-sm",children:"Loading…"})}),children:e.jsx(dt,{messages:m.messages,isGenerating:m.isGenerating,isLoadingHistory:m.isLoadingHistory,status:t,sessionKey:M,onSend:m.sendMessage,onAbort:m.abort,agentAvatarUrl:K?.avatar})})]})]})]}),e.jsx($n,{open:ae,onClose:()=>te(!1)})]})}):e.jsx(On,{onConnect:C,error:$,isConnecting:L})}class Wn extends o.Component{state={hasError:!1,error:null};static getDerivedStateFromError(s){return{hasError:!0,error:s}}componentDidCatch(s,n){console.error("[StartLobster Chat] Render error caught by ErrorBoundary:",s,n.componentStack)}handleRetry=()=>{this.setState({hasError:!1,error:null})};handleReload=()=>{window.location.reload()};render(){return this.state.hasError?this.props.fallback?this.props.fallback:e.jsx("div",{role:"alert",className:"h-dvh flex items-center justify-center bg-[var(--pc-bg-base)] text-pc-text p-6",children:e.jsxs("div",{className:"max-w-md w-full space-y-4 text-center",children:[e.jsx("div",{className:"text-4xl",children:"💥"}),e.jsx("h1",{className:"text-xl font-semibold text-pc-text",children:ke("error.title")}),e.jsx("p",{className:"text-sm text-pc-text-secondary",children:ke("error.description")}),this.state.error&&e.jsx("pre",{className:"mt-3 p-3 rounded-lg bg-pc-elevated/60 text-xs text-red-400 text-left overflow-auto max-h-32",children:this.state.error.message}),e.jsxs("div",{className:"flex gap-3 justify-center pt-2",children:[e.jsx("button",{onClick:this.handleRetry,className:"px-4 py-2 rounded-lg bg-pc-elevated hover:bg-pc-elevated text-sm font-medium transition-colors",children:ke("error.retry")}),e.jsx("button",{onClick:this.handleReload,className:"px-4 py-2 rounded-lg bg-[var(--pc-accent)] hover:bg-[var(--pc-accent-light)] text-sm font-medium transition-colors",children:ke("error.reload")})]})]})}):this.props.children}}const At="startlobster-theme",Ae={dark:{"--pc-bg-base":"#1e1e24","--pc-bg-surface":"#232329","--pc-bg-elevated":"#27272a","--pc-bg-input":"#1a1a20","--pc-bg-sidebar":"rgba(30,30,36,0.95)","--pc-bg-code":"#1a1a20","--pc-border":"rgba(255,255,255,0.08)","--pc-border-strong":"rgba(255,255,255,0.1)","--pc-text-primary":"#d4d4d8","--pc-text-secondary":"#a1a1aa","--pc-text-muted":"#71717a","--pc-text-faint":"#52525b","--pc-scrollbar-thumb":"#52525b","--pc-scrollbar-track":"#27272a","--pc-scrollbar-thumb-hover":"#71717a","--pc-hover":"rgba(255,255,255,0.05)","--pc-hover-strong":"rgba(255,255,255,0.08)","--pc-separator":"rgba(255,255,255,0.05)"},light:{"--pc-bg-base":"#f4f4f5","--pc-bg-surface":"#ffffff","--pc-bg-elevated":"#e4e4e7","--pc-bg-input":"#ffffff","--pc-bg-sidebar":"rgba(255,255,255,0.95)","--pc-bg-code":"#f4f4f5","--pc-border":"rgba(0,0,0,0.08)","--pc-border-strong":"rgba(0,0,0,0.12)","--pc-text-primary":"#18181b","--pc-text-secondary":"#3f3f46","--pc-text-muted":"#71717a","--pc-text-faint":"#a1a1aa","--pc-scrollbar-thumb":"#a1a1aa","--pc-scrollbar-track":"#e4e4e7","--pc-scrollbar-thumb-hover":"#71717a","--pc-hover":"rgba(0,0,0,0.05)","--pc-hover-strong":"rgba(0,0,0,0.08)","--pc-separator":"rgba(0,0,0,0.08)"},oled:{"--pc-bg-base":"#000000","--pc-bg-surface":"#0a0a0a","--pc-bg-elevated":"#141414","--pc-bg-input":"#0a0a0a","--pc-bg-sidebar":"rgba(0,0,0,0.95)","--pc-bg-code":"#0a0a0a","--pc-border":"rgba(255,255,255,0.06)","--pc-border-strong":"rgba(255,255,255,0.08)","--pc-text-primary":"#d4d4d8","--pc-text-secondary":"#a1a1aa","--pc-text-muted":"#71717a","--pc-text-faint":"#3f3f46","--pc-scrollbar-thumb":"#3f3f46","--pc-scrollbar-track":"#0a0a0a","--pc-scrollbar-thumb-hover":"#52525b","--pc-hover":"rgba(255,255,255,0.04)","--pc-hover-strong":"rgba(255,255,255,0.06)","--pc-separator":"rgba(255,255,255,0.04)"}},He={cyan:{"--pc-accent":"#22d3ee","--pc-accent-light":"#67e8f9","--pc-accent-dim":"rgba(34,211,238,0.3)","--pc-accent-glow":"rgba(34,211,238,0.1)","--pc-accent-rgb":"34,211,238"},violet:{"--pc-accent":"#8b5cf6","--pc-accent-light":"#a78bfa","--pc-accent-dim":"rgba(139,92,246,0.3)","--pc-accent-glow":"rgba(139,92,246,0.1)","--pc-accent-rgb":"139,92,246"},emerald:{"--pc-accent":"#10b981","--pc-accent-light":"#34d399","--pc-accent-dim":"rgba(16,185,129,0.3)","--pc-accent-glow":"rgba(16,185,129,0.1)","--pc-accent-rgb":"16,185,129"},amber:{"--pc-accent":"#f59e0b","--pc-accent-light":"#fbbf24","--pc-accent-dim":"rgba(245,158,11,0.3)","--pc-accent-glow":"rgba(245,158,11,0.1)","--pc-accent-rgb":"245,158,11"},rose:{"--pc-accent":"#f43f5e","--pc-accent-light":"#fb7185","--pc-accent-dim":"rgba(244,63,94,0.3)","--pc-accent-glow":"rgba(244,63,94,0.1)","--pc-accent-rgb":"244,63,94"},blue:{"--pc-accent":"#3b82f6","--pc-accent-light":"#60a5fa","--pc-accent-dim":"rgba(59,130,246,0.3)","--pc-accent-glow":"rgba(59,130,246,0.1)","--pc-accent-rgb":"59,130,246"}};function Ie(t){const s=document.documentElement;for(const[n,a]of Object.entries(t))s.style.setProperty(n,a)}function ze(t){return t==="system"?window.matchMedia("(prefers-color-scheme: light)").matches?"light":"dark":t}function Vn(){try{const t=localStorage.getItem(At);if(t){const s=JSON.parse(t);if((s.theme in Ae||s.theme==="system")&&s.accent in He)return s}}catch{}return{theme:"dark",accent:"cyan"}}function Gn({children:t}){const[s]=o.useState(Vn),[n,a]=o.useState(s.theme),[r,h]=o.useState(s.accent),c=o.useCallback((g,C)=>{localStorage.setItem(At,JSON.stringify({theme:g,accent:C}))},[]),l=o.useCallback(g=>{a(g),Ie(Ae[ze(g)]),c(g,r)},[r,c]),p=o.useCallback(g=>{h(g),Ie(He[g]),c(n,g)},[n,c]);o.useEffect(()=>{Ie({...Ae[ze(n)],...He[r]})},[]),o.useEffect(()=>{if(n!=="system")return;const g=window.matchMedia("(prefers-color-scheme: light)"),C=()=>Ie(Ae[g.matches?"light":"dark"]);return g.addEventListener("change",C),()=>g.removeEventListener("change",C)},[n]);const d=ze(n);return e.jsx(St.Provider,{value:{theme:n,accent:r,resolvedTheme:d,setTheme:l,setAccent:p},children:t})}"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(t=>{setInterval(()=>t.update().catch(()=>{}),1800*1e3),t.addEventListener("updatefound",()=>{const s=t.installing;s&&s.addEventListener("statechange",()=>{s.state==="installed"&&navigator.serviceWorker.controller&&window.location.reload()})})}).catch(()=>{})});Rt.createRoot(document.getElementById("root")).render(e.jsx(Lt.StrictMode,{children:e.jsx(Wn,{children:e.jsx(Gn,{children:e.jsx(qn,{})})})}));export{Un as T,rs as _,Gs as a,kt as b,tn as c,Ct as d,nt as g,Qn as h,Zn as s,ke as t,le as u};
