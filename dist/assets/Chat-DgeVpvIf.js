const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/markdown-Bg1H1bKC.js","assets/react-vendor-Bzht1aMj.js"])))=>i.map(i=>d[i]);
import{j as e,r as o,b as _t}from"./react-vendor-Bzht1aMj.js";import{_ as W,u as B,c as se,T as Et,a as Be,b as Lt,h as _e,s as Ee,t as S,g as Pe,d as $t}from"./index-2lNm5GEN.js";import{s as Fe,t as J,u as He,v as Ue,w as We,H as Rt,x as Ve,C as ye,d as re,y as Dt,X as te,U as Tt,B as ne,R as qe,z as he,A as It,F as At,j as Mt,J as zt,N as Ot,Z as Bt,O as Pt,I as Ft,Q as Ht,Y as Ut,_ as Wt,E as Vt,p as qt,$ as Jt,a0 as Yt,l as Gt,q as Kt,f as Zt,a1 as Xt,a2 as Qt,D as es,a3 as ts}from"./icons-BFri4d-7.js";import{H as v,y as Je,x as Ye,t as Ge,s as Ke,a as Ze,r as Xe,p as Qe,m as et,j as tt,b as st,c as rt,i as nt,g as at,d as ot,e as lt,f as ct,h as it,k as dt,l as ut}from"./markdown-Bg1H1bKC.js";const ss=o.lazy(()=>W(()=>import("./markdown-Bg1H1bKC.js").then(t=>t.n),__vite__mapDeps([0,1])));let pt=null,mt=null,ge=!1;Promise.all([W(()=>import("./markdown-Bg1H1bKC.js").then(t=>t.o),__vite__mapDeps([0,1])).then(t=>t.default),W(()=>import("./markdown-Bg1H1bKC.js").then(t=>t.q),__vite__mapDeps([0,1])).then(t=>t.default),W(()=>import("./markdown-Bg1H1bKC.js").then(t=>t.u),__vite__mapDeps([0,1])).then(t=>t.default),W(()=>Promise.resolve().then(()=>ms),void 0).then(t=>t.rehypeHighlightOptions)]).then(([t,s,r,a])=>{pt=[t,s],mt=[[r,a]],ge=!0});function rs({children:t,remarkPlugins:s,rehypePlugins:r,components:a}){const n=s??(ge?pt:[]),i=r??(ge?mt:[]);return e.jsx(ss,{remarkPlugins:n,rehypePlugins:i,components:a,children:t})}function fe(t){return e.jsx(o.Suspense,{fallback:e.jsx("span",{className:"opacity-50",children:t.children.slice(0,200)}),children:e.jsx(rs,{...t})})}function ns({text:t}){const s=B(),[r,a]=o.useState(!1);return e.jsxs("div",{className:"my-2",children:[e.jsxs("button",{onClick:()=>a(!r),"aria-expanded":r,"aria-label":s("thinking.label"),className:"inline-flex items-center gap-1.5 rounded-2xl border border-pc-border bg-pc-elevated/35 px-3 py-1.5 text-xs text-violet-300 hover:bg-[var(--pc-hover)] transition-colors",children:[e.jsx(Fe,{size:13}),e.jsx("span",{className:"font-medium",children:s("thinking.label")}),r?e.jsx(J,{size:12,className:"ml-1 text-pc-text-muted"}):e.jsx(He,{size:12,className:"ml-1 text-pc-text-muted"})]}),r&&e.jsx("div",{role:"region","aria-label":s("thinking.label"),className:"mt-2 rounded-2xl border border-pc-border bg-pc-elevated/25 p-3 text-sm italic text-pc-text-secondary whitespace-pre-wrap max-h-96 overflow-y-auto",children:t})]})}function as(){const t=B(),[s,r]=o.useState(0),[a]=o.useState(()=>Date.now());o.useEffect(()=>{const i=setInterval(()=>{r(Math.floor((Date.now()-a)/1e3))},1e3);return()=>clearInterval(i)},[a]);const n=i=>{if(i<60)return`${i}s`;const u=Math.floor(i/60),l=i%60;return`${u}m ${l.toString().padStart(2,"0")}s`};return e.jsx("div",{role:"status","aria-label":t("thinking.reasoning"),className:"flex items-center gap-2 mt-2 animate-fade-in",children:e.jsxs("div",{className:"inline-flex items-center gap-2 rounded-2xl border border-violet-500/15 bg-violet-500/5 px-3 py-1.5",children:[e.jsx(Fe,{size:14,className:"text-violet-300 animate-pulse","aria-hidden":"true"}),e.jsx("span",{className:"text-xs font-medium text-violet-300",children:t("thinking.reasoning")}),e.jsx("span",{className:"text-xs tabular-nums text-violet-300/50","aria-live":"off",children:n(s)})]})})}function os(t){const r=t?.props?.className;if(typeof r!="string")return null;const a=r.match(/language-(\S+)/);return a?a[1]:null}const ls={js:"JavaScript",jsx:"JSX",ts:"TypeScript",tsx:"TSX",py:"Python",rb:"Ruby",rs:"Rust",go:"Go",sh:"Shell",bash:"Bash",zsh:"Zsh",yml:"YAML",yaml:"YAML",md:"Markdown",json:"JSON",html:"HTML",css:"CSS",sql:"SQL",dockerfile:"Dockerfile",toml:"TOML"};function cs(t){return ls[t]||t}const Le="startlobster-line-numbers",$e="startlobster-code-wrap",is=3,ds=25,Re=10;function us(t){const[s,r]=o.useState(!1),[a,n]=o.useState(()=>{const y=localStorage.getItem(Le);return y===null?!0:y==="true"}),[i,u]=o.useState(()=>localStorage.getItem($e)==="true"),[l,c]=o.useState(!0),h=os(t.children),p=t.children?.props?.children,g=typeof p=="string"?p.replace(/\n$/,"").split(`
`):[],d=g.length>is,k=g.length>ds,b=o.useCallback(y=>{y.stopPropagation(),y.preventDefault();const _=typeof p=="string"?p:"";_&&se(_).then(z=>{z&&(r(!0),setTimeout(()=>r(!1),2e3))})},[p]),j=o.useCallback(()=>{n(y=>{const _=!y;return localStorage.setItem(Le,String(_)),_})},[]),E=o.useCallback(()=>{u(y=>{const _=!y;return localStorage.setItem($e,String(_)),_})},[]),M=a&&d,I=k&&l,L=i?{whiteSpace:"pre-wrap",overflowWrap:"break-word",wordBreak:"break-word"}:void 0,N=I?{maxHeight:`${Re*1.7142857}em`,overflow:"hidden"}:void 0;return e.jsxs("div",{className:"group/code relative",children:[h&&e.jsxs("div",{className:"flex items-center justify-between px-4 py-1.5 bg-pc-elevated/80 border-b border-pc-border rounded-t-lg text-[11px] text-pc-text-muted font-mono select-none",children:[e.jsxs("span",{children:[cs(h),k&&e.jsxs("span",{className:"ml-1.5 text-pc-text-faint",children:["(",g.length," lines)"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:E,className:"flex items-center gap-1 px-1.5 py-0.5 rounded hover:bg-pc-border/40 transition-colors text-pc-text-muted hover:text-pc-text-secondary",title:i?"Disable word wrap":"Enable word wrap",type:"button",children:i?e.jsx(Ue,{className:"h-3 w-3"}):e.jsx(We,{className:"h-3 w-3"})}),d&&e.jsxs("button",{onClick:j,className:"flex items-center gap-1 px-1.5 py-0.5 rounded hover:bg-pc-border/40 transition-colors text-pc-text-muted hover:text-pc-text-secondary",title:a?"Hide line numbers":"Show line numbers",type:"button",children:[e.jsx(Rt,{className:"h-3 w-3"}),e.jsx("span",{className:"text-[10px]",children:g.length})]})]})]}),e.jsxs("div",{className:"relative",children:[M?e.jsxs("div",{className:`flex ${h?"rounded-t-none":"rounded-lg"} overflow-hidden`,style:N,children:[e.jsx("div",{className:"flex-shrink-0 select-none text-right pr-3 pl-3 py-4 text-[11px] leading-[1.7142857] font-mono text-pc-text-muted/40 bg-pc-elevated/40 border-r border-pc-border/50","aria-hidden":"true",children:(I?g.slice(0,Re):g).map((y,_)=>e.jsx("div",{children:_+1},_))}),e.jsx("pre",{...t,className:`${t.className||""} flex-1 !rounded-none !mt-0 min-w-0`,style:L})]}):e.jsx("div",{style:N,children:e.jsx("pre",{...t,className:`${t.className||""} ${h?"!rounded-t-none !mt-0":""}`,style:L})}),I&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-16 bg-gradient-to-t from-[var(--pc-bg-surface)] to-transparent pointer-events-none rounded-b-lg"})]}),k&&e.jsx("button",{onClick:()=>c(y=>!y),className:"flex items-center justify-center gap-1.5 w-full py-1.5 text-[11px] text-pc-text-muted hover:text-pc-text-secondary bg-pc-elevated/40 hover:bg-pc-elevated/60 border-t border-pc-border transition-colors rounded-b-lg",type:"button",children:l?e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"h-3 w-3"}),e.jsxs("span",{children:["Show all ",g.length," lines"]})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ve,{className:"h-3 w-3"}),e.jsx("span",{children:"Collapse"})]})}),e.jsx("button",{onClick:b,className:`absolute ${h?"top-10":"top-2"} right-2 p-1.5 rounded-lg bg-pc-elevated/60 hover:bg-pc-elevated/80 border border-pc-border-strong text-pc-text-secondary hover:text-pc-text opacity-0 group-hover/code:opacity-100 transition-opacity duration-150`,title:"Copy code","aria-label":"Copy code to clipboard",type:"button",children:s?e.jsx(ye,{className:"h-3.5 w-3.5 text-green-400"}):e.jsx(re,{className:"h-3.5 w-3.5"})})]})}v.registerLanguage("bash",ut);v.registerLanguage("c",dt);v.registerLanguage("cpp",it);v.registerLanguage("css",ct);v.registerLanguage("diff",lt);v.registerLanguage("dockerfile",ot);v.registerLanguage("go",at);v.registerLanguage("ini",nt);v.registerLanguage("java",rt);v.registerLanguage("javascript",st);v.registerLanguage("json",tt);v.registerLanguage("markdown",et);v.registerLanguage("python",Qe);v.registerLanguage("rust",Xe);v.registerLanguage("shell",Ze);v.registerLanguage("sql",Ke);v.registerLanguage("typescript",Ge);v.registerLanguage("xml",Ye);v.registerLanguage("yaml",Je);v.registerAliases(["sh","zsh"],{languageName:"bash"});v.registerAliases(["h"],{languageName:"c"});v.registerAliases(["cc","cxx","c++","hpp","hxx"],{languageName:"cpp"});v.registerAliases(["js","jsx"],{languageName:"javascript"});v.registerAliases(["ts","tsx"],{languageName:"typescript"});v.registerAliases(["py"],{languageName:"python"});v.registerAliases(["html"],{languageName:"xml"});v.registerAliases(["yml"],{languageName:"yaml"});v.registerAliases(["toml","cfg","conf"],{languageName:"ini"});v.registerAliases(["rs"],{languageName:"rust"});const xt={bash:ut,c:dt,cpp:it,css:ct,diff:lt,dockerfile:ot,go:at,ini:nt,java:rt,javascript:st,json:tt,markdown:et,python:Qe,rust:Xe,shell:Ze,sql:Ke,typescript:Ge,xml:Ye,yaml:Je},ps={languages:xt,aliases:{bash:["sh","zsh"],c:["h"],cpp:["cc","cxx","c++","hpp","hxx"],javascript:["js","jsx"],typescript:["ts","tsx"],python:["py"],xml:["html"],yaml:["yml"],ini:["toml","cfg","conf"],rust:["rs"]}},ms=Object.freeze(Object.defineProperty({__proto__:null,default:v,rehypeHighlightLanguages:xt,rehypeHighlightOptions:ps},Symbol.toStringTag,{value:"Module"}));function xs({src:t,alt:s,onClose:r}){const a=o.useCallback(n=>{n.key==="Escape"&&r()},[r]);return o.useEffect(()=>(document.addEventListener("keydown",a),()=>document.removeEventListener("keydown",a)),[a]),e.jsxs("div",{role:"dialog","aria-modal":"true","aria-label":s||"Image preview",className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm animate-fade-in",onClick:r,children:[e.jsx("button",{onClick:r,"aria-label":"Close preview",className:"absolute top-4 right-4 p-2 rounded-full bg-pc-elevated/80 border border-pc-border-strong text-pc-text hover:text-white hover:bg-pc-elevated/80 transition-colors",children:e.jsx(te,{size:20})}),e.jsx("img",{src:t,alt:s||"Image",className:"max-w-[90vw] max-h-[90vh] object-contain rounded-xl shadow-2xl",onClick:n=>n.stopPropagation()})]})}function we({src:t,alt:s}){const[r,a]=o.useState(!1),[n,i]=o.useState(!1),[u,l]=o.useState(!0);return n?e.jsxs("div",{className:"my-2 flex items-center gap-2 px-3 py-2 rounded-xl border border-pc-border bg-pc-elevated/50 text-pc-muted text-sm",children:[e.jsx(Dt,{size:16,className:"shrink-0 opacity-60"}),e.jsx("span",{children:s||"Image failed to load"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"my-2",children:e.jsx("button",{type:"button",onClick:()=>a(!0),"aria-label":`View ${s||"image"} full size`,className:"block rounded-xl border border-pc-border cursor-pointer hover:brightness-110 transition-all focus:outline-none focus:ring-2 focus:ring-[var(--pc-accent-dim)]",children:e.jsxs("div",{className:"relative",children:[u&&e.jsx("div",{className:"w-48 h-32 rounded-xl bg-pc-elevated/50 animate-pulse"}),e.jsx("img",{src:t,alt:s||"Image",className:`max-w-full max-h-80 rounded-xl transition-opacity duration-200${u?" absolute top-0 left-0 opacity-0 pointer-events-none":" opacity-100"}`,onLoad:()=>l(!1),onError:()=>{l(!1),i(!0)}})]})})}),r&&e.jsx(xs,{src:t,alt:s,onClose:()=>a(!1)})]})}function ht(){return o.useContext(Et)}const hs={exec:{r:245,g:158,b:11},web_search:{r:16,g:185,b:129},web_fetch:{r:16,g:185,b:129},Read:{r:14,g:165,b:233},read:{r:14,g:165,b:233},Write:{r:139,g:92,b:246},write:{r:139,g:92,b:246},Edit:{r:139,g:92,b:246},edit:{r:139,g:92,b:246},browser:{r:6,g:182,b:212},image:{r:236,g:72,b:153},message:{r:99,g:102,b:241},memory_search:{r:244,g:63,b:94},memory_get:{r:244,g:63,b:94},cron:{r:249,g:115,b:22},sessions_spawn:{r:20,g:184,b:166}},gs={r:161,g:161,b:170};function fs(t){return`${t.r},${t.g},${t.b}`}function bs(t,s=!1){const r=hs[t]||gs,a=fs(r),n=s?.15:.1,i=s?.08:.05,u=s?`rgb(${Math.round(r.r*.6)},${Math.round(r.g*.6)},${Math.round(r.b*.6)})`:`rgb(${r.r},${r.g},${r.b})`;return{badge:{borderColor:`rgba(${a},0.3)`,backgroundColor:`rgba(${a},${n})`},text:{color:u},expand:{borderColor:`rgba(${a},0.2)`,backgroundColor:`rgba(${a},${i})`},glow:`shadow-[0_0_8px_rgba(${a},0.15)]`}}const vs={exec:"âš¡",web_search:"ğŸ”",web_fetch:"ğŸŒ",search:"ğŸ”",Read:"ğŸ“–",read:"ğŸ“–",Write:"âœï¸",write:"âœï¸",Edit:"âœï¸",edit:"âœï¸",browser:"ğŸŒ",image:"ğŸ–¼ï¸",message:"ğŸ’¬",database:"ğŸ—„ï¸",memory_search:"ğŸ§ ",memory_get:"ğŸ§ ",cron:"â°",sessions_spawn:"ğŸš€",sessions_send:"ğŸ“¨",sessions_list:"ğŸ“‹",sessions_history:"ğŸ“œ",session_status:"ğŸ“Š",tts:"ğŸ”Š",gateway:"âš™ï¸",canvas:"ğŸ¨",nodes:"ğŸ“¡",process:"âš™ï¸",voice_call:"ğŸ“"};function js(t){return vs[t]||"ğŸ”§"}function ys(t,s=120){return t?U(t,s):""}function ws(t){const s=t.split(`
`);if(s.length<2)return!1;const r=t.trim();if(r.startsWith("{")&&r.endsWith("}")||r.startsWith("[")&&r.endsWith("]"))return!0;const a=[/^(import|export|const|let|var|function|class|fn|pub|use|def|from)\s/,/[{};]\s*$/,/^\s*(if|else|for|while|return)\b/,/^\s*(\/\/|#|\/\*)/,/=>\s*[{(]/,/^\s*<\/?[A-Z]/];let n=0;for(const l of s)for(const c of a)if(c.test(l)){n++;break}if(n/s.length>.2)return!0;const i=[/^[/~]/,/^\s*\$\s/,/^[A-Z_]+=/,/error|warning|failed/i,/\.\w{1,4}:\d+/,/â”œ|â””|â”‚/];let u=0;for(const l of s)for(const c of i)if(c.test(l)){u++;break}return u/s.length>.3}function ks(t){if(!t||!ws(t))return null;try{return v.highlightAuto(t).value}catch{return null}}function ue({wrap:t,onToggle:s}){return e.jsx("button",{onClick:s,className:"absolute top-2 right-8 p-1 rounded-lg bg-pc-elevated/60 hover:bg-pc-elevated/80 border border-pc-border-strong text-pc-text-secondary hover:text-pc-text opacity-0 group-hover/tc-block:opacity-100 transition-opacity duration-150",title:t?"No wrap":"Word wrap","aria-label":"Toggle word wrap",type:"button",children:t?e.jsx(Ue,{className:"h-3 w-3"}):e.jsx(We,{className:"h-3 w-3"})})}function pe({text:t}){const[s,r]=o.useState(!1),a=o.useCallback(n=>{n.stopPropagation(),n.preventDefault(),se(t).then(i=>{i&&(r(!0),setTimeout(()=>r(!1),2e3))})},[t]);return e.jsx("button",{onClick:a,className:"absolute top-2 right-2 p-1 rounded-lg bg-pc-elevated/60 hover:bg-pc-elevated/80 border border-pc-border-strong text-pc-text-secondary hover:text-pc-text opacity-0 group-hover/tc-block:opacity-100 transition-opacity duration-150",title:s?"Copied!":"Copy","aria-label":"Copy to clipboard",type:"button",children:s?e.jsx(ye,{className:"h-3 w-3 text-green-400"}):e.jsx(re,{className:"h-3 w-3"})})}function me({text:t,className:s,wrap:r}){const a=o.useMemo(()=>ks(t),[t]),n=r?"whitespace-pre-wrap break-words overflow-x-hidden":"";return a?e.jsx("pre",{className:`${s} ${n}`,children:e.jsx("code",{className:"hljs",dangerouslySetInnerHTML:{__html:a}})}):e.jsx("pre",{className:`${s} ${n}`,children:t})}function R(t){return typeof t=="string"?t:null}function Ns(t,s){if(!s||typeof s!="object")return null;switch(t){case"exec":return R(s.command)?U(R(s.command),60):null;case"Read":case"read":case"Write":case"write":case"Edit":case"edit":return R(s.file_path)||R(s.path)||null;case"web_search":return R(s.query)?U(R(s.query),50):null;case"web_fetch":return R(s.url)?U(R(s.url),60):null;case"browser":return R(s.action)||null;case"message":{const r=R(s.action),a=R(s.target);return r?`${r}${a?" â†’ "+a:""}`:null}case"memory_search":return R(s.query)?U(R(s.query),50):null;case"memory_get":return R(s.path)||null;case"cron":return R(s.action)||null;case"sessions_spawn":return R(s.task)?U(R(s.task),50):null;case"image":return R(s.prompt)?U(R(s.prompt),50):null;default:return null}}function U(t,s){const r=t.replace(/\n/g," ").trim();return r.length<=s?r:r.slice(0,s)+"â€¦"}function Ss(t){if(!t)return null;const s=t.match(/(data:image\/[a-z+]+;base64,[A-Za-z0-9+/=\s]+)/);if(s){const a=s[1].replace(/\s/g,""),n=t.replace(s[0],"").trim();return{src:a,remaining:n}}const r=t.match(/^.*?\[image\/(png|jpeg|jpg|gif|webp)\].*$/m);if(r){const a=`image/${r[1]}`,i=t.slice(t.indexOf(r[0])+r[0].length).match(/([A-Za-z0-9+/=\n]{100,})/);if(i){const u=i[1].replace(/\n/g,"");return{src:`data:${a};base64,${u}`,remaining:r[0]}}}return null}function De({name:t,input:s,result:r}){const a=B(),[n,i]=o.useState(!1),[u,l]=o.useState(!0),{globalState:c,version:h}=ht(),{resolvedTheme:p}=Be(),g=o.useRef(h),d=bs(t,p==="light");o.useEffect(()=>{h!==g.current&&(g.current=h,c==="collapse-all"?i(!1):c==="expand-all"&&i(!0))},[c,h]);const k=s?typeof s=="string"?s:JSON.stringify(s,null,2):"",b=Ns(t,s);return e.jsxs("div",{className:"my-2",children:[e.jsxs("button",{onClick:()=>i(!n),className:`inline-flex items-center gap-1.5 rounded-2xl border px-3 py-1.5 text-xs hover:brightness-125 transition-all max-w-full ${d.glow}`,style:{...d.badge,...d.text},"aria-expanded":n,"aria-label":`${t}${b?` â€” ${b}`:""}: ${n?"collapse":"expand"} details`,children:[e.jsx("span",{className:"text-[13px] leading-none",children:js(t)}),e.jsx("span",{className:"font-mono font-semibold shrink-0",children:t}),b&&e.jsx("span",{className:"opacity-60 truncate font-mono text-[11px]",children:b}),n?e.jsx(J,{size:12,className:"ml-1 opacity-60"}):e.jsx(He,{size:12,className:"ml-1 opacity-60"})]}),r&&!n&&e.jsx("div",{className:"mt-1 text-[11px] text-pc-text-secondary pl-2 truncate max-w-full",children:ys(r)}),n&&e.jsxs("div",{className:"mt-2 rounded-2xl border p-3 space-y-2 overflow-hidden min-w-0",style:d.expand,children:[k&&e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] opacity-70 mb-1 font-medium",style:d.text,children:a("tool.parameters")}),e.jsxs("div",{className:"group/tc-block relative",children:[e.jsx(me,{text:k,className:"text-xs bg-[var(--pc-bg-input)]/60 border border-pc-border p-2.5 rounded-xl overflow-x-auto text-pc-text font-mono",wrap:u}),e.jsx(ue,{wrap:u,onToggle:()=>l(!u)}),e.jsx(pe,{text:k})]})]}),r&&(()=>{const j=Ss(r);return e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] opacity-70 mb-1 font-medium",style:d.text,children:a("tool.result")}),j?e.jsxs(e.Fragment,{children:[j.remaining&&e.jsxs("div",{className:"group/tc-block relative",children:[e.jsx(me,{text:j.remaining,className:"text-xs bg-[var(--pc-bg-input)]/60 border border-pc-border p-2.5 rounded-xl overflow-x-auto text-pc-text font-mono mb-2",wrap:u}),e.jsx(ue,{wrap:u,onToggle:()=>l(!u)}),e.jsx(pe,{text:j.remaining})]}),e.jsx(we,{src:j.src,alt:`${t} result`})]}):e.jsxs("div",{className:"group/tc-block relative",children:[e.jsx(me,{text:r,className:"text-xs bg-[var(--pc-bg-input)]/60 border border-pc-border p-2.5 rounded-xl overflow-x-auto text-pc-text max-h-64 overflow-y-auto font-mono",wrap:u}),e.jsx(ue,{wrap:u,onToggle:()=>l(!u)}),e.jsx(pe,{text:r})]})]})})()]})]})}function Cs(t,s,r){return r||(s?`data:${t};base64,${s}`:"")}function _s({src:t}){const[s,r]=o.useState(!1);return s?e.jsx(ne,{className:"h-4 w-4 text-pc-accent-light"}):e.jsx("img",{src:t,alt:"Agent",className:"h-full w-full object-cover",onError:()=>r(!0)})}function gt(){return Pe()==="fr"?"fr-FR":"en-US"}function Es(t){const s=gt(),r=new Date(t),a=new Date,n=r.toLocaleTimeString(s,{hour:"2-digit",minute:"2-digit"}),i=r.toDateString()===a.toDateString(),u=new Date(a);u.setDate(u.getDate()-1);const l=r.toDateString()===u.toDateString();return i?n:l?`${S("time.yesterday")} ${n}`:`${r.toLocaleDateString(s,{day:"numeric",month:"short"})} ${n}`}function Ls(t){const s=gt();return new Date(t).toLocaleString(s,{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"})}function ke({ts:t,className:s}){return e.jsx("time",{dateTime:new Date(t).toISOString(),title:Ls(t),className:s,children:Es(t)})}function Te(t){const s=t.join(`
`);return/^import .+ from ['"]/.test(s)||/^export (function|const|default|class|interface|type) /.test(s)||/React\./.test(s)||/<\w+[\s/>]/.test(s)&&/className=/.test(s)?"tsx":/^(import|export|const|let|var|function|class|interface|type) /.test(s)||/=>\s*{/.test(s)||/: (string|number|boolean|any)\b/.test(s)?"typescript":/^(use |fn |let mut |pub |impl |struct |enum |mod |crate::)/.test(s)||/-> (Self|Result|Option|Vec|String|bool|i32|u32)/.test(s)?"rust":/^(def |class |import |from .+ import |if __name__)/.test(s)||/self\.\w+/.test(s)&&!/this\./.test(s)?"python":/^\s*(server|location|upstream|proxy_pass|listen \d)/.test(s)?"nginx":/^\[.*\]\s*$/.test(t[0]||"")&&/=/.test(s)?"ini":/^(apiVersion|kind|metadata|spec):/.test(s)?"yaml":/^\{/.test(s.trim())&&/\}$/.test(s.trim())?"json":/^#!\/(bin|usr)/.test(s)||/^\s*(if \[|then|fi|echo |export |source )/.test(s)?"bash":/^(<!DOCTYPE|<html|<div|<head|<body)/.test(s)?"html":/^\.\w+\s*\{|^@(media|keyframes|import)/.test(s)?"css":/^(SELECT|INSERT|CREATE|ALTER|DROP|UPDATE) /i.test(s)?"sql":""}function Ie(t){if(t.length<2)return!1;const s=t.join(`
`);if(/\*\*[^*]+\*\*/.test(s)||/^#{1,6}\s/m.test(s)||/^\s*[-*+]\s/m.test(s))return!1;let r=0;const a=[/^(import|export|const|let|var|function|class|interface|type|enum|struct|fn|pub|use|def|from|module|package|namespace)\s/,/[{};]\s*$/,/^\s*(if|else|for|while|return|match|switch|case|break|continue)\b/,/^\s*(\/\/|\/\*)/,/^\s*#\s*(?:include|define|ifdef|ifndef|endif|pragma|import)\b/,/[â”œâ””â”‚â”¬â”€]â”€â”€/,/^\s+\w+\(.*\)/,/^\s*<\/?[A-Z]\w*/,/=>\s*[{(]/,/\.\w+\(.*\)\s*[;,]?\s*$/];for(const n of t)for(const i of a)if(i.test(n)){r++;break}return r/t.length>.3}function be(t){if(t.includes("```"))return t;const s=t.split(`
`),r=s.filter(l=>l.trim());if(r.length>=3&&Ie(r))return"```"+Te(r)+`
`+t+"\n```";const a=[];let n=[];const i=()=>{if(n.length>=3&&Ie(n)){const l=Te(n);a.push("```"+l),a.push(...n),a.push("```")}else a.push(...n);n=[]},u=l=>/^[\s]+(import|export|const|let|var|function|return|if|else|for)/.test(l)||/[{};]\s*$/.test(l)||/^\s*\/\//.test(l)||/[â”œâ””â”‚â”¬â”€]â”€â”€/.test(l)||/^\s+\w+\(.*\)/.test(l);for(const l of s)u(l)||n.length>0&&(l.trim()===""||/^\s{2,}/.test(l))?n.push(l):(i(),a.push(l));return i(),a.join(`
`)}function Y(t){return t.filter(s=>s.type==="text"&&s.text.trim())}function ft(t){return t.filter(s=>s.type==="image")}function bt(t){return t.filter(s=>s.type==="thinking"||s.type==="tool_use"||s.type==="tool_result")}function $s(t){return e.jsx(we,{src:t.src||"",alt:t.alt})}function Rs(t){const{href:s,children:r,...a}=t,n=s&&/^https?:\/\//.test(s);return e.jsx("a",{href:s,...n?{target:"_blank",rel:"noopener noreferrer"}:{},...a,children:r})}const ve={pre:us,img:$s,a:Rs},Ds=3e3,Ts=400;function Is({content:t,isStreaming:s,children:r}){const[a,n]=o.useState(!1),i=!s&&t.length>Ds;return!i||a?e.jsxs(e.Fragment,{children:[r,i&&a&&e.jsxs("button",{onClick:()=>n(!1),className:"mt-2 flex items-center gap-1 text-xs text-pc-accent-light hover:text-pc-accent transition-colors",children:[e.jsx(J,{size:12,className:"rotate-180"}),e.jsx("span",{children:S("message.showLess")})]})]}):e.jsxs("div",{className:"relative",children:[e.jsx("div",{style:{maxHeight:`${Ts}px`,overflow:"hidden"},children:r}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-24 bg-gradient-to-t from-[var(--pc-bg-elevated)] to-transparent pointer-events-none"}),e.jsxs("button",{onClick:()=>n(!0),className:"relative mt-1 flex items-center gap-1 text-xs text-pc-accent-light hover:text-pc-accent transition-colors",children:[e.jsx(J,{size:12}),e.jsx("span",{children:S("message.showMore")})]})]})}function Ae(t){return Y(t).map((s,r)=>e.jsx("div",{className:"markdown-body",children:e.jsx(fe,{components:ve,children:be(s.text)})},`text-${r}`))}function As(t){return ft(t).map((s,r)=>{const a=s,n=Cs(a.mediaType,a.data,a.url);return n?e.jsx(we,{src:n,alt:"Image"},`img-${r}`):null})}function vt(t){const s=[],r=bt(t);for(let a=0;a<r.length;a++){const n=r[a];if(n.type==="thinking")s.push(e.jsx(ns,{text:n.text},`int-${a}`));else if(n.type==="tool_use"){const i=r[a+1],u=i?.type==="tool_result"?i.content:void 0;s.push(e.jsx(De,{name:n.name,input:n.input,result:u},`int-${a}`)),u!==void 0&&a++}else n.type==="tool_result"&&s.push(e.jsx(De,{name:n.name||"tool",result:n.content},`int-${a}`))}return s}function Ms({blocks:t}){return bt(t).length===0?null:e.jsx("div",{className:"mt-2 space-y-1",children:vt(t)})}function zs({message:t}){return e.jsxs("div",{className:"animate-fade-in flex gap-3 px-4 py-1",children:[e.jsx("div",{className:"shrink-0 mt-0.5 flex h-6 w-6 items-center justify-center rounded-xl border border-pc-border bg-pc-elevated/30",children:e.jsx(Pt,{className:"h-3 w-3 text-pc-text-muted"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"space-y-1",children:vt(t.blocks)}),t.timestamp&&e.jsx("div",{className:"mt-0.5 text-[10px] text-pc-text-faint",children:e.jsx(ke,{ts:t.timestamp})})]})]})}function Os({metadata:t}){const[s,r]=o.useState(!1),a=o.useRef(null),n=o.useRef(null),[i,u]=o.useState(null);return o.useEffect(()=>{if(!s)return;const l=a.current;if(l){const h=l.getBoundingClientRect();u({top:h.top-4,left:h.left})}const c=h=>{n.current&&!n.current.contains(h.target)&&!a.current?.contains(h.target)&&r(!1)};return document.addEventListener("mousedown",c),()=>document.removeEventListener("mousedown",c)},[s]),!t||Object.keys(t).length===0?null:e.jsxs("div",{className:"relative inline-block",children:[e.jsx("button",{ref:a,onClick:()=>r(l=>!l),className:"h-7 w-7 rounded-lg border border-pc-border bg-pc-elevated/80 backdrop-blur-sm flex items-center justify-center text-pc-text-secondary hover:text-pc-accent-light hover:border-[var(--pc-accent-dim)] transition-all opacity-0 group-hover:opacity-100",title:S("message.metadata"),"aria-label":S("message.metadata"),children:e.jsx(Ft,{size:13})}),s&&i&&_t.createPortal(e.jsx("div",{ref:n,className:"fixed z-[9999] w-72 max-h-64 overflow-auto rounded-xl border border-pc-border-strong bg-pc-input/95 backdrop-blur-md shadow-xl p-3 text-[11px] text-pc-text-secondary font-mono leading-relaxed custom-scrollbar",style:{top:i.top,left:i.left,transform:"translateY(-100%)"},children:Object.entries(t).map(([l,c])=>e.jsxs("div",{className:"flex gap-2 py-0.5",children:[e.jsxs("span",{className:"text-pc-accent/70 shrink-0",children:[l,":"]}),e.jsx("span",{className:"text-pc-text break-all",children:typeof c=="object"?JSON.stringify(c):String(c)})]},l))}),document.body)]})}function Bs({isOpen:t,onToggle:s}){return e.jsx("button",{onClick:s,className:`h-7 w-7 rounded-lg border border-pc-border bg-pc-elevated/80 backdrop-blur-sm flex items-center justify-center transition-all opacity-0 group-hover:opacity-100 ${t?"text-pc-accent-light border-[var(--pc-accent-dim)]":"text-pc-text-secondary hover:text-pc-accent-light hover:border-[var(--pc-accent-dim)]"}`,title:t?S("message.hideRawJson"):S("message.rawJson"),"aria-label":S("message.rawJson"),children:e.jsx(Ht,{size:13})})}function Ps({message:t}){const[s,r]=o.useState(!1),a=JSON.stringify(t,null,2),n=o.useCallback(()=>{se(a).then(i=>{i&&(r(!0),setTimeout(()=>r(!1),2e3))})},[a]);return e.jsxs("div",{className:"mt-2 rounded-xl border border-pc-border-strong bg-pc-base/80 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-1.5 border-b border-pc-border bg-pc-elevated/30",children:[e.jsx("span",{className:"text-[11px] font-medium text-pc-text-muted",children:"Raw JSON"}),e.jsx("button",{onClick:n,className:"h-6 w-6 rounded-md flex items-center justify-center text-pc-text-secondary hover:text-pc-accent-light transition-colors",title:s?S("message.copied"):S("message.copy"),"aria-label":s?S("message.copied"):S("message.copy"),children:s?e.jsx(ye,{size:12,className:"text-emerald-400"}):e.jsx(re,{size:12})})]}),e.jsx("pre",{className:"p-3 text-[11px] leading-relaxed text-pc-text-secondary font-mono overflow-auto max-h-80 custom-scrollbar whitespace-pre-wrap break-all",children:a})]})}function X(t){return t.blocks.length>0?Y(t.blocks).map(s=>s.text).join(`

`):t.content}function Fs({message:t}){const s=t.content||Y(t.blocks).map(n=>n.text).join(" "),r=s.replace(/^\[.*?\]\s*/,"").trim()||s.trim(),a=s.match(/^\[([^\]]+)\]/)?.[1]||"system";return e.jsx("div",{className:"animate-fade-in flex items-center justify-center gap-2 px-4 py-1.5 my-0.5",children:e.jsxs("div",{className:"flex items-center gap-1.5 max-w-[85%] rounded-full px-3 py-1 bg-pc-elevated/30 border border-pc-border",children:[e.jsx(Bt,{className:"h-3 w-3 text-pc-text-muted shrink-0"}),e.jsx("span",{className:"text-[11px] font-medium text-pc-text-muted shrink-0",children:a}),e.jsx("span",{className:"text-[11px] text-pc-text-muted truncate",children:r}),t.timestamp&&e.jsx(ke,{ts:t.timestamp,className:"text-[10px] text-pc-text-faint shrink-0 ml-1"})]})})}const Hs=o.memo(function({message:s,onRetry:r,onReply:a,agentAvatarUrl:n,isFirstInGroup:i=!0,isBookmarked:u=!1,onToggleBookmark:l}){Lt();const{resolvedTheme:c}=Be(),h=c==="light",[p,g]=o.useState(!1),d=o.useMemo(()=>{if(s.role!=="user")return s;const j=s.content||"",E=Y(s.blocks),M=_e(j),I=E.some(N=>_e(N.text));if(!M&&!I)return s;const L={...s};return L.content&&(L.content=Ee(L.content)),L.blocks.length>0&&(L.blocks=L.blocks.map(N=>{if(N.type==="text"){const y=N;return{...y,text:Ee(y.text)}}return N})),L},[s]),k=s!==d,b=d.role==="user";if(d.isSystemEvent)return e.jsx(Fs,{message:s});if(!b&&d.blocks.length>0){const j=Y(d.blocks),E=ft(d.blocks);if(!(j.length>0||E.length>0||d.isStreaming&&d.content?.trim())&&!d.isStreaming)return e.jsx(zs,{message:d})}return e.jsxs("div",{className:`animate-fade-in flex gap-3 px-4 ${i?"py-2":"py-0.5"} ${b?"flex-row-reverse":""} ${d.sendStatus==="sending"?"opacity-70":""} ${d.sendStatus==="error"?"opacity-60":""}`,children:[e.jsx("div",{className:`shrink-0 mt-1 flex h-9 w-9 items-center justify-center rounded-2xl overflow-hidden ${i?"border border-pc-border bg-pc-elevated/40":""}`,children:i?b?e.jsx(Tt,{className:"h-4 w-4 text-pc-accent-light"}):n?e.jsx(_s,{src:n}):e.jsx(ne,{className:"h-4 w-4 text-pc-accent-light"}):null}),e.jsxs("div",{className:`min-w-0 max-w-[80%] ${b?"text-right":""}`,children:[e.jsxs("div",{className:`group relative inline-block text-left rounded-3xl px-4 py-3 text-sm leading-relaxed max-w-full overflow-hidden ${b?h?"bg-[rgba(var(--pc-accent-rgb),0.12)] text-pc-text border border-[rgba(var(--pc-accent-rgb),0.3)]":"bg-[rgba(var(--pc-accent-rgb),0.08)] text-pc-text border border-[rgba(var(--pc-accent-rgb),0.2)]":"bg-pc-elevated/40 text-pc-text border border-pc-border shadow-[0_0_0_1px_rgba(255,255,255,0.03)]"}`,children:[b?d.blocks.length>0?Ae(d.blocks):e.jsx("div",{className:"markdown-body",children:e.jsx(fe,{components:ve,children:be(d.content)})}):e.jsx(Is,{content:d.content||"",isStreaming:d.isStreaming,children:d.blocks.length>0?Ae(d.blocks):e.jsx("div",{className:"markdown-body",children:e.jsx(fe,{components:ve,children:be(d.content)})})}),As(d.blocks),d.isStreaming&&(d.content?.trim()?e.jsxs("div",{className:"flex gap-1 mt-2",children:[e.jsx("span",{className:"bounce-dot w-1.5 h-1.5 rounded-full bg-gradient-to-r from-cyan-300/80 to-violet-400/80 inline-block"}),e.jsx("span",{className:"bounce-dot w-1.5 h-1.5 rounded-full bg-gradient-to-r from-cyan-300/80 to-violet-400/80 inline-block"}),e.jsx("span",{className:"bounce-dot w-1.5 h-1.5 rounded-full bg-gradient-to-r from-cyan-300/80 to-violet-400/80 inline-block"})]}):e.jsx(as,{})),!b&&e.jsx(Ms,{blocks:d.blocks}),p&&e.jsx(Ps,{message:s}),e.jsxs("div",{className:"flex flex-nowrap gap-0.5 justify-end mt-1.5 -mb-1 opacity-0 group-hover:opacity-100 transition-all",children:[!b&&!d.isStreaming&&X(d).trim()&&e.jsx("button",{onClick:()=>{se(X(d))},className:"h-6 w-6 rounded-md flex items-center justify-center text-pc-text-faint hover:text-pc-accent-light transition-colors",title:S("message.copy"),"aria-label":S("message.copy"),children:e.jsx(re,{size:12})}),a&&e.jsx("button",{onClick:j=>{j.stopPropagation(),a(X(d).slice(0,120))},className:"h-6 w-6 rounded-md flex items-center justify-center text-pc-text-faint hover:text-pc-accent-light transition-colors",title:S("message.reply"),"aria-label":S("message.reply"),children:e.jsx(qe,{size:12})}),l&&e.jsx("button",{onClick:j=>{j.stopPropagation(),l()},className:`h-6 w-6 rounded-md flex items-center justify-center transition-colors ${u?"text-amber-400":"text-pc-text-faint hover:text-amber-400"}`,title:u?S("message.removeBookmark"):S("message.bookmark"),"aria-label":u?S("message.removeBookmark"):S("message.bookmark"),children:e.jsx(he,{size:12,className:u?"fill-amber-400":""})}),b&&r&&e.jsx("button",{onClick:()=>r(X(d)),className:`h-6 w-6 rounded-md flex items-center justify-center transition-colors ${d.sendStatus==="error"?"text-red-400":"text-pc-text-faint hover:text-pc-accent-light"}`,title:S("message.retry"),"aria-label":S("message.retry"),children:e.jsx(It,{size:12})}),e.jsx(Os,{metadata:d.metadata}),e.jsx(Bs,{isOpen:p,onToggle:()=>g(j=>!j)})]})]}),(d.timestamp||k||u)&&e.jsxs("div",{className:`mt-1 flex items-center gap-1.5 text-[11px] text-pc-text-muted ${b?"justify-end pr-2":"pl-2"}`,children:[u&&e.jsx(he,{size:10,className:"text-amber-400 fill-amber-400"}),k&&e.jsxs("span",{className:"inline-flex items-center gap-0.5 text-[10px] text-pc-text-faint",title:"Webhook message (scaffolding stripped)",children:[e.jsx(At,{size:10,className:"opacity-60"}),e.jsx("span",{children:"webhook"})]}),d.timestamp&&e.jsx(ke,{ts:d.timestamp}),!b&&d.generationTimeMs!=null&&e.jsxs("span",{className:"text-[10px] text-pc-text-faint",title:"Generation time",children:["Â· ",d.generationTimeMs<1e3?`${d.generationTimeMs}ms`:`${(d.generationTimeMs/1e3).toFixed(1)}s`]}),b&&d.sendStatus==="sending"&&e.jsx("span",{title:"Sending...",children:e.jsx(Mt,{size:10,className:"animate-pulse text-pc-text-faint"})}),b&&d.sendStatus==="sent"&&e.jsx("span",{title:"Sent",children:e.jsx(zt,{size:10,className:"text-pc-accent"})}),b&&d.sendStatus==="error"&&e.jsx("span",{title:"Failed to send",children:e.jsx(Ot,{size:10,className:"text-red-400"})})]})]})]})}),Us=[{command:"/status",descKey:"slash.status"},{command:"/reasoning",args:"on|off|stream",descKey:"slash.reasoning"},{command:"/verbose",args:"on|off",descKey:"slash.verbose"},{command:"/model",args:"<model>",descKey:"slash.model"},{command:"/compact",descKey:"slash.compact"},{command:"/reset",descKey:"slash.reset"},{command:"/help",descKey:"slash.help"}];function Ws({query:t,visible:s,onSelect:r,onClose:a}){const n=B(),[i,u]=o.useState(0),l=o.useRef(null),c=Us.filter(p=>p.command.startsWith(t.toLowerCase().split(" ")[0]||"/"));o.useEffect(()=>{u(0)},[t]);const h=o.useCallback(p=>{if(!(!s||c.length===0))if(p.key==="ArrowDown")p.preventDefault(),u(g=>(g+1)%c.length);else if(p.key==="ArrowUp")p.preventDefault(),u(g=>(g-1+c.length)%c.length);else if(p.key==="Tab"||p.key==="Enter"){if(c.length>0){p.preventDefault(),p.stopPropagation();const g=c[i];r(g.args?g.command+" ":g.command)}}else p.key==="Escape"&&(p.preventDefault(),a())},[s,c,i,r,a]);return o.useEffect(()=>{if(s)return document.addEventListener("keydown",h,!0),()=>document.removeEventListener("keydown",h,!0)},[s,h]),o.useEffect(()=>{l.current&&l.current.children[i]?.scrollIntoView({block:"nearest"})},[i]),!s||c.length===0?null:e.jsx("div",{ref:l,className:"absolute bottom-full left-0 right-0 mb-2 mx-3 max-h-[200px] overflow-y-auto rounded-2xl border border-pc-border bg-[var(--pc-bg-surface)] backdrop-blur-xl shadow-lg z-50",role:"listbox","aria-label":n("slash.commands"),children:c.map((p,g)=>e.jsxs("button",{role:"option","aria-selected":g===i,className:`w-full flex items-center gap-3 px-4 py-2.5 text-left text-sm transition-colors ${g===i?"bg-[var(--pc-accent-glow)] text-pc-text":"text-pc-text-secondary hover:bg-[var(--pc-hover)]"}`,onMouseDown:d=>{d.preventDefault(),r(p.args?p.command+" ":p.command)},onMouseEnter:()=>u(g),children:[e.jsx("span",{className:"font-mono font-semibold text-pc-accent-light",children:p.command}),p.args&&e.jsx("span",{className:"text-xs text-pc-text-muted font-mono",children:p.args}),e.jsx("span",{className:"ml-auto text-xs text-pc-text-muted",children:n(p.descKey)})]},p.command))})}function Me(t){const s=t.trimStart();return s.startsWith("/")&&!s.includes(`
`)}const Vs=o.lazy(()=>W(()=>import("./markdown-Bg1H1bKC.js").then(t=>t.n),__vite__mapDeps([0,1]))),qs=W(()=>import("./markdown-Bg1H1bKC.js").then(t=>t.o),__vite__mapDeps([0,1])).then(t=>t.default);let je=null;qs.then(t=>{je=t});const Js=300*1024,Q=1280;function Ys(t){return new Promise((s,r)=>{const a=new FileReader;a.onload=()=>{const i=a.result.split(",")[1]||"";s(i)},a.onerror=r,a.readAsDataURL(t)})}function Gs(t,s){return new Promise((r,a)=>{const n=new Image,i=URL.createObjectURL(t);n.onload=()=>{URL.revokeObjectURL(i);let{width:u,height:l}=n;if(u>Q||l>Q){const d=Math.min(Q/u,Q/l);u=Math.round(u*d),l=Math.round(l*d)}const c=document.createElement("canvas");c.width=u,c.height=l;const h=c.getContext("2d");h.drawImage(n,0,0,u,l);for(let d=.85;d>=.2;d-=.05){const b=c.toDataURL("image/jpeg",d).split(",")[1]||"";if(b.length<=s)return r({base64:b,mimeType:"image/jpeg"})}const p=.5;c.width=Math.round(u*p),c.height=Math.round(l*p),h.drawImage(n,0,0,c.width,c.height);const g=c.toDataURL("image/jpeg",.3);r({base64:g.split(",")[1]||"",mimeType:"image/jpeg"})},n.onerror=a,n.src=i})}function Ks(t){return t<1024?`${t}B`:t<1024*1024?`${(t/1024).toFixed(0)}KB`:`${(t/(1024*1024)).toFixed(1)}MB`}function Zs({onSend:t,onAbort:s,isGenerating:r,disabled:a,sessionKey:n,replyTo:i,onCancelReply:u}){const l=B(),{sendOnEnter:c,toggle:h}=$t(),[p,g]=o.useState(""),[d,k]=o.useState([]),[b,j]=o.useState(!1),[E,M]=o.useState(()=>localStorage.getItem("startlobster-md-preview")==="1"),[I,L]=o.useState(!1),N=o.useRef(null),y=o.useRef(null),_=o.useRef(new Map),z=o.useRef(n);o.useEffect(()=>{const x=z.current;if(x&&x!==n){const w=N.current?.value??p;w.trim()?_.current.set(x,w):_.current.delete(x)}const D=n?_.current.get(n)??"":"";g(D),z.current=n},[n]),o.useEffect(()=>{N.current&&(N.current.style.height="auto",N.current.style.height=Math.min(N.current.scrollHeight,200)+"px")},[p]),o.useEffect(()=>{if(!a&&N.current){const x=setTimeout(()=>N.current?.focus(),50);return()=>clearTimeout(x)}},[n,a]);const O=o.useCallback(async x=>{const D=[];for(const w of Array.from(x)){if(w.size>20*1024*1024)continue;const T=w.type.startsWith("image/");let A,F;if(T){const K=await Gs(w,Js);A=K.base64,F=K.mimeType}else A=await Ys(w),F=w.type||"application/octet-stream";D.push({id:`${Date.now()}-${Math.random().toString(36).slice(2,8)}`,file:w,base64:A,mimeType:F,preview:T?`data:${F};base64,${A}`:void 0})}k(w=>[...w,...D])},[]),G=o.useCallback(x=>{k(D=>D.filter(w=>w.id!==x))},[]),P=()=>{const x=p.trim();if(!x&&d.length===0||a)return;const D=d.length>0?d.map(T=>({mimeType:T.mimeType,fileName:T.file.name,content:T.base64})):void 0;let w=x||" ";i?.preview&&(w=`> ${i.preview.split(`
`)[0].slice(0,80)}

${w}`),t(w,D),g(""),k([]),L(!1),u?.(),n&&_.current.delete(n)},ae=x=>{x.key==="Enter"&&(c?!x.shiftKey&&!x.ctrlKey&&!x.metaKey&&(x.preventDefault(),P()):(x.ctrlKey||x.metaKey)&&(x.preventDefault(),P()))},V=o.useCallback(x=>{const D=x.clipboardData?.items;if(!D)return;const w=[];for(const T of Array.from(D))if(T.kind==="file"){const A=T.getAsFile();A&&w.push(A)}w.length>0&&(x.preventDefault(),O(w))},[O]),oe=o.useCallback(x=>{x.preventDefault(),j(!0)},[]),le=o.useCallback(x=>{x.preventDefault(),j(!1)},[]),ce=o.useCallback(x=>{x.preventDefault(),j(!1),x.dataTransfer.files.length>0&&O(x.dataTransfer.files)},[O]);return e.jsx("div",{className:"border-t border-pc-border bg-[var(--pc-bg-input)]/60 backdrop-blur-xl p-4 print-hide",role:"form","aria-label":l("chat.inputLabel"),onDragOver:oe,onDragLeave:le,onDrop:ce,children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs("div",{className:`relative rounded-3xl border bg-[var(--pc-bg-surface)]/40 p-3 shadow-[0_0_0_1px_rgba(255,255,255,0.03)] transition-colors ${b?"border-[var(--pc-accent-dim)] bg-[var(--pc-accent-glow)]":"border-pc-border"}`,children:[e.jsx(Ws,{query:p,visible:I,onSelect:x=>{g(x),L(Me(x)),N.current?.focus()},onClose:()=>L(!1)}),i&&e.jsxs("div",{className:"flex items-center gap-2 mb-2 px-1 py-2 rounded-xl border-l-2 border-[var(--pc-accent)] bg-[rgba(var(--pc-accent-rgb),0.06)]",children:[e.jsx(qe,{size:14,className:"shrink-0 text-pc-accent-light ml-2"}),e.jsx("span",{className:"text-xs text-pc-text-secondary truncate flex-1",children:i.preview||"â€¦"}),e.jsx("button",{onClick:u,className:"shrink-0 h-5 w-5 rounded-md flex items-center justify-center text-pc-text-muted hover:text-pc-text-secondary transition-colors mr-1","aria-label":"Cancel reply",children:e.jsx(te,{size:12})})]}),d.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mb-3 px-1",children:d.map(x=>e.jsxs("div",{className:"group relative flex items-center gap-2 rounded-2xl border border-pc-border bg-pc-elevated/50 px-3 py-2 text-xs text-pc-text-secondary",children:[x.preview?e.jsx("img",{src:x.preview,alt:"",className:"h-8 w-8 rounded-lg object-cover"}):e.jsx(Ut,{size:16,className:"text-pc-text-muted shrink-0"}),e.jsxs("div",{className:"min-w-0 max-w-[120px]",children:[e.jsx("div",{className:"truncate text-pc-text",children:x.file.name}),e.jsx("div",{className:"text-[10px] text-pc-text-muted",children:Ks(x.file.size)})]}),e.jsx("button",{onClick:()=>G(x.id),className:"absolute -top-1.5 -right-1.5 h-5 w-5 rounded-full bg-pc-elevated border border-pc-border-strong flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity hover:bg-red-500/80",children:e.jsx(te,{size:10,className:"text-pc-text"})})]},x.id))}),E&&p.trim()&&e.jsx("div",{className:"mb-3 px-1 max-h-[200px] overflow-y-auto rounded-2xl border border-pc-border bg-pc-elevated/30 p-3 text-sm text-pc-text prose prose-invert prose-sm max-w-none [&_pre]:bg-pc-elevated [&_pre]:rounded-lg [&_pre]:p-2 [&_code]:text-cyan-300 [&_a]:text-cyan-400",children:e.jsx(o.Suspense,{fallback:e.jsx("span",{className:"text-pc-text-muted text-xs",children:"Loadingâ€¦"}),children:e.jsx(Vs,{remarkPlugins:je?[je]:[],children:p})})}),e.jsxs("div",{className:"flex items-end gap-3",children:[e.jsx("button",{onClick:()=>y.current?.click(),disabled:a,className:"shrink-0 h-11 w-11 rounded-2xl border border-pc-border bg-pc-elevated/30 flex items-center justify-center text-pc-text-secondary hover:text-pc-accent-light hover:bg-[var(--pc-hover)] transition-colors disabled:opacity-30",title:l("chat.attachFile"),"aria-label":l("chat.attachFile"),children:e.jsx(Wt,{size:18})}),e.jsx("button",{onClick:()=>M(x=>{const D=!x;return localStorage.setItem("startlobster-md-preview",D?"1":"0"),D}),className:`hidden sm:flex shrink-0 h-11 w-11 rounded-2xl border border-pc-border bg-pc-elevated/30 items-center justify-center transition-colors ${E?"text-pc-accent-light bg-[var(--pc-accent-glow)]":"text-pc-text-secondary hover:text-pc-accent-light hover:bg-[var(--pc-hover)]"}`,title:l(E?"chat.hidePreview":"chat.showPreview"),"aria-label":l(E?"chat.hidePreview":"chat.showPreview"),children:E?e.jsx(Vt,{size:18}):e.jsx(qt,{size:18})}),e.jsx("input",{ref:y,type:"file",multiple:!0,className:"hidden",onChange:x=>{x.target.files&&O(x.target.files),x.target.value=""},accept:"image/*,.pdf,.txt,.md,.json,.csv,.log,.py,.js,.ts,.tsx,.jsx,.html,.css,.yaml,.yml,.xml,.sql,.sh,.env,.toml"}),e.jsx("textarea",{id:"chat-input",ref:N,value:p,onChange:x=>{g(x.target.value),L(Me(x.target.value))},onKeyDown:ae,onPaste:V,placeholder:l("chat.inputPlaceholder"),"aria-label":l("chat.inputLabel"),disabled:a,rows:1,className:"flex-1 bg-transparent resize-none rounded-2xl border border-pc-border bg-pc-input/35 px-4 py-3 text-sm text-pc-text placeholder:text-pc-text-muted outline-none transition-all max-h-[200px]"}),e.jsx("button",{onClick:h,className:"hidden sm:flex shrink-0 h-7 rounded-xl border border-pc-border bg-pc-elevated/30 px-2 items-center gap-1 text-[10px] text-pc-text-muted hover:text-pc-text-secondary hover:bg-[var(--pc-hover)] transition-colors",title:`${l("settings.sendShortcut")}: ${l(c?"settings.sendEnter":"settings.sendCtrlEnter")}`,children:e.jsx("span",{children:c?"â†µ":navigator.userAgent.includes("Mac")?"âŒ˜â†µ":"Ctrlâ†µ"})}),r?e.jsxs("button",{onClick:s,className:"shrink-0 h-11 px-4 rounded-2xl border border-red-500/20 bg-red-500/10 text-red-400 hover:bg-red-500/20 transition-colors flex items-center gap-2",children:[e.jsx(Jt,{size:16}),e.jsx("span",{className:"text-sm hidden sm:inline",children:l("chat.stop")})]}):e.jsxs("button",{onClick:P,disabled:!p.trim()&&d.length===0||a,"aria-label":l("chat.send"),className:"shrink-0 h-11 px-5 rounded-2xl bg-[var(--pc-accent)] text-white font-semibold text-sm hover:opacity-90 shadow-[0_8px_24px_rgba(var(--pc-accent-rgb),0.15)] disabled:opacity-30 disabled:shadow-none transition-all flex items-center gap-2",children:[e.jsx(Yt,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:l("chat.send")})]})]})]})})})}function Xs(t){if(t<60)return`${t}s`;const s=Math.floor(t/60),r=t%60;return`${s}m ${r.toString().padStart(2,"0")}s`}function Qs(){const t=B(),[s,r]=o.useState(0),a=o.useRef(0);return o.useEffect(()=>{a.current=Date.now();const n=setInterval(()=>{r(Math.floor((Date.now()-a.current)/1e3))},1e3);return()=>clearInterval(n)},[]),e.jsxs("div",{className:"animate-fade-in flex items-start gap-3 px-4 py-3",children:[e.jsx("div",{className:"shrink-0 flex h-9 w-9 items-center justify-center rounded-2xl border border-pc-border-strong bg-pc-input/60",children:e.jsx(ne,{className:"h-4 w-4 text-pc-accent-light"})}),e.jsx("div",{className:"rounded-3xl border border-pc-border-strong bg-pc-input/55 px-4 py-3 shadow-[0_0_0_1px_rgba(255,255,255,0.03)]",children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"bounce-dot h-2 w-2 rounded-full bg-gradient-to-r from-cyan-300/80 to-violet-400/80"}),e.jsx("span",{className:"bounce-dot h-2 w-2 rounded-full bg-gradient-to-r from-cyan-300/80 to-violet-400/80"}),e.jsx("span",{className:"bounce-dot h-2 w-2 rounded-full bg-gradient-to-r from-cyan-300/80 to-violet-400/80"}),e.jsx("span",{className:"ml-2 text-xs text-pc-text-secondary",children:t("chat.thinking")}),s>=2&&e.jsx("span",{className:"text-[10px] text-pc-text-muted tabular-nums ml-1",children:Xs(s)})]})})]})}function er({open:t,onClose:s,onSearch:r,matchCount:a}){const n=B(),[i,u]=o.useState(""),[l,c]=o.useState(0),h=o.useRef(null);o.useEffect(()=>{t&&(h.current?.focus(),h.current?.select())},[t]),o.useEffect(()=>{r(i,l)},[i,l,r]),o.useEffect(()=>{c(0)},[i]);const p=o.useCallback(d=>{a!==0&&c(k=>{const b=k+d;return b<0?a-1:b>=a?0:b})},[a]),g=o.useCallback(d=>{d.key==="Escape"?s():d.key==="Enter"&&(d.preventDefault(),p(d.shiftKey?-1:1))},[s,p]);return t?e.jsxs("div",{className:"absolute top-2 right-4 z-20 flex items-center gap-1.5 rounded-xl border border-pc-border-strong bg-pc-elevated/95 backdrop-blur-lg px-3 py-1.5 shadow-lg",children:[e.jsx(Gt,{size:14,className:"text-pc-text-muted shrink-0"}),e.jsx("input",{ref:h,type:"text",value:i,onChange:d=>u(d.target.value),onKeyDown:g,placeholder:n("search.placeholder"),"aria-label":n("search.placeholder"),className:"bg-transparent text-sm text-pc-text placeholder:text-pc-text-muted outline-none w-48"}),i&&e.jsx("span",{className:"text-xs text-pc-text-muted whitespace-nowrap",children:a>0?`${l+1}/${a}`:n("search.noResults")}),e.jsx("button",{onClick:()=>p(-1),disabled:a===0,className:"p-1 rounded-lg text-pc-text-muted hover:text-pc-text hover:bg-[var(--pc-hover)] disabled:opacity-30 transition-colors","aria-label":n("search.prev"),children:e.jsx(Ve,{size:14})}),e.jsx("button",{onClick:()=>p(1),disabled:a===0,className:"p-1 rounded-lg text-pc-text-muted hover:text-pc-text hover:bg-[var(--pc-hover)] disabled:opacity-30 transition-colors","aria-label":n("search.next"),children:e.jsx(J,{size:14})}),e.jsx("button",{onClick:s,className:"p-1 rounded-lg text-pc-text-muted hover:text-pc-text hover:bg-[var(--pc-hover)] transition-colors","aria-label":n("shortcuts.close"),children:e.jsx(te,{size:14})})]}):null}const jt="startlobster-bookmarks";function tr(){try{const t=localStorage.getItem(jt);if(t)return JSON.parse(t)}catch{}return[]}function xe(t){try{localStorage.setItem(jt,JSON.stringify(t))}catch{}}function sr(){const[t,s]=o.useState(tr),r=o.useCallback((l,c,h,p)=>{s(g=>{const k=g.some(b=>b.messageId===l)?g.filter(b=>b.messageId!==l):[...g,{messageId:l,sessionKey:c,preview:h.slice(0,120),timestamp:p,bookmarkedAt:Date.now()}];return xe(k),k})},[]),a=o.useCallback(l=>t.some(c=>c.messageId===l),[t]),n=o.useCallback(l=>t.filter(c=>c.sessionKey===l).sort((c,h)=>c.timestamp-h.timestamp),[t]),i=o.useCallback(l=>{s(c=>{const h=c.filter(p=>p.messageId!==l);return xe(h),h})},[]),u=o.useCallback(l=>{s(c=>{const h=c.filter(p=>p.sessionKey!==l);return xe(h),h})},[]);return{bookmarks:t,toggle:r,isBookmarked:a,getForSession:n,remove:i,clearSession:u}}function rr(t,s){const r=[],a=s;r.push(`# ${a}`),r.push(`> Exported from StartLobster Chat on ${new Date().toLocaleString()}`),r.push("");for(const n of t){if(n.isCompactionSeparator){r.push("---"),r.push("*Context compacted*"),r.push("---"),r.push("");continue}const i=n.timestamp?new Date(n.timestamp).toLocaleString():"",u=n.role==="user"?"ğŸ‘¤ User":n.role==="assistant"?"ğŸ¤– Assistant":"âš™ï¸ System",l=i?`### ${u} â€” ${i}`:`### ${u}`;r.push(l),r.push("");for(const c of n.blocks)if(c.type==="text")r.push(c.text),r.push("");else if(c.type==="thinking")r.push("<details>"),r.push("<summary>ğŸ’­ Thinking</summary>"),r.push(""),r.push(c.text),r.push("</details>"),r.push("");else if(c.type==="tool_use"){const h=typeof c.input=="string"?c.input:JSON.stringify(c.input,null,2);r.push(`**ğŸ”§ Tool: \`${c.name}\`**`),r.push("```json"),r.push(h),r.push("```"),r.push("")}else c.type==="tool_result"&&(r.push("**ğŸ“‹ Result:**"),r.push("```"),r.push(c.content.slice(0,2e3)+(c.content.length>2e3?`
...(truncated)`:"")),r.push("```"),r.push(""));n.blocks.length===0&&n.content&&(r.push(n.content),r.push(""))}return r.join(`
`)}function nr(t,s,r="text/markdown"){const a=new Blob([t],{type:r}),n=URL.createObjectURL(a),i=document.createElement("a");i.href=n,i.download=s,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(n)}function ar(t){if((t.content||"").trim()==="NO_REPLY")return!0;const r=t.blocks.filter(a=>a.type==="text");return r.length===1&&r[0].text.trim()==="NO_REPLY"}function or(t){return t.role==="user"?!0:t.role==="assistant"&&ar(t)?!1:t.blocks.length===0?!!t.content:t.blocks.some(s=>s.type==="text"&&s.text.trim()||s.type==="thinking"||s.type==="tool_use"||s.type==="tool_result")}function lr(t){if(t.length===0)return!1;const s=t[t.length-1];return s.role!=="assistant"?!1:s.blocks.some(r=>r.type==="text"&&r.text.trim().length>0)||s.content?.trim().length>0}function ze(t,s){const r=new Date(t),a=new Date,i=Pe()==="fr"?"fr-FR":"en-US";if(r.toDateString()===a.toDateString())return s("time.today");const u=new Date(a);return u.setDate(u.getDate()-1),r.toDateString()===u.toDateString()?s("time.yesterday"):r.toLocaleDateString(i,{weekday:"long",day:"numeric",month:"long",year:r.getFullYear()!==a.getFullYear()?"numeric":void 0})}function Oe(t){const s=new Date(t);return`${s.getFullYear()}-${s.getMonth()}-${s.getDate()}`}const ee=150;function pr({messages:t,isGenerating:s,isLoadingHistory:r,status:a,sessionKey:n,onSend:i,onAbort:u,agentAvatarUrl:l}){const c=B(),h=o.useRef(null),p=o.useRef(null),g=o.useRef(!0),d=o.useRef(!1),[k,b]=o.useState(!1),[j,E]=o.useState(0),[M,I]=o.useState(null);o.useEffect(()=>{I(null)},[n]);const L=o.useRef(t.length),N=o.useCallback(()=>{const m=p.current;if(!m)return;const f=m.scrollHeight-m.scrollTop-m.clientHeight;g.current=f<=ee,b(f>ee*2),f<=ee&&E(0)},[]),y=o.useCallback((m="smooth")=>{h.current?.scrollIntoView({behavior:m})},[]);o.useEffect(()=>{const m=p.current;if(!m)return;const f=()=>N();return m.addEventListener("scroll",f,{passive:!0}),()=>m.removeEventListener("scroll",f)},[N]);const _=o.useRef(new Map),z=o.useRef(n);o.useEffect(()=>{if(n!==z.current){const m=z.current,f=p.current;if(m&&f){const C=f.scrollHeight-f.scrollTop-f.clientHeight;_.current.set(m,{top:f.scrollTop,height:f.scrollHeight}),C<=ee&&_.current.delete(m)}z.current=n,L.current=t.length,E(0);const $=n?_.current.get(n):void 0;$?(g.current=!1,requestAnimationFrame(()=>{const C=p.current;if(C){const H=C.scrollHeight-$.height;C.scrollTop=$.top+Math.max(0,H),N()}})):(g.current=!0,requestAnimationFrame(()=>y("instant")))}},[n,t.length,y,N]);const O=o.useRef(r);o.useEffect(()=>{const m=t.length,f=m-L.current,$=f>0,C=O.current&&!r;if(O.current=r,L.current=m,C){y("instant"),g.current=!0,E(0);return}if(d.current){d.current=!1,y("smooth"),g.current=!0,E(0);return}g.current?(y("smooth"),E(0)):$&&E(H=>H+f)},[t,s,r,y]);const G=o.useCallback((m,f)=>{d.current=!0,i(m,f)},[i]),P=o.useMemo(()=>{const m=t.filter(or),f=120*1e3;return m.reduce(($,C)=>{const H=Oe(C.timestamp),St=$.length>0?Oe($[$.length-1].msg.timestamp):"",Ce=H!==St,Z=$.length>0?$[$.length-1]:null,Ct=Ce||!Z||Z.msg.role!==C.role||Z.msg.isSystemEvent!==C.isSystemEvent||C.timestamp-Z.msg.timestamp>f;return $.push({msg:C,showSep:Ce,isFirstInGroup:Ct}),$},[])},[t]),ae=s&&!lr(t),{globalState:V,collapseAll:oe,expandAll:le}=ht(),{toggle:ce,isBookmarked:x,getForSession:D}=sr(),w=o.useMemo(()=>n?D(n):[],[D,n]),[T,A]=o.useState(!1),F=o.useMemo(()=>t.some(m=>m.blocks.some(f=>f.type==="tool_use"||f.type==="tool_result")),[t]),K=o.useCallback(()=>{const m=n?.replace(/^agent:[^:]+:/,"")||"conversation",f=rr(t,m),$=m.replace(/[^a-zA-Z0-9_-]/g,"_").slice(0,40);nr(f,`${$}-${new Date().toISOString().slice(0,10)}.md`)},[t,n]),[yt,Ne]=o.useState(!1),[ie,Se]=o.useState(""),[de,wt]=o.useState(0),q=o.useMemo(()=>{if(!ie.trim())return[];const m=ie.toLowerCase();return P.filter(({msg:f})=>(f.content?.toLowerCase()||"").includes(m)?!0:f.blocks.some(C=>C.type==="text"||C.type==="thinking"?C.text.toLowerCase().includes(m):C.type==="tool_result"?C.content.toLowerCase().includes(m):!1)).map(({msg:f})=>f.id)},[P,ie]),kt=o.useCallback((m,f)=>{Se(m),wt(f)},[]);o.useEffect(()=>{if(q.length===0)return;const m=q[de];if(!m)return;p.current?.querySelector(`[data-msg-id="${m}"]`)?.scrollIntoView({behavior:"smooth",block:"center"})},[de,q]);const Nt=o.useCallback(()=>{Ne(!1),Se("")},[]);return o.useEffect(()=>{const m=f=>{(f.metaKey||f.ctrlKey)&&f.key==="f"&&(f.preventDefault(),Ne(!0))};return window.addEventListener("keydown",m),()=>window.removeEventListener("keydown",m)},[]),e.jsxs("div",{className:"flex-1 flex flex-col min-h-0 relative",children:[e.jsx(er,{open:yt,onClose:Nt,onSearch:kt,matchCount:q.length}),e.jsxs("div",{ref:p,className:"flex-1 overflow-y-auto overflow-x-hidden relative",role:"log","aria-label":c("chat.messages"),"aria-live":"polite",children:[e.jsxs("div",{className:"max-w-4xl mx-auto py-4 w-full",children:[t.length===0&&r&&e.jsxs("div",{className:"flex flex-col items-center justify-center h-[60vh] text-pc-text-muted",children:[e.jsx(Kt,{className:"h-8 w-8 text-pc-accent-light/60 animate-spin mb-4"}),e.jsx("div",{className:"text-sm text-pc-text-muted",children:c("chat.loadingHistory")})]}),t.length===0&&!r&&e.jsxs("div",{className:"flex flex-col items-center justify-center h-[60vh] text-pc-text-muted",children:[e.jsxs("div",{className:"relative mb-6",children:[e.jsx("div",{className:"absolute -inset-4 rounded-3xl bg-gradient-to-r from-cyan-400/10 via-indigo-500/10 to-violet-500/10 blur-2xl"}),e.jsx("div",{className:"relative flex h-16 w-16 items-center justify-center rounded-3xl border border-pc-border bg-pc-elevated/40",children:e.jsx(ne,{className:"h-8 w-8 text-pc-accent-light"})})]}),e.jsx("div",{className:"text-lg text-pc-text font-semibold",children:c("chat.welcome")}),e.jsx("div",{className:"text-sm mt-1 text-pc-text-muted",children:c("chat.welcomeSub")}),e.jsxs("div",{className:"mt-8 flex flex-col items-center gap-3 max-w-md w-full",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-pc-text-faint",children:[e.jsx(Zt,{size:12}),e.jsx("span",{children:c("chat.suggestions")})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 w-full",children:["chat.suggestion1","chat.suggestion2","chat.suggestion3","chat.suggestion4"].map(m=>e.jsx("button",{onClick:()=>i(c(m)),className:"text-left text-sm px-4 py-3 rounded-2xl border border-pc-border bg-pc-elevated/30 text-pc-text-secondary hover:bg-[var(--pc-hover)] hover:text-pc-text hover:border-[var(--pc-accent-dim)] transition-all duration-200 leading-snug",children:c(m)},m))})]})]}),P.map(({msg:m,showSep:f,isFirstInGroup:$})=>{const C=q.length>0&&q[de]===m.id;return m.isCompactionSeparator?e.jsxs("div",{className:"flex items-center gap-3 py-4 px-4 select-none",children:[e.jsx("div",{className:"flex-1 h-px bg-amber-500/30"}),e.jsxs("span",{className:"text-[11px] font-medium text-amber-400/70 uppercase tracking-wider flex items-center gap-1.5",children:[e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})}),c("chat.contextCompacted")]}),e.jsx("div",{className:"flex-1 h-px bg-amber-500/30"})]},m.id):e.jsxs("div",{"data-msg-id":m.id,children:[f&&e.jsxs("div",{className:"flex items-center gap-3 py-3 px-4 select-none","aria-label":ze(m.timestamp,c),children:[e.jsx("div",{className:"flex-1 h-px bg-[var(--pc-hover-strong)]"}),e.jsx("span",{className:"text-[11px] font-medium text-pc-text-muted uppercase tracking-wider",children:ze(m.timestamp,c)}),e.jsx("div",{className:"flex-1 h-px bg-[var(--pc-hover-strong)]"})]}),e.jsx("div",{className:`${C?"ring-1 ring-pc-accent-light/40 rounded-lg":""} ${m.isArchived?"opacity-60":""}`,children:e.jsx(Hs,{message:m,onRetry:s?void 0:G,onReply:H=>{I({preview:H}),document.getElementById("chat-input")?.focus()},agentAvatarUrl:l,isFirstInGroup:$,isBookmarked:x(m.id),onToggleBookmark:n?()=>ce(m.id,n,(m.content||"").slice(0,120),m.timestamp):void 0})})]},m.id)}),ae&&e.jsx(Qs,{}),e.jsx("div",{ref:h})]}),T&&w.length>0&&e.jsx("div",{className:"sticky bottom-14 z-20 flex justify-center pointer-events-none pb-1",children:e.jsxs("div",{className:"pointer-events-auto w-72 max-h-48 overflow-y-auto rounded-2xl border border-pc-border-strong bg-pc-elevated/95 backdrop-blur-xl shadow-2xl p-2",children:[e.jsx("div",{className:"text-[10px] uppercase tracking-wider text-pc-text-muted font-semibold px-2 py-1",children:c("chat.bookmarks")}),w.map(m=>e.jsxs("button",{onClick:()=>{const f=document.querySelector(`[data-msg-id="${m.messageId}"]`);f&&f.scrollIntoView({behavior:"smooth",block:"center"}),A(!1)},className:"w-full text-left px-2 py-1.5 rounded-xl hover:bg-[var(--pc-hover)] text-xs text-pc-text-secondary truncate transition-colors",children:[e.jsx("span",{className:"text-amber-400 mr-1",children:"â˜…"}),m.preview||"(empty)"]},m.messageId))]})}),(F||t.length>0||k||j>0)&&e.jsx("div",{className:"sticky bottom-3 z-10 flex justify-center pointer-events-none pb-1",children:e.jsxs("div",{className:"flex items-center gap-2 pointer-events-auto",children:[F&&e.jsx("button",{onClick:V==="expand-all"?oe:le,"aria-label":c(V==="expand-all"?"chat.collapseTools":"chat.expandTools"),title:c(V==="expand-all"?"chat.collapseTools":"chat.expandTools"),className:"flex items-center gap-1.5 rounded-full border border-pc-border-strong bg-pc-elevated/90 backdrop-blur-lg px-3 py-2 text-xs text-pc-text shadow-lg hover:bg-pc-elevated/90 transition-all hover:shadow-violet-500/10",children:V==="expand-all"?e.jsx(Xt,{size:14,className:"text-violet-300"}):e.jsx(Qt,{size:14,className:"text-violet-300"})}),w.length>0&&e.jsxs("button",{onClick:()=>A(m=>!m),"aria-label":c("chat.bookmarks"),title:c("chat.bookmarks"),className:`flex items-center gap-1.5 rounded-full border border-pc-border-strong bg-pc-elevated/90 backdrop-blur-lg px-3 py-2 text-xs text-pc-text shadow-lg hover:bg-pc-elevated/90 transition-all hover:shadow-amber-500/10 ${T?"ring-1 ring-amber-400/40":""}`,children:[e.jsx(he,{size:14,className:"text-amber-300 fill-amber-300"}),e.jsx("span",{className:"text-[10px] tabular-nums text-pc-text-muted",children:w.length})]}),t.length>0&&e.jsx("button",{onClick:K,"aria-label":c("chat.export"),title:c("chat.export"),className:"flex items-center gap-1.5 rounded-full border border-pc-border-strong bg-pc-elevated/90 backdrop-blur-lg px-3 py-2 text-xs text-pc-text shadow-lg hover:bg-pc-elevated/90 transition-all hover:shadow-cyan-500/10",children:e.jsx(es,{size:14,className:"text-pc-accent-light"})}),(k||j>0)&&e.jsxs("button",{onClick:()=>{y("smooth"),E(0)},"aria-label":j>0?c("chat.scrollToBottom"):c("chat.scrollDown"),className:"flex items-center gap-1.5 rounded-full border border-pc-border-strong bg-pc-elevated/90 backdrop-blur-lg px-3.5 py-2 text-xs text-pc-text shadow-lg hover:bg-pc-elevated/90 transition-all hover:shadow-cyan-500/10",children:[e.jsx(ts,{size:14,className:j>0?"text-pc-accent-light animate-bounce":"text-pc-accent-light"}),j>0&&e.jsx("span",{className:"inline-flex items-center justify-center min-w-[1.25rem] h-5 px-1 rounded-full bg-[var(--pc-accent)] text-white text-[10px] font-bold tabular-nums",children:j>99?"99+":j})]})]})})]}),e.jsx(Zs,{onSend:G,onAbort:u,isGenerating:s,disabled:a!=="connected",sessionKey:n,replyTo:M,onCancelReply:()=>I(null)})]})}export{pr as Chat};
